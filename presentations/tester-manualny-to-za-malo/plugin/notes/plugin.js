import a from"./speaker-view.html";import b from"marked";let Plugin=()=>{let d=null,e;function c(){if(d&&!d.closed){d.focus();return}if((d=window.open("about:blank","reveal.js - Notes","width=1100,height=700")).marked=b,d.document.write(a),!d){alert("Speaker view popup failed to open. Please make sure popups are allowed and reopen the speaker view.");return}function f(h){let c=e.getCurrentSlide(),b=c.querySelector("aside.notes"),f=c.querySelector(".current-fragment"),a={namespace:"reveal-notes",type:"state",notes:"",markdown:!1,whitespace:"normal",state:e.getState()};if(c.hasAttribute("data-notes")&&(a.notes=c.getAttribute("data-notes"),a.whitespace="pre-wrap"),f){let g=f.querySelector("aside.notes");g?b=g:f.hasAttribute("data-notes")&&(a.notes=f.getAttribute("data-notes"),a.whitespace="pre-wrap",b=null)}b&&(a.notes=b.innerHTML,a.markdown="string"==typeof b.getAttribute("data-markdown")),d.postMessage(JSON.stringify(a),"*")}let c;c=setInterval(function(){d.postMessage(JSON.stringify({namespace:"reveal-notes",type:"connect",url:window.location.protocol+"//"+window.location.host+window.location.pathname+window.location.search,state:e.getState()}),"*")},500),window.addEventListener("message",function(j){var b,g,h;let a=JSON.parse(j.data),i;a&&"reveal-notes"===a.namespace&&"connected"===a.type&&(clearInterval(c),e.on("slidechanged",f),e.on("fragmentshown",f),e.on("fragmenthidden",f),e.on("overviewhidden",f),e.on("overviewshown",f),e.on("paused",f),e.on("resumed",f),f()),a&&"reveal-notes"===a.namespace&&"call"===a.type&&(b=a.methodName,g=a.arguments,h=a.callId,i=e[b].apply(e,g),d.postMessage(JSON.stringify({namespace:"reveal-notes",type:"return",result:i,callId:h}),"*"))})}return{id:"notes",init:function(a){e=a,/receiver/i.test(window.location.search)||(null!==window.location.search.match(/(\?|\&)notes/gi)&&c(),e.addKeyBinding({keyCode:83,key:"S",description:"Speaker notes view"},function(){c()}))},open:c}};export default Plugin