!function(t){t.fn.flowr=function(a){$this=this;var e=["complete","data","responsive"],d={data:[],padding:5,height:240,render:null,append:!1,widthAttr:"width",heightAttr:"height",maxScale:1.5,maxWidth:this.width()-1,itemWidth:null,itemHeight:null,complete:null,rowClassName:"flowr-row",rows:-1,responsive:!0},n=t.extend(d,a);if(n.append&&$this.data("lastSettings")){for(attr in lastSettings=$this.data("lastSettings"),d)0>e.indexOf(attr)&&n[attr]==d[attr]&&(n[attr]=lastSettings[attr]);(lastRow=$this.data("lastRow")).data.length>0&&n.maxWidth-lastRow.width>25&&(lastRowData=lastSettings.data.slice(lastSettings.data.length-lastRow.data.length-1),n.data=lastRowData.concat(n.data),t("."+n.rowClassName+":last",$this).detach())}if(n.responsive||n.append||$this.width($this.width()),n.data instanceof Array){"number"!=typeof n.padding&&(n.padding=parseInt(n.padding)),"function"!=typeof n.itemWidth&&(n.itemWidth=function(t){return t[n.widthAttr]}),"function"!=typeof n.itemHeight&&(n.itemHeight=function(t){return t[n.heightAttr]});var h={getNextRow:function(t,a){var e=0,d=t.length,n=[],h=0;for(a.maxWidth,a.padding,requiredPadding=function(){var t=1==arguments.length?arguments[0]:0;return(n.length-1+t)*a.padding};h+requiredPadding()<a.maxWidth&&e<d;){var r=t[e],l=a.itemWidth.call($this,r),o=a.itemHeight.call($this,r),s=a.height,g=Math.floor(l*a.height/o);if(g>a.maxWidth&&(g=a.maxWidth-1-requiredPadding(1),s=a.height*s/g),h+g<a.maxWidth)n.push({height:s,width:g,itemData:r}),h+=g,e++;else break}if(testWidth=0,h<a.maxWidth){var f,p=(a.maxWidth-requiredPadding()-10)/h;p>a.maxScale&&(p=1);var c=Math.round(a.height*p);for(i=0;i<n.length;i++){var w=n[i];w.width=Math.floor(w.width*p),w.height=c,testWidth+=w.width}}return{data:n,width:testWidth+requiredPadding()}},reorderContent:function(){var t,a=$this.data("width");if(a!=$this.width()){$this.html("");var e=$this.data("lastSettings");e.data=$this.data("data"),e.maxWidth=$this.width()-1,$this.flowr(e)}}};return n.responsive&&!$this.data("__responsive")&&(t(window).resize(function(){if((initialWidth=$this.data("width"))!=(newWidth=$this.width())){var t=$this.data("task_id");t&&(t=clearTimeout(t),t=null),t=setTimeout(h.reorderContent,80),$this.data("task_id",t)}}),$this.data("__responsive",!0)),this.each(function(){var a=n.data.slice(0),e=null,d=0,r=0,l=[];for(i=0;i<a.length;i++)l.push(a[i]);for($this.data("data",l);null!=(e=h.getNextRow(a,n))&&e.data.length>0&&(!(n.rows>0)||!(d>=n.rows));){a.splice(0,e.data.length);var o=t("<div>").addClass(n.rowClassName),s=$this[0].clientWidth-e.width-2*n.padding;for(i=0;i<e.data.length;i++){var g=e.data[i],f=n.render.call($this,g);f=t(f),extraw=Math.floor(s/e.data.length),0==i&&(extraw+=s%e.data.length),f.css("width",g.width+extraw).css("height",g.height).css("margin-bottom",n.padding+"px").css("margin-left",0==i?"0":n.padding+"px"),o.append(f),r++}$this.append(o),d++,$this.data("lastRow",e)}if($this.data("lastSettings",n),"function"==typeof n.complete){var p={renderedRows:d,renderedItems:r};n.complete.call($this,p)}})}}}(jQuery);