function scriptPath(){var src,sel;return document.currentScript?src=document.currentScript.src:(sel=document.querySelector('script[src$="/chalkboard/plugin.js"]'))&&(src=sel.src),void 0===src?"":src.slice(0,src.lastIndexOf("/")+1)}window.RevealChalkboard=window.RevealChalkboard||{id:"RevealChalkboard",init:function(deck){initChalkboard(deck)},configure:function(config){configure(config)},toggleNotesCanvas:function(){toggleNotesCanvas()},toggleChalkboard:function(){toggleChalkboard()},colorIndex:function(){colorIndex()},colorNext:function(){colorNext()},colorPrev:function(){colorPrev()},clear:function(){clear()},reset:function(){reset()},resetAll:function(){resetAll()},updateStorage:function(){updateStorage()},getData:function(){return getData()},download:function(){download()}};var path=scriptPath();let initChalkboard=function(Reveal){var background,draw,passiveSupported=!1;try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:function(){passiveSupported=!0}}))}catch(err){}var button,grid=!1,boardmarkerWidth=3,chalkWidth=7,chalkEffect=1,rememberColor=[!0,!1],eraser={src:path+"img/sponge.png",radius:20},boardmarkers=[{color:"rgba(100,100,100,1)",cursor:"url("+path+"img/boardmarker-black.png), auto"},{color:"rgba(30,144,255, 1)",cursor:"url("+path+"img/boardmarker-blue.png), auto"},{color:"rgba(220,20,60,1)",cursor:"url("+path+"img/boardmarker-red.png), auto"},{color:"rgba(50,205,50,1)",cursor:"url("+path+"img/boardmarker-green.png), auto"},{color:"rgba(255,140,0,1)",cursor:"url("+path+"img/boardmarker-orange.png), auto"},{color:"rgba(150,0,20150,1)",cursor:"url("+path+"img/boardmarker-purple.png), auto"},{color:"rgba(255,220,0,1)",cursor:"url("+path+"img/boardmarker-yellow.png), auto"}],chalks=[{color:"rgba(255,255,255,0.5)",cursor:"url("+path+"img/chalk-white.png), auto"},{color:"rgba(96, 154, 244, 0.5)",cursor:"url("+path+"img/chalk-blue.png), auto"},{color:"rgba(237, 20, 28, 0.5)",cursor:"url("+path+"img/chalk-red.png), auto"},{color:"rgba(20, 237, 28, 0.5)",cursor:"url("+path+"img/chalk-green.png), auto"},{color:"rgba(220, 133, 41, 0.5)",cursor:"url("+path+"img/chalk-orange.png), auto"},{color:"rgba(220,0,220,0.5)",cursor:"url("+path+"img/chalk-purple.png), auto"},{color:"rgba(255,220,0,0.5)",cursor:"url("+path+"img/chalk-yellow.png), auto"}],keyBindings={toggleNotesCanvas:{keyCode:67,key:"C",description:"Toggle notes canvas"},toggleChalkboard:{keyCode:66,key:"B",description:"Toggle chalkboard"},clear:{keyCode:171,key:"+",description:"Clear drawings on slide"},reset:{keyCode:46,key:"DEL",description:"Reset drawings on slide"},resetAll:{keyCode:8,key:"BACKSPACE",description:"Reset all drawings"},colorNext:{keyCode:88,key:"X",description:"Next color"},colorPrev:{keyCode:89,key:"Y",description:"Previous color"},download:{keyCode:68,key:"D",description:"Download drawings"}},theme="chalkboard",color=[0,0],toggleChalkboardButton=!0,toggleNotesButton=!0,colorButtons=!0,boardHandle=!0,transition=800,readOnly=!1,messageType="broadcast",config=configure(Reveal.getConfig().chalkboard||{});if(config.keyBindings)for(var key in config.keyBindings)keyBindings[key]=config.keyBindings[key];function configure(config){return(config.boardmarkerWidth||config.penWidth)&&(boardmarkerWidth=config.boardmarkerWidth||config.penWidth),config.chalkWidth&&(chalkWidth=config.chalkWidth),config.chalkEffect&&(chalkEffect=config.chalkEffect),config.rememberColor&&(rememberColor=config.rememberColor),config.eraser&&(eraser=config.eraser),config.boardmarkers&&(boardmarkers=config.boardmarkers),config.chalks&&(chalks=config.chalks),config.theme&&(theme=config.theme),grid="whiteboard"===theme?(background=["rgba(127,127,127,.1)",path+"img/whiteboard.png"],draw=[drawWithBoardmarker,drawWithBoardmarker],pens=[boardmarkers,boardmarkers],{color:"rgb(127,127,255,0.1)",distance:40,width:2}):(background=["rgba(127,127,127,.1)",path+"img/blackboard.png"],draw=[drawWithBoardmarker,drawWithChalk],pens=[boardmarkers,chalks],{color:"rgb(50,50,10,0.5)",distance:80,width:2}),config.background&&(background=config.background),null!=config.grid&&(grid=config.grid),null!=config.toggleChalkboardButton&&(toggleChalkboardButton=config.toggleChalkboardButton),null!=config.toggleNotesButton&&(toggleNotesButton=config.toggleNotesButton),null!=config.colorButtons&&(colorButtons=config.colorButtons),null!=config.boardHandle&&(boardHandle=config.boardHandle),config.transition&&(transition=config.transition),null!=config.readOnly&&(readOnly=config.readOnly),config.messageType&&(messageType=config.messageType),drawingCanvas&&(config.theme||config.background||config.grid)&&(document.getElementById(drawingCanvas[1].id).style.background='url("'+background[1]+'") repeat',clearCanvas(1),drawGrid()),config}function whenReady(callback){document.querySelectorAll(".pdf-page").length&&null!==loaded?callback():(console.log("Wait for pdf pages to be created and drawings to be loaded"),setTimeout(whenReady,500,callback))}toggleChalkboardButton&&((button=document.createElement("div")).className="chalkboard-button",button.id="toggle-chalkboard",button.style.visibility="visible",button.style.position="absolute",button.style.zIndex=30,button.style.fontSize="24px",button.style.left=toggleChalkboardButton.left||"30px",button.style.bottom=toggleChalkboardButton.bottom||"30px",button.style.top=toggleChalkboardButton.top||"auto",button.style.right=toggleChalkboardButton.right||"auto",button.innerHTML='<a href="#" title="Toggle chalkboard ('+keyBindings.toggleChalkboard.key+')" onclick="RevealChalkboard.toggleChalkboard(); return false;"><i class="fa fa-pen-square"></i></a>',document.querySelector(".reveal").appendChild(button)),toggleNotesButton&&((button=document.createElement("div")).className="chalkboard-button",button.id="toggle-notes",button.style.position="absolute",button.style.zIndex=30,button.style.fontSize="24px",button.style.left=toggleNotesButton.left||"70px",button.style.bottom=toggleNotesButton.bottom||"30px",button.style.top=toggleNotesButton.top||"auto",button.style.right=toggleNotesButton.right||"auto",button.innerHTML='<a href="#" title="Toggle slide annotation ('+keyBindings.toggleNotesCanvas.key+')" onclick="RevealChalkboard.toggleNotesCanvas(); return false;"><i class="fa fa-pen"></i></a>',document.querySelector(".reveal").appendChild(button));var drawingCanvas=[{id:"notescanvas"},{id:"chalkboard"}],mode=(setupDrawingCanvas(0),setupDrawingCanvas(1),0),board=0,mouseX=0,mouseY=0,xLast=null,yLast=null,slideStart=Date.now(),slideIndices={h:0,v:0},event=null,timeouts=[[],[]],touchTimeout=null,slidechangeTimeout=null,playback=!1;function createPalette(colors,length){(!0===length||length>colors.length)&&(length=colors.length);for(var palette=document.createElement("div"),list=(palette.classList.add("palette"),document.createElement("ul")),i=0;i<length;i++){var colorButton=document.createElement("li");colorButton.setAttribute("data-color",i),colorButton.innerHTML='<i class="fa fa-square"></i>',colorButton.style.color=colors[i].color,colorButton.addEventListener("click",function(e){colorIndex(e.target.parentElement.getAttribute("data-color"))}),list.appendChild(colorButton)}return palette.appendChild(list),palette}function setupDrawingCanvas(id){var container=document.createElement("div"),palette=(container.id=drawingCanvas[id].id,container.classList.add("overlay"),container.setAttribute("data-prevent-swipe",""),container.oncontextmenu=function(){return!1},container.style.cursor=pens[id][color[id]].cursor,drawingCanvas[id].width=window.innerWidth,drawingCanvas[id].height=window.innerHeight,drawingCanvas[id].scale=1,drawingCanvas[id].xOffset=0,drawingCanvas[id].yOffset=0,"0"==id?(container.style.background="rgba(0,0,0,0)",container.style.zIndex=24,container.style.opacity=1,container.style.visibility="visible",container.style.pointerEvents="none",document.querySelector(".slides"),aspectRatio=Reveal.getConfig().width/Reveal.getConfig().height,drawingCanvas[id].width>drawingCanvas[id].height*aspectRatio?drawingCanvas[id].xOffset=(drawingCanvas[id].width-drawingCanvas[id].height*aspectRatio)/2:drawingCanvas[id].height>drawingCanvas[id].width/aspectRatio&&(drawingCanvas[id].yOffset=(drawingCanvas[id].height-drawingCanvas[id].width/aspectRatio)/2),colorButtons&&((palette=createPalette(boardmarkers,colorButtons)).style.visibility="hidden",container.appendChild(palette))):(container.style.background='url("'+background[id]+'") repeat',container.style.zIndex=26,container.style.opacity=0,container.style.visibility="hidden",colorButtons&&(palette=createPalette(chalks,colorButtons),container.appendChild(palette)),boardHandle&&((aspectRatio=document.createElement("div")).classList.add("boardhandle"),aspectRatio.innerHTML='<ul><li><a id="previousboard" href="#" title="Previous board"><i class="fas fa-chevron-up"></i></a></li><li><a id="nextboard" href="#" title="Next board"><i class="fas fa-chevron-down"></i></a></li></ul>',aspectRatio.querySelector("#previousboard").addEventListener("click",function(e){e.preventDefault(),setBoard(board-1,!0)}),aspectRatio.querySelector("#nextboard").addEventListener("click",function(e){e.preventDefault(),setBoard(board+1,!0)}),container.appendChild(aspectRatio))),document.createElement("img")),aspectRatio=(palette.src=eraser.src,palette.id="sponge",palette.style.visibility="hidden",palette.style.position="absolute",container.appendChild(palette),drawingCanvas[id].sponge=palette,document.createElement("canvas"));aspectRatio.width=drawingCanvas[id].width,aspectRatio.height=drawingCanvas[id].height,aspectRatio.setAttribute("data-chalkboard",id),aspectRatio.style.cursor=pens[id][color[id]].cursor,container.appendChild(aspectRatio),drawingCanvas[id].canvas=aspectRatio,drawingCanvas[id].context=aspectRatio.getContext("2d"),document.querySelector(".reveal").appendChild(container),drawingCanvas[id].container=container}var storage=[{width:Reveal.getConfig().width,height:Reveal.getConfig().height,data:[]},{width:Reveal.getConfig().width,height:Reveal.getConfig().height,data:[]}],loaded=null;if(!(loaded=config.storage?initStorage(sessionStorage.getItem(config.storage)):loaded)&&null!=config.src){var filename=config.src,xhr=new XMLHttpRequest;xhr.onload=function(){4===xhr.readyState&&404!=xhr.status?(loaded=initStorage(xhr.responseText),console.log("Drawings loaded from file")):(config.readOnly=void 0,readOnly=void 0,console.warn("Failed to get file "+filename+". ReadyState: "+xhr.readyState+", Status: "+xhr.status),loaded=!1)},xhr.open("GET",filename,!0);try{xhr.send()}catch(error){config.readOnly=void 0,readOnly=void 0,console.warn("Failed to get file "+filename+". Make sure that the presentation and the file are served by a HTTP server and the file can be found there. "+error),loaded=!1}}function initStorage(json){var success=!1;try{for(var data=JSON.parse(json),id=0;id<data.length;id++)drawingCanvas[id].width==data[id].width&&drawingCanvas[id].height==data[id].height||(drawingCanvas[id].scale=Math.min(drawingCanvas[id].width/data[id].width,drawingCanvas[id].height/data[id].height),drawingCanvas[id].xOffset=(drawingCanvas[id].width-data[id].width*drawingCanvas[id].scale)/2,drawingCanvas[id].yOffset=(drawingCanvas[id].height-data[id].height*drawingCanvas[id].scale)/2),config.readOnly&&(drawingCanvas[id].container.style.cursor="default",drawingCanvas[id].canvas.style.cursor="default");success=!0,storage=data}catch(err){console.warn("Cannot initialise storage!")}return success}function updateStorage(){var json=JSON.stringify(storage);return config.storage&&sessionStorage.setItem(config.storage,json),json}function getData(){for(var id=0;id<2;id++)for(var i=storage[id].data.length-1;0<=i;i--)0==storage[id].data[i].events.length&&storage[id].data.splice(i,1);return updateStorage()}function getSlideData(indices,id){null==id&&(id=mode),indices=indices||slideIndices;for(var i=0;i<storage[id].data.length;i++)if(storage[id].data[i].slide.h===indices.h&&storage[id].data[i].slide.v===indices.v&&storage[id].data[i].slide.f===indices.f)return storage[id].data[i];return storage[id].data.push({slide:indices,events:[],duration:0}),storage[id].data[storage[id].data.length-1]}function getSlideDuration(indices){indices=indices||slideIndices;for(var duration=0,id=0;id<2;id++)for(var i=0;i<storage[id].data.length;i++)if(storage[id].data[i].slide.h===indices.h&&storage[id].data[i].slide.v===indices.v&&storage[id].data[i].slide.f===indices.f){duration=Math.max(duration,storage[id].data[i].duration);break}return duration}var printMode=/print-pdf/gi.test(window.location.search);function createPrintout(){var patImg;console.warn(Reveal.getTotalSlides(),Reveal.getSlidesElement()),0!=storage[1].data.length&&(console.log("Create printout(s) for "+storage[1].data.length+" slides"),drawingCanvas[0].container.style.opacity=0,drawingCanvas[0].container.style.visibility="hidden",(patImg=new Image).onload=function(){for(var slides=(()=>{for(var horizontal=document.querySelectorAll(".slides > div.pdf-page > section, .slides > section"),slides=[],slidenumber=void 0,i=0;i<horizontal.length;i++)if(horizontal[i].parentElement.classList.contains("pdf-page"))horizontal[i].getAttribute("data-slide-number")!=slidenumber?(slides.push([]),slides[slides.length-1].push(horizontal[i]),slidenumber=horizontal[i].getAttribute("data-slide-number")):slides[slides.length-1][slides[slides.length-1].length-1]=horizontal[i];else for(var vertical=horizontal[i].querySelectorAll("section"),slidenumber=(slides.push([]),void 0),j=0;j<vertical.length;j++)vertical[j].getAttribute("data-slide-number")!=slidenumber?(slides[slides.length-1].push(vertical[j]),slidenumber=vertical[j].getAttribute("data-slide-number")):slides[slides.length-1][slides[slides.length-1].length-1]=vertical[j];return slides})(),i=storage[1].data.length-1;0<=i;i--){console.log("Create printout for slide "+storage[1].data[i].slide.h+"."+storage[1].data[i].slide.v);var drawings=((slideData,patImg)=>{var width=Reveal.getConfig().width,height=Reveal.getConfig().height,scale=1,xOffset=0,yOffset=0,drawings=(width==storage[1].width&&height==storage[1].height||(scale=Math.min(width/storage[1].width,height/storage[1].height),xOffset=(width-storage[1].width*scale)/2,yOffset=(height-storage[1].height*scale)/2),mode=1,board=0,console.log("Create printout(s) for slide ",slideData),[]),template=document.createElement("canvas"),imgCtx=(template.width=width,template.height=height,template.getContext("2d"));imgCtx.fillStyle=imgCtx.createPattern(patImg,"repeat"),imgCtx.rect(0,0,width,height),imgCtx.fill();for(var j=0;j<slideData.events.length;j++)switch(slideData.events[j].type){case"draw":for(var k=1;k<slideData.events[j].curve.length;k++)draw[1](getCanvas(template,drawings,board).getContext("2d"),xOffset+slideData.events[j].curve[k-1].x*scale,yOffset+slideData.events[j].curve[k-1].y*scale,xOffset+slideData.events[j].curve[k].x*scale,yOffset+slideData.events[j].curve[k].y*scale);break;case"erase":for(k=0;k<slideData.events[j].curve.length;k++)eraseWithSponge(getCanvas(template,drawings,board).getContext("2d"),xOffset+slideData.events[j].curve[k].x*scale,yOffset+slideData.events[j].curve[k].y*scale);break;case"setcolor":setColor(slideData.events[j].index);break;case"setboard":setBoard(slideData.events[j].index);break;case"clear":getCanvas(template,drawings,board).getContext("2d").clearRect(0,0,width,height),getCanvas(template,drawings,board).getContext("2d").fill()}return drawings=drawings.sort((a,b)=>a.board>b.board?1:-1),mode=0,drawings})(getSlideData(storage[1].data[i].slide,1),patImg);((slide,drawings)=>{for(var parent=slide.parentElement.parentElement,nextSlide=slide.parentElement.nextElementSibling,i=0;i<drawings.length;i++){var newPDFPage=document.createElement("div");newPDFPage.classList.add("pdf-page"),newPDFPage.style.height=Reveal.getConfig().height,newPDFPage.append(drawings[i].canvas),null!=nextSlide?parent.insertBefore(newPDFPage,nextSlide):parent.append(newPDFPage)}})(slides[storage[1].data[i].slide.h][storage[1].data[i].slide.v],drawings)}},patImg.src=background[1])}function getCanvas(template,container,board){var newCanvas,context,idx=container.findIndex(element=>element.board===board);return-1===idx&&(template=template,newCanvas=document.createElement("canvas"),context=newCanvas.getContext("2d"),newCanvas.width=template.width,newCanvas.height=template.height,context.drawImage(template,0,0),context=newCanvas,container.length?board<container[0].board?(idx=0,container.unshift({board:board,canvas:context})):board>container[container.length-1].board&&(idx=container.length,container.push({board:board,canvas:context})):(idx=0,container.push({board:board,canvas:context}))),container[idx].canvas}function drawWithBoardmarker(context,fromX,fromY,toX,toY){context.lineWidth=boardmarkerWidth,context.lineCap="round",context.strokeStyle=boardmarkers[color[mode]].color,context.beginPath(),context.moveTo(fromX,fromY),context.lineTo(toX,toY),context.stroke()}function drawWithChalk(context,fromX,fromY,toX,toY){for(var xRandom,yCurrent,brushDiameter=chalkWidth,length=(context.lineWidth=brushDiameter,context.lineCap="round",context.fillStyle=chalks[color[mode]].color,context.strokeStyle=chalks[color[mode]].color,context.strokeStyle=context.strokeStyle.replace(/[\d\.]+\)$/g,"1)"),context.beginPath(),context.moveTo(fromX,fromY),context.lineTo(toX,toY),context.stroke(),Math.round(Math.sqrt(Math.pow(toX-fromX,2)+Math.pow(toY-fromY,2))/(5/brushDiameter))),xUnit=(toX-fromX)/length,yUnit=(toY-fromY)/length,i=0;i<length;i++)chalkEffect>.9*Math.random()&&(yCurrent=fromY+i*yUnit,xRandom=fromX+i*xUnit+(Math.random()-.5)*brushDiameter*1.2,yCurrent=yCurrent+(Math.random()-.5)*brushDiameter*1.2,context.clearRect(xRandom,yCurrent,2*Math.random()+2,Math.random()+1))}function eraseWithSponge(context,x,y){context.save(),context.beginPath(),context.arc(x,y,eraser.radius,0,2*Math.PI,!1),context.clip(),context.clearRect(x-eraser.radius-1,y-eraser.radius-1,2*eraser.radius+2,2*eraser.radius+2),context.restore(),1==mode&&grid&&((centerX,centerY,diameter)=>{for(var context=drawingCanvas[1].context,scale=(drawingCanvas[1].scale=Math.min(drawingCanvas[1].width/storage[1].width,drawingCanvas[1].height/storage[1].height),drawingCanvas[1].xOffset=(drawingCanvas[1].width-storage[1].width*drawingCanvas[1].scale)/2,drawingCanvas[1].yOffset=(drawingCanvas[1].height-storage[1].height*drawingCanvas[1].scale)/2,drawingCanvas[1].scale),distance=(drawingCanvas[1].xOffset,drawingCanvas[1].yOffset,grid.distance*scale),fromX=drawingCanvas[1].width/2-distance/2-Math.floor((drawingCanvas[1].width-distance)/2/distance)*distance,x=fromX+distance*Math.ceil((centerX-diameter-fromX)/distance);x<=fromX+distance*Math.floor((centerX+diameter-fromX)/distance);x+=distance)context.beginPath(),context.lineWidth=grid.width*scale,context.lineCap="round",context.fillStyle=grid.color,context.strokeStyle=grid.color,context.moveTo(x,centerY-Math.sqrt(diameter*diameter-(centerX-x)*(centerX-x))),context.lineTo(x,centerY+Math.sqrt(diameter*diameter-(centerX-x)*(centerX-x))),context.stroke();for(var fromY=drawingCanvas[1].height/2-distance/2-Math.floor((drawingCanvas[1].height-distance)/2/distance)*distance,y=fromY+distance*Math.ceil((centerY-diameter-fromY)/distance);y<=fromY+distance*Math.floor((centerY+diameter-fromY)/distance);y+=distance)context.beginPath(),context.lineWidth=grid.width*scale,context.lineCap="round",context.fillStyle=grid.color,context.strokeStyle=grid.color,context.moveTo(centerX-Math.sqrt(diameter*diameter-(centerY-y)*(centerY-y)),y),context.lineTo(centerX+Math.sqrt(diameter*diameter-(centerY-y)*(centerY-y)),y),context.stroke()})(x,y,eraser.radius)}function showChalkboard(){clearTimeout(touchTimeout),touchTimeout=null,drawingCanvas[0].sponge.style.visibility="hidden",drawingCanvas[1].sponge.style.visibility="hidden",drawingCanvas[1].container.style.opacity=1,drawingCanvas[1].container.style.visibility="visible",mode=1}function closeChalkboard(){clearTimeout(touchTimeout),touchTimeout=null,drawingCanvas[0].sponge.style.visibility="hidden",drawingCanvas[1].sponge.style.visibility="hidden",drawingCanvas[1].container.style.opacity=0,drawingCanvas[1].container.style.visibility="hidden",event=yLast=xLast=null,mode=0}function clearCanvas(id){0==id&&clearTimeout(slidechangeTimeout),drawingCanvas[id].context.clearRect(0,0,drawingCanvas[id].width,drawingCanvas[id].height),1==id&&grid&&drawGrid()}function drawGrid(){for(var context=drawingCanvas[1].context,scale=(drawingCanvas[1].scale=Math.min(drawingCanvas[1].width/storage[1].width,drawingCanvas[1].height/storage[1].height),drawingCanvas[1].xOffset=(drawingCanvas[1].width-storage[1].width*drawingCanvas[1].scale)/2,drawingCanvas[1].yOffset=(drawingCanvas[1].height-storage[1].height*drawingCanvas[1].scale)/2,drawingCanvas[1].scale),distance=(drawingCanvas[1].xOffset,drawingCanvas[1].yOffset,grid.distance*scale),x=drawingCanvas[1].width/2-distance/2-Math.floor((drawingCanvas[1].width-distance)/2/distance)*distance;x<drawingCanvas[1].width;x+=distance)context.beginPath(),context.lineWidth=grid.width*scale,context.lineCap="round",context.fillStyle=grid.color,context.strokeStyle=grid.color,context.moveTo(x,0),context.lineTo(x,drawingCanvas[1].height),context.stroke();for(var y=drawingCanvas[1].height/2-distance/2-Math.floor((drawingCanvas[1].height-distance)/2/distance)*distance;y<drawingCanvas[1].height;y+=distance)context.beginPath(),context.lineWidth=grid.width*scale,context.lineCap="round",context.fillStyle=grid.color,context.strokeStyle=grid.color,context.moveTo(0,y),context.lineTo(drawingCanvas[1].width,y),context.stroke()}function setColor(index,record){index>=boardmarkers[mode].length&&(index=0),color[mode]=index,drawingCanvas[mode].canvas.style.cursor=pens[mode][color[mode]].cursor,record&&(recordEvent({type:"setcolor",index:index,begin:Date.now()-slideStart}),updateStorage())}function setBoard(index,record){(board=>{clearCanvas(1);for(var slideData=getSlideData(slideIndices,1),index=0,play=0==board;index<slideData.events.length&&slideData.events[index].begin<Date.now()-slideStart;)"setboard"==slideData.events[index].type?play=board==slideData.events[index].index:!play&&"setcolor"!=slideData.events[index].type||playEvent(1,slideData.events[index],Date.now()-slideStart),index++})(board=index),record&&(recordEvent({type:"setboard",index:board,begin:Date.now()-slideStart}),updateStorage())}var eventQueue=[];function recordEvent(event){for(var slideData=getSlideData(),i=slideData.events.length;0<i&&event.begin<slideData.events[i-1].begin;)i--;slideData.events.splice(i,0,event),slideData.duration=Math.max(slideData.duration,Date.now()-slideStart)+1}function startPlayback(timestamp,finalMode){slideStart=Date.now()-timestamp,closeChalkboard();for(var id=board=mode=0;id<2;id++){clearCanvas(id);for(var slideData=getSlideData(slideIndices,id),index=0;index<slideData.events.length&&slideData.events[index].begin<Date.now()-slideStart;)playEvent(id,slideData.events[index],timestamp),index++;for(;playback&&index<slideData.events.length;)timeouts[id].push(setTimeout(playEvent,slideData.events[index].begin-(Date.now()-slideStart),id,slideData.events[index],timestamp)),index++}1==(mode=null!=finalMode?finalMode:mode)&&showChalkboard()}function stopPlayback(){for(var id=0;id<2;id++){for(var i=0;i<timeouts[id].length;i++)clearTimeout(timeouts[id][i]);timeouts[id]=[]}}function playEvent(id,event,timestamp){switch(event.type){case"open":timestamp<=event.begin?showChalkboard():mode=1;break;case"close":timestamp<event.begin?closeChalkboard():mode=0;break;case"clear":clearCanvas(id);break;case"setcolor":setColor(event.index);break;case"setboard":setBoard(event.index);break;case"draw":((id,event)=>{if(1<event.curve.length)for(var ctx=drawingCanvas[id].context,scale=drawingCanvas[id].scale,xOffset=drawingCanvas[id].xOffset,yOffset=drawingCanvas[id].yOffset,stepDuration=(event.end-event.begin)/(event.curve.length-1),i=1;i<event.curve.length;i++)event.begin+i*stepDuration<=Date.now()-slideStart?draw[id](ctx,xOffset+event.curve[i-1].x*scale,yOffset+event.curve[i-1].y*scale,xOffset+event.curve[i].x*scale,yOffset+event.curve[i].y*scale):playback&&timeouts.push(setTimeout(draw[id],Math.max(0,event.begin+i*stepDuration-(Date.now()-slideStart)),ctx,xOffset+event.curve[i-1].x*scale,yOffset+event.curve[i-1].y*scale,xOffset+event.curve[i].x*scale,yOffset+event.curve[i].y*scale))})(id,event);break;case"erase":((id,event)=>{if(1<event.curve.length)for(var ctx=drawingCanvas[id].context,scale=drawingCanvas[id].scale,xOffset=drawingCanvas[id].xOffset,yOffset=drawingCanvas[id].yOffset,stepDuration=(event.end-event.begin)/event.curve.length,i=0;i<event.curve.length;i++)event.begin+i*stepDuration<=Date.now()-slideStart?eraseWithSponge(ctx,xOffset+event.curve[i].x*scale,yOffset+event.curve[i].y*scale):playback&&timeouts.push(setTimeout(eraseWithSponge,Math.max(0,event.begin+i*stepDuration-(Date.now()-slideStart)),ctx,xOffset+event.curve[i].x*scale,yOffset+event.curve[i].y*scale))})(id,event)}}function startDrawing(x,y,erase){var ctx=drawingCanvas[mode].context,scale=drawingCanvas[mode].scale,xOffset=drawingCanvas[mode].xOffset,yOffset=drawingCanvas[mode].yOffset;xLast=x*scale+xOffset,yLast=y*scale+yOffset,1==erase?(event={type:"erase",begin:Date.now()-slideStart,end:null,curve:[{x:x,y:y}]},drawingCanvas[mode].canvas.style.cursor='url("'+eraser.src+'") '+eraser.radius+" "+eraser.radius+", auto",eraseWithSponge(ctx,x*scale+xOffset,y*scale+yOffset)):event={type:"draw",begin:Date.now()-slideStart,end:null,curve:[{x:x,y:y}]}}function showSponge(x,y){var message;event&&(event.type="erase",event.begin=Date.now()-slideStart,drawingCanvas[mode].sponge.style.left=x-eraser.radius+"px",drawingCanvas[mode].sponge.style.top=y-eraser.radius+"px",drawingCanvas[mode].sponge.style.visibility="visible",eraseWithSponge(drawingCanvas[mode].context,x,y),(message=new CustomEvent(messageType)).content={sender:"chalkboard-plugin",type:"startErasing",timestamp:Date.now()-slideStart,x:(mouseX-xOffset)/scale,y:(mouseY-yOffset)/scale},document.dispatchEvent(message))}function drawSegment(x,y,erase){var ctx=drawingCanvas[mode].context,scale=drawingCanvas[mode].scale,xOffset=drawingCanvas[mode].xOffset,yOffset=drawingCanvas[mode].yOffset;event||startDrawing(x,y,erase),event.curve.push({x:x,y:y}),y*scale+yOffset<drawingCanvas[mode].height&&x*scale+xOffset<drawingCanvas[mode].width&&(erase?eraseWithSponge(ctx,x*scale+xOffset,y*scale+yOffset):draw[mode](ctx,xLast,yLast,x*scale+xOffset,y*scale+yOffset),xLast=x*scale+xOffset,yLast=y*scale+yOffset)}function stopDrawing(){event&&(event.end=Date.now()-slideStart,("erase"==event.type||1<event.curve.length)&&(recordEvent(event),updateStorage()),event=null)}function toggleChalkboard(){var message,idx;1==mode?(event=null,readOnly||(recordEvent({type:"close",begin:Date.now()-slideStart}),updateStorage()),closeChalkboard(),(message=new CustomEvent(messageType)).content={sender:"chalkboard-plugin",type:"closeChalkboard",timestamp:Date.now()-slideStart},document.dispatchEvent(message)):(showChalkboard(),readOnly||(recordEvent({type:"open",begin:Date.now()-slideStart}),(message=new CustomEvent(messageType)).content={sender:"chalkboard-plugin",type:"showChalkboard",timestamp:Date.now()-slideStart},document.dispatchEvent(message),idx=0,setColor(idx=rememberColor[mode]?color[mode]:idx,!0),(message=new CustomEvent(messageType)).content={sender:"chalkboard-plugin",type:"setcolor",timestamp:Date.now()-slideStart,index:idx},document.dispatchEvent(message)))}function clear(){var message;readOnly||(recordEvent({type:"clear",begin:Date.now()-slideStart}),clearCanvas(mode),(message=new CustomEvent(messageType)).content={sender:"chalkboard-plugin",type:"clear",timestamp:Date.now()-slideStart},document.dispatchEvent(message))}function colorIndex(idx){var message;readOnly||(setColor(idx,!0),(message=new CustomEvent(messageType)).content={sender:"chalkboard-plugin",type:"setcolor",timestamp:Date.now()-slideStart,index:idx},document.dispatchEvent(message))}function resetSlide(force){var slideData;(force||confirm("Please confirm to delete chalkboard drawings on this slide!"))&&(stopPlayback(),slideStart=Date.now(),event=null,closeChalkboard(),clearCanvas(0),clearCanvas(1),mode=1,(slideData=getSlideData()).duration=0,slideData.events=[],mode=0,(slideData=getSlideData()).duration=0,slideData.events=[],updateStorage(),(slideData=new CustomEvent(messageType)).content={sender:"chalkboard-plugin",type:"resetSlide",timestamp:Date.now()-slideStart},document.dispatchEvent(slideData))}for(key in document.addEventListener("received",function(message){message.content&&"chalkboard-plugin"==message.content.sender&&eventQueue.push(message),1==eventQueue.length&&function processQueue(){var message=eventQueue.shift();slideStart=Date.now()-message.content.timestamp;switch(message.content.type){case"showChalkboard":showChalkboard();break;case"closeChalkboard":closeChalkboard();break;case"startDrawing":startDrawing(message.content.x,message.content.y,message.content.erase);break;case"startErasing":message.content&&(message.content.type="erase",message.content.begin=Date.now()-slideStart,eraseWithSponge(drawingCanvas[mode].context,message.content.x,message.content.y));break;case"drawSegment":drawSegment(message.content.x,message.content.y,message.content.erase);break;case"stopDrawing":stopDrawing();break;case"clear":clear();break;case"setcolor":setColor(message.content.index,!0);break;case"setboard":setBoard(message.content.index,!0);break;case"resetSlide":resetSlide(!0);break;case"init":storage=message.content.storage;for(var id=0;id<2;id++)drawingCanvas[id].scale=Math.min(drawingCanvas[id].width/storage[id].width,drawingCanvas[id].height/storage[id].height),drawingCanvas[id].xOffset=(drawingCanvas[id].width-storage[id].width*drawingCanvas[id].scale)/2,drawingCanvas[id].yOffset=(drawingCanvas[id].height-storage[id].height*drawingCanvas[id].scale)/2;clearCanvas(0),clearCanvas(1),playback||(slidechangeTimeout=setTimeout(startPlayback,transition,getSlideDuration(),0)),1==mode&&0==message.content.mode&&setTimeout(closeChalkboard,transition+50),0==mode&&1==message.content.mode&&setTimeout(showChalkboard,transition+50),mode=message.content.mode}(0<eventQueue.length?processQueue:updateStorage)()}()}),document.addEventListener("welcome",function(user){var message=new CustomEvent(messageType);message.content={sender:"chalkboard-plugin",recipient:user.id,type:"init",timestamp:Date.now()-slideStart,storage:storage,mode:mode},document.dispatchEvent(message)}),document.addEventListener("seekplayback",function(event){stopPlayback(),playback&&0!=event.timestamp||startPlayback(event.timestamp)}),document.addEventListener("startplayback",function(event){stopPlayback(),playback=!0,startPlayback(event.timestamp)}),document.addEventListener("stopplayback",function(event){playback=!1,stopPlayback()}),document.addEventListener("startrecording",function(event){resetSlide(!0),slideStart=Date.now()}),document.addEventListener("touchstart",function(evt){var scale,xOffset,yOffset,touch;readOnly||evt.target.getAttribute("data-chalkboard")!=mode||(scale=drawingCanvas[mode].scale,xOffset=drawingCanvas[mode].xOffset,yOffset=drawingCanvas[mode].yOffset,evt.preventDefault(),touch=evt.touches[0],startDrawing(((mouseX=touch.pageX)-xOffset)/scale,((mouseY=touch.pageY)-yOffset)/scale,!1),(touch=new CustomEvent(messageType)).content={sender:"chalkboard-plugin",type:"startDrawing",timestamp:Date.now()-slideStart,x:(mouseX-xOffset)/scale,y:(mouseY-yOffset)/scale,erase:!1},document.dispatchEvent(touch),touchTimeout=setTimeout(showSponge,500,mouseX,mouseY))},!!passiveSupported&&{passive:!1}),document.addEventListener("touchmove",function(evt){var scale,xOffset,yOffset,touch;clearTimeout(touchTimeout),touchTimeout=null,event&&(scale=drawingCanvas[mode].scale,xOffset=drawingCanvas[mode].xOffset,yOffset=drawingCanvas[mode].yOffset,touch=evt.touches[0],mouseX=touch.pageX,(mouseY=touch.pageY)<drawingCanvas[mode].height&&mouseX<drawingCanvas[mode].width&&(evt.preventDefault(),"erase"==event.type)&&(drawingCanvas[mode].sponge.style.left=mouseX-eraser.radius+"px",drawingCanvas[mode].sponge.style.top=mouseY-eraser.radius+"px"),drawSegment((mouseX-xOffset)/scale,(mouseY-yOffset)/scale,"erase"==event.type),(touch=new CustomEvent(messageType)).content={sender:"chalkboard-plugin",type:"drawSegment",timestamp:Date.now()-slideStart,x:(mouseX-xOffset)/scale,y:(mouseY-yOffset)/scale,erase:"erase"==event.type},document.dispatchEvent(touch))},!1),document.addEventListener("touchend",function(evt){clearTimeout(touchTimeout),touchTimeout=null,drawingCanvas[mode].sponge.style.visibility="hidden",stopDrawing();var message=new CustomEvent(messageType);message.content={sender:"chalkboard-plugin",timestamp:Date.now()-slideStart,type:"stopDrawing"},document.dispatchEvent(message)},!1),document.addEventListener("mousedown",function(evt){var scale,xOffset,yOffset,message;readOnly||evt.target.getAttribute("data-chalkboard")!=mode||(scale=drawingCanvas[mode].scale,xOffset=drawingCanvas[mode].xOffset,yOffset=drawingCanvas[mode].yOffset,startDrawing(((mouseX=evt.pageX)-xOffset)/scale,((mouseY=evt.pageY)-yOffset)/scale,2==evt.button||1==evt.button),(message=new CustomEvent(messageType)).content={sender:"chalkboard-plugin",type:"startDrawing",timestamp:Date.now()-slideStart,x:(mouseX-xOffset)/scale,y:(mouseY-yOffset)/scale,erase:2==evt.button||1==evt.button},document.dispatchEvent(message))}),document.addEventListener("mousemove",function(evt){var scale,xOffset,yOffset,message;event&&(scale=drawingCanvas[mode].scale,xOffset=drawingCanvas[mode].xOffset,yOffset=drawingCanvas[mode].yOffset,drawSegment(((mouseX=evt.pageX)-xOffset)/scale,((mouseY=evt.pageY)-yOffset)/scale,"erase"==event.type),(message=new CustomEvent(messageType)).content={sender:"chalkboard-plugin",type:"drawSegment",timestamp:Date.now()-slideStart,x:(mouseX-xOffset)/scale,y:(mouseY-yOffset)/scale,erase:"erase"==event.type},document.dispatchEvent(message))}),document.addEventListener("mouseup",function(evt){var message;drawingCanvas[mode].canvas.style.cursor=pens[mode][color[mode]].cursor,event&&(stopDrawing(),(message=new CustomEvent(messageType)).content={sender:"chalkboard-plugin",type:"stopDrawing",timestamp:Date.now()-slideStart},document.dispatchEvent(message))}),window.addEventListener("resize",function(){var timestamp=Date.now()-slideStart;playback||(timestamp=getSlideDuration());for(var id=0;id<2;id++)drawingCanvas[id].width=window.innerWidth,drawingCanvas[id].height=window.innerHeight,drawingCanvas[id].canvas.width=drawingCanvas[id].width,drawingCanvas[id].canvas.height=drawingCanvas[id].height,drawingCanvas[id].context.canvas.width=drawingCanvas[id].width,drawingCanvas[id].context.canvas.height=drawingCanvas[id].height,drawingCanvas[id].scale=Math.min(drawingCanvas[id].width/storage[id].width,drawingCanvas[id].height/storage[id].height),drawingCanvas[id].xOffset=(drawingCanvas[id].width-storage[id].width*drawingCanvas[id].scale)/2,drawingCanvas[id].yOffset=(drawingCanvas[id].height-storage[id].height*drawingCanvas[id].scale)/2;startPlayback(timestamp,mode)}),Reveal.addEventListener("ready",function(evt){var event;printMode?(console.log("Create printouts when ready"),whenReady(createPrintout)):(slideStart=Date.now()-getSlideDuration(),slideIndices=Reveal.getIndices(),playback||startPlayback(getSlideDuration(),0),Reveal.isAutoSliding()&&((event=new CustomEvent("startplayback")).timestamp=0,document.dispatchEvent(event)),updateStorage())}),Reveal.addEventListener("slidechanged",function(evt){var event;printMode||(slideStart=Date.now()-getSlideDuration(),slideIndices=Reveal.getIndices(),closeChalkboard(),clearCanvas(0),clearCanvas(1),playback||(slidechangeTimeout=setTimeout(startPlayback,transition,getSlideDuration(),0)),Reveal.isAutoSliding()&&((event=new CustomEvent("startplayback")).timestamp=0,document.dispatchEvent(event)),updateStorage())}),Reveal.addEventListener("fragmentshown",function(evt){var event;printMode||(slideStart=Date.now()-getSlideDuration(),slideIndices=Reveal.getIndices(),closeChalkboard(),clearCanvas(0),clearCanvas(1),Reveal.isAutoSliding()?((event=new CustomEvent("startplayback")).timestamp=0,document.dispatchEvent(event)):playback||startPlayback(getSlideDuration(),0))}),Reveal.addEventListener("fragmenthidden",function(evt){printMode||(slideStart=Date.now()-getSlideDuration(),slideIndices=Reveal.getIndices(),closeChalkboard(),clearCanvas(0),clearCanvas(1),Reveal.isAutoSliding()?document.dispatchEvent(new CustomEvent("stopplayback")):playback||(startPlayback(getSlideDuration()),closeChalkboard()))}),Reveal.addEventListener("autoslideresumed",function(evt){var event=new CustomEvent("startplayback");event.timestamp=0,document.dispatchEvent(event)}),Reveal.addEventListener("autoslidepaused",function(evt){document.dispatchEvent(new CustomEvent("stopplayback")),startPlayback(getSlideDuration(),0)}),this.toggleNotesCanvas=function(){var idx,message;readOnly||(1==mode?(toggleChalkboard(),notescanvas.style.background=background[0],notescanvas.style.pointerEvents="auto"):"none"!=notescanvas.style.pointerEvents?(colorButtons&&(notescanvas.querySelector(".palette").style.visibility="hidden"),event=null,notescanvas.style.background="rgba(0,0,0,0)",notescanvas.style.pointerEvents="none"):(colorButtons&&(notescanvas.querySelector(".palette").style.visibility="visible"),notescanvas.style.background=background[0],notescanvas.style.pointerEvents="auto",idx=0,setColor(idx=color[mode]?color[mode]:idx,!0),(message=new CustomEvent(messageType)).content={sender:"chalkboard-plugin",type:"setcolor",timestamp:Date.now()-slideStart,index:idx},document.dispatchEvent(message)))},this.toggleChalkboard=toggleChalkboard,this.colorIndex=colorIndex,this.colorNext=function(){var idx,message;readOnly||(color[mode]=(color[mode]+1)%pens[mode].length,setColor(idx=color[mode],!0),(message=new CustomEvent(messageType)).content={sender:"chalkboard-plugin",type:"setcolor",timestamp:Date.now()-slideStart,index:idx},document.dispatchEvent(message))},this.colorPrev=function(){var idx,message;readOnly||(color[mode]=(color[mode]+(pens[mode].length-1))%pens[mode].length,setColor(idx=color[mode],!0),(message=new CustomEvent(messageType)).content={sender:"chalkboard-plugin",type:"setcolor",timestamp:Date.now()-slideStart,index:idx},document.dispatchEvent(message))},this.clear=clear,this.reset=resetSlide,this.resetAll=function(force){var message;(force||confirm("Please confirm to delete all chalkboard drawings!"))&&(stopPlayback(),slideStart=Date.now(),clearCanvas(0),clearCanvas(1),1==mode&&(event=null,closeChalkboard()),storage=[{width:Reveal.getConfig().width,height:Reveal.getConfig().height,data:[]},{width:Reveal.getConfig().width,height:Reveal.getConfig().height,data:[]}],config.storage&&sessionStorage.setItem(config.storage,null),(message=new CustomEvent(messageType)).content={sender:"chalkboard-plugin",type:"init",timestamp:Date.now()-slideStart,storage:storage,mode:mode},document.dispatchEvent(message))},this.download=function(){var a=document.createElement("a");document.body.appendChild(a);try{a.download="chalkboard.json";var blob=new Blob([getData()],{type:"application/json"});a.href=window.URL.createObjectURL(blob)}catch(error){a.innerHTML+=" ("+error+")"}a.click(),document.body.removeChild(a)},this.updateStorage=updateStorage,this.getData=getData,this.configure=configure,keyBindings)keyBindings[key]&&Reveal.addKeyBinding(keyBindings[key],RevealChalkboard[key]);return this};