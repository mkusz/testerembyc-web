<!DOCTYPE html>
<html lang="pl" prefix="og: http://ogp.me/ns#">
<head>
<meta content="#FF0000" name="theme-color">
<meta charset="utf-8">
<meta content="Potgi Pythona cig dalszy" name="description">
<meta content="width=device-width, initial-scale=1" name="viewport">
<title>Jeszcze mniejszy framework do test贸w w Pythonie | testerembyc.pl</title>
<link href="../../assets/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/rst.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/baguetteBox.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/theme.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/latolatinfonts.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/blog.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/fa.css" rel="stylesheet" type="text/css">
<link href="../../rss.xml" rel="alternate" title="RSS" type="application/rss+xml">
<link href="https://testerembyc.pl/posts/jeszcze-mniejszy-framework-do-testow-w-pythonie/" rel="canonical">
<link href="../../images/icons/icon_16x16.png" rel="icon" sizes="16x16">
<link href="../../images/icons/icon_32x32.png" rel="icon" sizes="32x32">
<link href="../../images/icons/icon_64x64.png" rel="icon" sizes="64x64">
<link href="../../images/icons/icon_128x128.png" rel="icon" sizes="128x128">
<link href="../../images/icons/icon_256x256.png" rel="icon" sizes="256x256">
<link href="../../images/icons/icon_512x512.png" rel="icon" sizes="512x512"><!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]-->
<meta content="Potgi Pythona cig dalszy" itemprop="description" name="description">
<meta content="Maciej Kusz" name="author">
<link href="../najmniejszy-framework-do-testow-w-pythonie/" rel="prev" title="Najmniejszy framework do test贸w w Pythonie" type="text/html">
<link href="../vlog-001-plany-vs-rzeczywistosc/" rel="next" title="Plany vs. rzeczywisto [vlog 001]" type="text/html">
<meta content="testerembyc.pl" property="og:site_name">
<meta content="Jeszcze mniejszy framework do test贸w w Pythonie" property="og:title">
<meta content="https://testerembyc.pl/posts/jeszcze-mniejszy-framework-do-testow-w-pythonie/" property="og:url">
<meta content="Potgi Pythona cig dalszy" property="og:description">
<meta content="https://testerembyc.pl/images/posts/jeszcze-mniejszy-framework-do-testow-w-pythonie_social.jpg" property="og:image">
<meta content="article" property="og:type">
<meta content="2021-01-06T20:53:56+01:00" property="article:published_time">
<meta content="lambda" property="article:tag">
<meta content="requests" property="article:tag">
<meta content="unittest" property="article:tag">
<meta content="summary" name="twitter:card">
<meta content="@website" name="twitter:site">
<meta content="@username" name="twitter:creator">
</head>
<body>
<a class="sr-only sr-only-focusable" href="#content">Przejd藕 do treci</a> <!-- Menubar -->
<div class="blog-masthead">
<div class="container"><!-- This keeps the margins nice -->
<div class="blog-header">
<h1 class="blog-title"><a href="https://testerembyc.pl/"><img alt="testerembyc.pl" id="logo" src="../../images/testerembyc_logo.svg"><span id="blog-title">testerembyc.pl</span></a></h1>
<!-- <p class="lead blog-description">Czyli blog o tym, jak to jest by nie tylko testerem</p> # Original one -->
<p class="lead blog-description">Czyli blog o tym, jak to jest by nie tylko <span>testerem</span></p>
</div>
<nav class="blog-nav" role="navigation"><a class="blog-nav-item" href="../../"><img height="16" src="../../images/icons/icon.svg" title="Strona g贸wna" width="16"><span>Strona&nbsp;g贸wna</span></a> <a class="blog-nav-item" href="../../pages/python-kompendium"><i class="fab fa-python" title="Python"></i><span>Python</span></a> <a class="blog-nav-item" href="../../categories/youtube"><i class="fab fa-youtube" title="YouTube"></i><span>YouTube</span></a> <a class="blog-nav-item" href="../../categories/"><i class="fas fa-tags" title="Tagi i kategorie"></i><span>Tagi&nbsp;i&nbsp;kategorie</span></a> <a class="blog-nav-item" href="../../archive.html"><i class="fas fa-archive" title="Archiwum"></i><span>Archiwum</span></a> <a class="blog-nav-item" href="../../pages/o-mnie/"><i class="fas fa-user" title="O mnie"></i><span>O&nbsp;mnie</span></a> <a class="blog-nav-item" href="../../rss.xml"><i class="fas fa-rss" title="RSS"></i><span>RSS</span></a></nav>
<!-- START Bootstrap-Cookie-Alert -->
<div class="alert text-center cookiealert" role="alert">
<p><b>Lubisz ciasteczka?</b> </p>
<p>U偶ywam ich, aby dostarczy Ci lepszych treci. Chcesz wiedzie wicej? <a href="../../pages/polityka-prywatnosci/" target="_blank">Kliknij tu.</a></p>
<p><button class="btn btn-danger btn-sm acceptcookies" type="button">Lubi i akceptuj ciasteczka</button></p>
</div>
<!-- END Bootstrap-Cookie-Alert -->
<div class="body-content"><!--Body content-->
<div class="row">
<div class="col-sm-9 blog-main">
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h2 class="p-name entry-title blog-post-title" itemprop="headline name"><a class="u-url" href=".">Jeszcze mniejszy framework do test贸w w Pythonie</a></h2>
<div class="metadata blog-post-meta">
<p class="byline author vcard"><span class="byline-name fn">Maciej Kusz</span></p>
<p class="dateline"><a href="." rel="bookmark"><time class="published dt-published" datetime="2021-01-06T20:53:56+01:00" itemprop="datePublished" title="2021-01-06 20:53">2021-01-06 20:53</time></a></p>
<p class="commentline"><a data-disqus-identifier="cache/posts/jeszcze-mniejszy-framework-do-testow-w-pythonie.html" href="#disqus_thread">Komentarze</a></p>
<meta content="Potgi Pythona cig dalszy" itemprop="description" name="description">
<p></p></div>
</header>
<div class="e-content entry-content" itemprop="articleBody text">
<div>
<p class="caption"><a href="../jeszcze-mniejszy-framework-do-testow-w-pythonie"><img alt="Jeszcze mniejszy framework do test贸w w Pythonie" src="../../images/posts/jeszcze-mniejszy-framework-do-testow-w-pythonie.jpg"></a> Wykorzystano zdjcie autorstwa <a href="https://www.pexels.com/pl-pl/@markusspiske">Markus Spiske</a> z <a href="https://www.pexels.com/">Pexels</a></p>
<p>Poni偶szy wpis jest kontynuacj poprzedniego wpisu, gdzie pr贸bowaem pokaza Ci jak w Pythonie mo偶na stworzy <a href="../najmniejszy-framework-do-testow-w-pythonie">najmniejszy framework do test贸w</a>.</p>
<p>Czym si dzisiaj wsp贸lnie zajmiemy?</p>
<p>Ot贸偶 odpowiemy sobie na 2 pytania:</p>
<ul>
<li>Czy aby na pewno 16 linijek kodu, to najmniejsza mo偶liwa ilo?</li>
<li>Czy da si w tych 16 linijkach kodu stworzy bardziej rozbudowany framework?</li>
</ul>
<p>Odpowiedzi na te pytania zapewne si domylasz, ale jeli chcesz wiedzie jak, to nie pozostaje Ci nic innego jak zagbi si w dalsz cz tego wpisu.</p>
<!-- more -->
<div class="toc">
<ul>
<li><a href="#gdzie-skonczylismy">Gdzie skoczylimy?</a>
<ul>
<li><a href="#w-pogoni-za-rozumem">W pogoni za rozumem</a></li>
<li><a href="#kosmetyka">Kosmetyka</a></li>
<li><a href="#wyrazenia-lambda">Wyra偶enia Lambda</a></li>
<li><a href="#lambda-po-raz-pierwszy">Lambda po raz pierwszy</a></li>
<li><a href="#lambda-po-raz-drugi">Lambda po raz drugi</a></li>
<li><a href="#type">type</a></li>
<li><a href="#dict-comprehension">dict comprehension</a></li>
<li><a href="#najmniejszy-framework">Najmniejszy framework</a></li>
</ul>
</li>
<li><a href="#wiecej-funkcjonalnosci">Wicej funkcjonalnoci</a>
<ul>
<li><a href="#wiecej-testow-w-tescie">Wicej test贸w w tecie</a></li>
<li><a href="#glob">glob</a></li>
<li><a href="#globals">globals()</a></li>
<li><a href="#obsuga-wielu-plikow-json">Obsuga wielu plik贸w json</a></li>
</ul>
</li>
<li><a href="#podsumowanie">Podsumowanie</a></li>
<li><a href="#bonus">Bonus</a></li>
<li><a href="#bonus-2">Bonus 2</a></li>
</ul>
</div>
<h2 id="gdzie-skonczylismy">Gdzie skoczylimy?</h2>
<p>Dla maego przypomnienia zacznijmy w miejscu, gdzie skoczylimy. Kod naszego mini frameworka wyglda tak:</p>
<pre class="code literal-block"><span class="kn">import</span> <span class="nn">unittest</span><span class="o">,</span> <span class="nn">xmlrunner</span><span class="o">,</span> <span class="nn">json</span><span class="o">,</span> <span class="nn">requests</span>

<span class="k">class</span> <span class="nc">Tests</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span> <span class="k">pass</span>

<span class="k">def</span> <span class="nf">add_test</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">abstract_test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">requests</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="o">**</span><span class="n">data</span><span class="p">[</span><span class="s1">'request'</span><span class="p">])</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s1">'assert'</span><span class="p">][</span><span class="s1">'statusCode'</span><span class="p">])</span>
    <span class="nb">setattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">abstract_test</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'tests.json'</span><span class="p">,</span> <span class="s1">'r'</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">test_name</span><span class="p">,</span> <span class="n">test_data</span> <span class="ow">in</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">json_file</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">add_test</span><span class="p">(</span><span class="n">Tests</span><span class="p">,</span> <span class="n">test_name</span><span class="p">,</span> <span class="n">test_data</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="n">testRunner</span><span class="o">=</span><span class="n">xmlrunner</span><span class="o">.</span><span class="n">XMLTestRunner</span><span class="p">())</span>
</pre>
<h3 id="w-pogoni-za-rozumem">W pogoni za rozumem</h3>
<h3 id="kosmetyka">Kosmetyka</h3>
<p>P贸ki co nasz kod jest w miar czytelny, pomimo zamania kilku regu. Skoro i tak je amiemy, to id藕my ciut gbiej i upromy ten kod do poni偶szej postaci.</p>
<pre class="code literal-block"><span class="kn">import</span> <span class="nn">unittest</span><span class="o">,</span> <span class="nn">xmlrunner</span><span class="o">,</span> <span class="nn">json</span><span class="o">,</span> <span class="nn">requests</span>

<span class="k">def</span> <span class="nf">add_test</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">abstract_test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">requests</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="o">**</span><span class="n">data</span><span class="p">[</span><span class="s1">'request'</span><span class="p">])</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s1">'assert'</span><span class="p">][</span><span class="s1">'statusCode'</span><span class="p">])</span>
    <span class="nb">setattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">abstract_test</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'tests.json'</span><span class="p">,</span> <span class="s1">'r'</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
    <span class="k">class</span> <span class="nc">Tests</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span> <span class="k">pass</span>
    <span class="k">for</span> <span class="n">test_name</span><span class="p">,</span> <span class="n">test_data</span> <span class="ow">in</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">json_file</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">add_test</span><span class="p">(</span><span class="n">Tests</span><span class="p">,</span> <span class="n">test_name</span><span class="p">,</span> <span class="n">test_data</span><span class="p">)</span>

<span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="n">testRunner</span><span class="o">=</span><span class="n">xmlrunner</span><span class="o">.</span><span class="n">XMLTestRunner</span><span class="p">())</span>
</pre>
<p>Zmian jest niewiele i to tylko kosmetyka:</p>
<ul>
<li>usunlimy sprawdzanie, z jakiego skryptu jest uruchamiany nasz kod,</li>
<li>przerzucilimy definicj klasy <code>Test</code> do wntrza bloku <code>with open(...)</code>.</li>
</ul>
<p>Powy偶sza kosmetyka redukuj ilo linii kodu do 13.</p>
<p>Patrzc na kod, mo偶emy zauwa偶y, 偶e jednym z wikszych blok贸w jest definicja funkcji <code>add_test</code>. Zastan贸wmy si czy da si co z tym tematem zrobi.</p>
<h3 id="wyrazenia-lambda">Wyra偶enia Lambda</h3>
<p>Zanim jednak bdziemy bardziej odchudza kod frameworku, musimy pozna czym s tzw. <strong>wyra偶enia Lambda</strong> w Pythonie.</p>
<p><strong>Wyra偶enia Lambda</strong> to kr贸tkie, anonimowe funkcje (opisane w <a href="https://www.python.org/dev/peps/pep-0312/">PEP 312</a> oraz <a href="https://docs.python.org/3/tutorial/controlflow.html#lambda-expressions%3E">dokumentacji</a>. Funkcje takie s okrelane jako anonimowe, poniewa偶 zdefiniowane s w miejscu ich u偶ycia. <strong>Funkcje Lambda</strong> mog przyjmowa dowoln liczb argument贸w, ale mog zawiera tylko jedno wyra偶enie. Ale jak dziaa Lambda?</p>
<p>Zacznijmy od czego prostego, czyli suma 2 liczb:</p>
<pre class="code literal-block"><span class="n">add</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
<span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre>
<pre class="code literal-block"><span class="go">4</span>
</pre>
<p>Nic nadzwyczajnego, ale 偶eby tradycji stao si zado, kilka s贸w wyjanienia jak to dziaa:</p>
<ol>
<li>Tworzymy wyra偶enie Lambda, kt贸re przyjmuje dwie zmienne: <code>a</code> i <code>b</code> oraz wykonuje operacj dodawania na tych zmiennych.</li>
<li>Wyra偶enie to przypisujemy do zmiennej <code>add</code>. W tym momencie zmienna <code>add</code> staje si funkcj, kt贸rej ciaem jest wyra偶enie Lambda (opisywaem ten mechanizm we wpisie dotyczcym <a href="../dekoratory-w-pythonie">dekorator贸w</a>, gdzie tumaczyem, 偶e <a href="../dekoratory-w-pythonie#funkcja-jest-obiektem">funkcja jest obiektem</a>.</li>
<li>Wywoujemy tak stworzon funkcj z 2 parametrami. W wyniku wywoania otrzymujemy wynik dodawania.</li>
</ol>
<p>Odpowiednikiem takiego wyra偶enia bdzie poni偶szy kod:</p>
<pre class="code literal-block"><span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>

<span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre>
<pre class="code literal-block"><span class="go">4</span>
</pre>
<p>Zysk niby niewielki, ale zawsze co. A co, gdybymy chcieli osign co ciekawszego? Zobaczmy co si stanie, jak tradycyjna metoda, w wyniku bdzie zwracaa wyra偶enie lambda:</p>
<pre class="code literal-block"><span class="k">def</span> <span class="nf">multiplier</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">return</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span> <span class="o">*</span> <span class="n">n</span>

<span class="n">multiplier_1k</span> <span class="o">=</span> <span class="n">multiplier</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>

<span class="n">multiplier_1k</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre>
<pre class="code literal-block"><span class="go">3000</span>
</pre>
<p>Zaczyna si robi ciekawiej. Zauwa偶, 偶e w ten spos贸b moglibymy bardzo szybko zdefiniowa inne metody np. <code>multiplier_10k = multiplier(10000)</code>, czy te偶 <code>doubler = multiplier(2)</code>. Zaczynasz rozumie z jak pot偶nym narzdziem mamy do czynienia?</p>
<p>Wszystko super, ale jak z tego skorzysta w naszym frameworku?</p>
<h3 id="lambda-po-raz-pierwszy">Lambda po raz pierwszy</h3>
<p>Skoro ju偶 wiemy, 偶e przy u偶yciu wyra偶enia lambda, mo偶na zastpi definicj jakiej metody, to spr贸bujmy to zaimplementowa w naszym kodzie. Jak? Zerknij poni偶ej:</p>
<pre class="code literal-block"><span class="kn">import</span> <span class="nn">unittest</span><span class="o">,</span> <span class="nn">xmlrunner</span><span class="o">,</span> <span class="nn">json</span><span class="o">,</span> <span class="nn">requests</span>

<span class="k">def</span> <span class="nf">add_test</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="nb">setattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">requests</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="o">**</span><span class="n">data</span><span class="p">[</span><span class="s1">'request'</span><span class="p">])</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s1">'assert'</span><span class="p">][</span><span class="s1">'statusCode'</span><span class="p">]))</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'tests.json'</span><span class="p">,</span> <span class="s1">'r'</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
    <span class="k">class</span> <span class="nc">Tests</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span> <span class="k">pass</span>
    <span class="k">for</span> <span class="n">test_name</span><span class="p">,</span> <span class="n">test_data</span> <span class="ow">in</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">json_file</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">add_test</span><span class="p">(</span><span class="n">Tests</span><span class="p">,</span> <span class="n">test_name</span><span class="p">,</span> <span class="n">test_data</span><span class="p">)</span>

<span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="n">testRunner</span><span class="o">=</span><span class="n">xmlrunner</span><span class="o">.</span><span class="n">XMLTestRunner</span><span class="p">())</span>
</pre>
<p>Myl, 偶e zmiany nie wymagaj wikszego komentarza, bo jedyne co tutaj zrobilimy to zastpilimy definicj oraz wywoanie metody <code>abstract_test</code> wyra偶eniem lambda. W wyniku, odchudzilimy nasz kod do 11 linii kodu. Jest nie藕le, ale mo偶e da si lepiej?</p>
<h3 id="lambda-po-raz-drugi">Lambda po raz drugi</h3>
<p>Skoro udao nam si pozby definiowania jednej metody, to mo偶e uda nam si wyrzuci jeszcze jedn?</p>
<pre class="code literal-block"><span class="kn">import</span> <span class="nn">unittest</span><span class="o">,</span> <span class="nn">xmlrunner</span><span class="o">,</span> <span class="nn">json</span><span class="o">,</span> <span class="nn">requests</span>

<span class="n">add_test</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">setattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">requests</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="o">**</span><span class="n">data</span><span class="p">[</span><span class="s1">'request'</span><span class="p">])</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s1">'assert'</span><span class="p">][</span><span class="s1">'statusCode'</span><span class="p">]))</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'tests.json'</span><span class="p">,</span> <span class="s1">'r'</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
    <span class="k">class</span> <span class="nc">Tests</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span> <span class="k">pass</span>
    <span class="k">for</span> <span class="n">test_name</span><span class="p">,</span> <span class="n">test_data</span> <span class="ow">in</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">json_file</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">add_test</span><span class="p">(</span><span class="n">Tests</span><span class="p">,</span> <span class="n">test_name</span><span class="p">,</span> <span class="n">test_data</span><span class="p">)</span>

<span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="n">testRunner</span><span class="o">=</span><span class="n">xmlrunner</span><span class="o">.</span><span class="n">XMLTestRunner</span><span class="p">())</span>
</pre>
<p>Zauwa偶, 偶e dalej pod偶amy utartym schematem. Wykonajmy jeszcze jeden drobny zabieg, a wic przeniemy przypisanie Lambdy do zmiennej w inne miejsce:</p>
<pre class="code literal-block"><span class="kn">import</span> <span class="nn">unittest</span><span class="o">,</span> <span class="nn">xmlrunner</span><span class="o">,</span> <span class="nn">json</span><span class="o">,</span> <span class="nn">requests</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'tests.json'</span><span class="p">,</span> <span class="s1">'r'</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
    <span class="k">class</span> <span class="nc">Tests</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span> <span class="k">pass</span>
    <span class="n">add_test</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">setattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">requests</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="o">**</span><span class="n">data</span><span class="p">[</span><span class="s1">'request'</span><span class="p">])</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s1">'assert'</span><span class="p">][</span><span class="s1">'statusCode'</span><span class="p">]))</span>
    <span class="k">for</span> <span class="n">test_name</span><span class="p">,</span> <span class="n">test_data</span> <span class="ow">in</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">json_file</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">add_test</span><span class="p">(</span><span class="n">Tests</span><span class="p">,</span> <span class="n">test_name</span><span class="p">,</span> <span class="n">test_data</span><span class="p">)</span>

<span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="n">testRunner</span><span class="o">=</span><span class="n">xmlrunner</span><span class="o">.</span><span class="n">XMLTestRunner</span><span class="p">())</span>
</pre>
<p>Odchudzilimy ju偶 nasz kod do 9 linii przy zachowaniu tej samej funkcjonalnoci. Czy to odchudzanie kiedy si skoczy? Tak, ale jeszcze nie w tym momencie. Zauwa偶, 偶e sama definicja klasy <code>Tests</code>, metody testowej <code>add_test</code> oraz jej wielokrotne wywoanie zajmuj a偶 4 linijki kodu. Mo偶e damy rad jeszcze co tutaj pokombinowa?</p>
<h3 id="type">type</h3>
<p>Metoda <code>type</code> to jedna z metod wbudowanych Pythona i nie wymaga importu (jest zawsze dostpna, podobnie jak u偶ywana przez nas metoda <code>setattr</code>). Wikszo os贸b programujcych w Pythonie u偶ywa tej metody do sprawdzania typu obiektu. Nie ka偶dy jednak zdaje sobie spraw, 偶e <code>type</code> mo偶na wykorzysta te偶 w innym celu. <a href="https://docs.python.org/3/library/functions.html?highlight=type#type">type</a> mo偶emy r贸wnie偶 wykorzysta do dynamicznego tworzenia obiekt贸w w Pythonie. Jak to dziaa? To nic skomplikowanego. W obecnym kodzie mamy nastpujc definicj klasy: <code>class Tests(unittest.TestCase): pass</code>. Jest to klasa, dziedziczca po <code>unittest.TestCase</code> oraz nieposiadajca 偶adnych zmiennych, oraz metod. Przy u偶yciu <code>type</code> powy偶sza definicja wygldaaby tak: <code>Tests = type("Tests", (unittest.TestCase,), {})</code>. Co tu si podziao?</p>
<ol>
<li>Przypisanie do zmiennej ju偶 znasz.</li>
<li>Jako pierwszy argument podalimy nazw nowego obiektu.</li>
<li>Jako drugi argument podalimy tuple z obiektami, po jakich dziedziczy nowo tworzony obiekt.</li>
<li>Jako trzeci argument podalimy pusty sownik, poniewa偶 nasza klasa jest 'pusta' (to nie do koca prawda, bo dziedziczy, po innym obiekcie, ale nie wnikajmy w to tutaj).</li>
</ol>
<p>Po podstawieniu do naszego kodu, cay framework wygldaby nastpujco:</p>
<pre class="code literal-block"><span class="kn">import</span> <span class="nn">unittest</span><span class="o">,</span> <span class="nn">xmlrunner</span><span class="o">,</span> <span class="nn">json</span><span class="o">,</span> <span class="nn">requests</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'tests.json'</span><span class="p">,</span> <span class="s1">'r'</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
    <span class="n">Tests</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="s2">"Tests"</span><span class="p">,</span> <span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">,),</span> <span class="p">{})</span>
    <span class="n">add_test</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">setattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">requests</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="o">**</span><span class="n">data</span><span class="p">[</span><span class="s1">'request'</span><span class="p">])</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s1">'assert'</span><span class="p">][</span><span class="s1">'statusCode'</span><span class="p">]))</span>
    <span class="k">for</span> <span class="n">test_name</span><span class="p">,</span> <span class="n">test_data</span> <span class="ow">in</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">json_file</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">add_test</span><span class="p">(</span><span class="n">Tests</span><span class="p">,</span> <span class="n">test_name</span><span class="p">,</span> <span class="n">test_data</span><span class="p">)</span>

<span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="n">testRunner</span><span class="o">=</span><span class="n">xmlrunner</span><span class="o">.</span><span class="n">XMLTestRunner</span><span class="p">())</span>
</pre>
<p>Na razie zysku brak. Cigle mamy 9 linii kodu. Jednak dla wprawnego oka, przyzwyczajonego do kodu pisanego w Pythonie, wida, 偶e co tutaj mo偶emy teraz uproci.</p>
<h3 id="dict-comprehension">dict comprehension</h3>
<p>Zwrot <strong>dict comprehension</strong> nie posiada sensownego tumaczenia (dlatego bd u偶ywa go w oryginale). Czym jest <strong>dict comprehension</strong>? Jest to spos贸b na uproszczenie zapisu, tworzenia sownika z wykorzystaniem ptli <code>for</code>, kt贸ry opisany jest w <a href="https://www.python.org/dev/peps/pep-0274/">PEP 271</a> (istnieje r贸wnie偶 bardzo podobny mechanizm jak <strong>list comprehension</strong>, kt贸ry opisany jest w <a href="https://www.python.org/dev/peps/pep-0202/">PEP 202</a>. W skr贸cie zapis:</p>
<pre class="code literal-block"><span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">,</span> <span class="s2">"c"</span><span class="p">,</span> <span class="s2">"d"</span><span class="p">]</span>
<span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>

<span class="n">new_dict</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">keys</span><span class="p">):</span>
    <span class="n">new_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

<span class="n">new_dict</span>
</pre>
<pre class="code literal-block"><span class="go">{'a': 10, 'b': 20, 'c': 30, 'd': 40}</span>
</pre>
<p>mo偶emy zastpi poprzez zapis:</p>
<pre class="code literal-block"><span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">,</span> <span class="s2">"c"</span><span class="p">,</span> <span class="s2">"d"</span><span class="p">]</span>
<span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>

<span class="n">new_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">keys</span><span class="p">)}</span>

<span class="n">new_dict</span>
</pre>
<pre class="code literal-block"><span class="go">{'a': 10, 'b': 20, 'c': 30, 'd': 40}</span>
</pre>
<p>Oczywicie taka konstrukcja mo偶e by wykorzystywana te偶 w poczeniu z warunkami itp. Ale jak to mo偶e pom贸c w odchudzeniu naszego kodu? Trzymaj si krzesa.</p>
<h3 id="najmniejszy-framework">Najmniejszy framework</h3>
<p>Poskadajmy wic to wszystko w cao:</p>
<pre class="code literal-block"><span class="kn">import</span> <span class="nn">unittest</span><span class="o">,</span> <span class="nn">xmlrunner</span><span class="o">,</span> <span class="nn">json</span><span class="o">,</span> <span class="nn">requests</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'tests.json'</span><span class="p">,</span> <span class="s1">'r'</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
    <span class="n">tests_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
        <span class="n">requests</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="o">**</span><span class="n">data</span><span class="p">[</span><span class="s1">'request'</span><span class="p">])</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s1">'assert'</span><span class="p">][</span><span class="s1">'statusCode'</span><span class="p">]))(</span><span class="n">data</span><span class="p">)</span>
                  <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">json_file</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="p">}</span>
    <span class="n">Tests</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="s2">"Tests"</span><span class="p">,</span> <span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">,),</span> <span class="n">tests_dict</span><span class="p">)</span>

<span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="n">testRunner</span><span class="o">=</span><span class="n">xmlrunner</span><span class="o">.</span><span class="n">XMLTestRunner</span><span class="p">())</span>
</pre>
<p>Jak to dziaa? Przy wykorzystaniu <strong>dict comprehension</strong> stworzylimy sownik <code>tests_dict</code>, kt贸ry zawiera wszystkie metody testowe, kt贸re wczeniej tworzone byy wewntrz ptli <code>for</code>. Pominlimy r贸wnie偶 krok dotyczcy definicji oraz wywoania metody <code>add_test</code>. Nie jest ona w tym momencie konieczna, poniewa偶 przypisujemy metod bezporednio do zmiennej, kt贸ra jest wartoci sownika, przypisan do odpowiedniego klucza w tym sowniku. Tak zdefiniowany sownik wstawiamy do dynamicznie tworzonej klasy.</p>
<p>Powy偶szy kod zosta przedstawiony w ten spos贸b, aby cho troch zachowa jego czytelno. Jeli jednak pozbdziemy si niepotrzebnego formatowania oraz przypisania sownika do zmiennej <code>tests_dict</code>, nasz kod bdzie wyglda nastpujco:</p>
<pre class="code literal-block"><span class="kn">import</span> <span class="nn">unittest</span><span class="o">,</span> <span class="nn">xmlrunner</span><span class="o">,</span> <span class="nn">json</span><span class="o">,</span> <span class="nn">requests</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'tests.json'</span><span class="p">,</span> <span class="s1">'r'</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
    <span class="n">Tests</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="s2">"Tests"</span><span class="p">,</span> <span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">,),</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">requests</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="o">**</span><span class="n">data</span><span class="p">[</span><span class="s1">'request'</span><span class="p">])</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s1">'assert'</span><span class="p">][</span><span class="s1">'statusCode'</span><span class="p">]))(</span><span class="n">data</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">json_file</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()})</span>

<span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="n">testRunner</span><span class="o">=</span><span class="n">xmlrunner</span><span class="o">.</span><span class="n">XMLTestRunner</span><span class="p">())</span>
</pre>
<p>Tak dobrze widzisz, 偶e nasz framework mieci si w <strong>6 linijkach kodu</strong> (pomijajc puste linie, moglibymy odchudzi ten kod do zaledwie 4 linii kodu, co byo by ju偶 tylko kosmetyczn zmian). Nie wiem jak dla Ciebie, ale dla mnie to lekki obd.</p>
<h2 id="wiecej-funkcjonalnosci">Wicej funkcjonalnoci</h2>
<p>Skoro odchudzilimy kod frameworku do zaledwie 6 linijek kodu, to do pierwotnie zakadanych 16 linijek, troch nam brakuje. Spr贸bujmy wykorzysta ten zapas, do stworzenia test贸w, kt贸re testuj co wicej.</p>
<p>Ale co tak na prawd mo偶emy doda do naszego frameworka, aby by bardziej rozbudowany? Do gowy przychodz mi 3 rzeczy:</p>
<ol>
<li>Dodanie weryfikacji poprawnoci struktury danych jakimi odpowiada testowany endpoint poprzez weryfikacj listy kluczy.</li>
<li>Dodanie weryfikacji czasu odpowiedzi danego endpointa.</li>
<li>Wsparcie dla wielu plik贸w json, co da nam mo偶liwo rozbicia test贸w do testowania mniejszych funkcjonalnoci lub grupowania test贸w jako suity test贸w.</li>
</ol>
<p>Abymy mogli wprowadzi powy偶sze rozszerzenia, potrzebujemy delikatnie zmodyfikowa obecny kod poprzez wydzielenie metody z testem z wntrza sownika. Poni偶szy kod prezentuje jak tego dokona:</p>
<pre class="code literal-block"><span class="kn">import</span> <span class="nn">unittest</span><span class="o">,</span> <span class="nn">xmlrunner</span><span class="o">,</span> <span class="nn">json</span><span class="o">,</span> <span class="nn">requests</span>

<span class="k">def</span> <span class="nf">abstract_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="o">**</span><span class="n">data</span><span class="p">[</span><span class="s1">'request'</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s1">'assert'</span><span class="p">][</span><span class="s1">'statusCode'</span><span class="p">])</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'tests.json'</span><span class="p">,</span> <span class="s1">'r'</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
    <span class="n">test</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="n">abstract_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
    <span class="n">Tests</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="s2">"Tests"</span><span class="p">,</span> <span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">,),</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">test</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">json_file</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()})</span>

<span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="n">testRunner</span><span class="o">=</span><span class="n">xmlrunner</span><span class="o">.</span><span class="n">XMLTestRunner</span><span class="p">())</span>
</pre>
<p>Zmiany, kt贸re zostay wprowadzone, nie powinny by zaskoczeniem, gdy偶 bardzo podobny kod by w akapicie dotyczcym wykorzystania <a href="../jeszcze-mniejszy-framework-do-testow-w-pythonie#lambda-po-raz-pierwszy">lambdy</a>.</p>
<p>Skoro mamy ju偶 podwaliny do dalszej zabawy, rozszerzmy kod o dodatkowe sprawdzenia.</p>
<h3 id="wiecej-testow-w-tescie">Wicej test贸w w tecie</h3>
<p>Poniewa偶 wiemy ju偶 co jeszcze chcemy testowa, musimy znale藕 spos贸b na pobranie potrzebnych informacji. Okazuje si, 偶e wszystko tak na prawd ju偶 w naszym kodzie jest, ale jeszcze z tych informacji nie robimy u偶ytku. Te i inne dodatkowe informacje otrzymujemy w <a href="https://requests.readthedocs.io/en/master/api/#requests.Response">odpowiedzi na wysane 偶danie</a>. Wartoci, z kt贸rych mo偶emy skorzysta w tecie to:</p>
<ul>
<li><code>resposne.json()</code> - zwraca sownik z danymi, kt贸rymi odpowiedzia endpoint,</li>
<li><code>response.elapsed.total_seconds()</code> - zawiera czas pomidzy wysaniem 偶dania, a otrzymaniem odpowiedzi.</li>
</ul>
<p>Istniej r贸wnie偶 inne ciekawe wartoci, z kt贸rych mo偶na skorzysta, np. <code>response.headers</code>, ale nie zmiecilibymy si w wymaganej iloci kodu oraz musielibymy przechowywa du偶o wicej informacji w pliku <strong>json</strong>.</p>
<p>Abymy mogli z tych informacji skorzysta, musimy doo偶y pewne dane do naszego pliku <code>tests.json</code>:</p>
<pre class="code literal-block"><span class="p">{</span>
  <span class="nt">"test_get_all_users"</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">"request"</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">"method"</span><span class="p">:</span> <span class="s2">"GET"</span><span class="p">,</span>
      <span class="nt">"url"</span><span class="p">:</span> <span class="s2">"https://reqres.in/api/users"</span>
    <span class="p">},</span>
    <span class="nt">"assert"</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">"statusCode"</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
      <span class="nt">"responseKeys"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"page"</span><span class="p">,</span> <span class="s2">"total"</span><span class="p">,</span> <span class="s2">"per_page"</span><span class="p">,</span> <span class="s2">"total_pages"</span><span class="p">,</span> <span class="s2">"data"</span><span class="p">,</span> <span class="s2">"support"</span><span class="p">],</span>
      <span class="nt">"responseTime"</span><span class="p">:</span> <span class="mf">0.300</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nt">"test_get_users_id_2"</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">"request"</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">"method"</span><span class="p">:</span> <span class="s2">"GET"</span><span class="p">,</span>
      <span class="nt">"url"</span><span class="p">:</span> <span class="s2">"https://reqres.in/api/users/2"</span>
    <span class="p">},</span>
    <span class="nt">"assert"</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">"statusCode"</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
      <span class="nt">"responseKeys"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"data"</span><span class="p">,</span> <span class="s2">"support"</span><span class="p">],</span>
      <span class="nt">"responseTime"</span><span class="p">:</span> <span class="mf">0.300</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nt">"test_get_non_existing_user"</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">"request"</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">"method"</span><span class="p">:</span> <span class="s2">"GET"</span><span class="p">,</span>
      <span class="nt">"url"</span><span class="p">:</span> <span class="s2">"https://reqres.in/api/users/23"</span>
    <span class="p">},</span>
    <span class="nt">"assert"</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">"statusCode"</span><span class="p">:</span> <span class="mi">404</span><span class="p">,</span>
      <span class="nt">"responseKeys"</span><span class="p">:</span> <span class="p">[],</span>
      <span class="nt">"responseTime"</span><span class="p">:</span> <span class="mf">0.300</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nt">"test_create_new_user"</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">"request"</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">"method"</span><span class="p">:</span> <span class="s2">"POST"</span><span class="p">,</span>
      <span class="nt">"url"</span><span class="p">:</span> <span class="s2">"https://reqres.in/api/users"</span><span class="p">,</span>
      <span class="nt">"json"</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">"name"</span><span class="p">:</span> <span class="s2">"testerembyc"</span><span class="p">,</span>
        <span class="nt">"jon"</span><span class="p">:</span> <span class="s2">"tester"</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nt">"assert"</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">"statusCode"</span><span class="p">:</span> <span class="mi">201</span><span class="p">,</span>
      <span class="nt">"responseKeys"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"name"</span><span class="p">,</span> <span class="s2">"jon"</span><span class="p">,</span> <span class="s2">"id"</span><span class="p">,</span> <span class="s2">"createdAt"</span><span class="p">],</span>
      <span class="nt">"responseTime"</span><span class="p">:</span> <span class="mf">0.300</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre>
<p>Przer贸bmy teraz nasz kod, tak aby skorzysta z tych danych:</p>
<pre class="code literal-block"><span class="kn">import</span> <span class="nn">unittest</span><span class="o">,</span> <span class="nn">xmlrunner</span><span class="o">,</span> <span class="nn">json</span><span class="o">,</span> <span class="nn">requests</span><span class="o">,</span> <span class="nn">glob</span>

<span class="k">def</span> <span class="nf">abstract_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="n">response</span><span class="p">:</span> <span class="n">requests</span><span class="o">.</span><span class="n">Response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="o">**</span><span class="n">data</span><span class="p">[</span><span class="s1">'request'</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s1">'assert'</span><span class="p">][</span><span class="s1">'statusCode'</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertSetEqual</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="nb">set</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">'assert'</span><span class="p">][</span><span class="s1">'responseKeys'</span><span class="p">]))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertLessEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">elapsed</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">(),</span> <span class="n">data</span><span class="p">[</span><span class="s1">'assert'</span><span class="p">][</span><span class="s1">'responseTime'</span><span class="p">])</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'tests.json'</span><span class="p">,</span> <span class="s1">'r'</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
    <span class="n">test</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="n">abstract_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
    <span class="n">Tests</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="s2">"Tests"</span><span class="p">,</span> <span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">,),</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">test</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">json_file</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()})</span>

<span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="n">testRunner</span><span class="o">=</span><span class="n">xmlrunner</span><span class="o">.</span><span class="n">XMLTestRunner</span><span class="p">())</span>
</pre>
<p>Sprawdzenie czasu odpowiedzi nie powinno by zaskoczeniem. Natomiast jeli chodzi o por贸wnanie struktury danych odpowiedzi wymaga drobnej ekwilibrystyki na danych:</p>
<ul>
<li>wycigamy same klucze z odpowiedzi,</li>
<li>nastpnie list zamieniamy na <code>set</code>,</li>
<li>list oczekiwanych kluczy r贸wnie偶 zamieniamy na <code>set</code>.</li>
</ul>
<p>Zapytasz si po co to wszystko? Pow贸d jest prosty, tzn. lista jest zbiorem uporzdkowanych wartoci i aby 2 listy byy uznane za identyczne, obie listy poza zawieraniem tych samych wartoci, musz mie jeszcze te wartoci uo偶one w takiej samej kolejnoci. <code>set</code> natomiast w tym wzgldzie jest mniej restrykcyjny i wymaga tylko posiadania takich samych wartoci, nie przejmujc si zupenie ich kolejnoci. Dziki temu, zdecydowanie uatwiamy sobie wprowadzanie danych testowych oraz eliminujemy faszywe bdy spowodowane przez inn kolejno zwracanych przez endpoint wartoci.</p>
<p>W tym momencie mamy 13 linii kodu, wic teoretycznie moglibymy co tutaj jeszcze dorzuci, ale musimy pamitaj jeszcze o kwestii zwizanej z obsug dodatkowy plik贸w <strong>json</strong>. Zanim to zrobimy, musimy wprowadzi dodatkow bibliotek oraz om贸wi jedn dodatkow metod, kt贸rych u偶yjemy do tego zadania.</p>
<h3 id="glob">glob</h3>
<p>Biblioteka <a href="https://docs.python.org/3/library/glob.html">glob</a> w du偶ym uproszczeniu su偶y do wyszukiwania plik贸w i katalog贸w. Na nasze potrzeby wykorzystamy tylko jedn metod. a dokadniej <a href="https://docs.python.org/3/library/glob.html">glob.iglob</a>. Wykorzystamy ja do wyszukiwania plik贸w <strong>json</strong>.</p>
<h3 id="globals">globals()</h3>
<p><a href="https://docs.python.org/3/library/functions.html#globals">globals()</a> to kolejna z wbudowanych metod Pythona, kt贸ra przechowuje zmienne globalne dla danego moduu. Na tym etapie, gdybymy w naszym kodzie wywietli zawarto, kt贸r zwraca <code>globals()</code>, zauwa偶ylibymy m.in. co takiego:</p>
<pre class="code literal-block"><span class="go">'Tests': &lt;class '__main__.Tests'&gt;</span>
</pre>
<p>Jest to zmienna, w kt贸rej przechowywana jest klasa z testami z pojedynczego pliku <strong>json</strong>. Po co nam to wiedzie? Zapraszam dalej.</p>
<h3 id="obsuga-wielu-plikow-json">Obsuga wielu plik贸w json</h3>
<p>Wiemy ju偶 czego bdziemy u偶ywa, a wiec do dziea. Rozdzielmy najpierw obecny plik <code>tests.json</code> na dwa mniejsze.</p>
<p>Pierwszy plik nazwiemy <code>users_get.json</code> bdzie testowa API dotyczce pobierania danych u偶ytkownik贸w z testowanej aplikacji:</p>
<pre class="code literal-block"><span class="p">{</span>
  <span class="nt">"test_get_all_users"</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">"request"</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">"method"</span><span class="p">:</span> <span class="s2">"GET"</span><span class="p">,</span>
      <span class="nt">"url"</span><span class="p">:</span> <span class="s2">"https://reqres.in/api/users"</span>
    <span class="p">},</span>
    <span class="nt">"assert"</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">"statusCode"</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
      <span class="nt">"responseKeys"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"page"</span><span class="p">,</span> <span class="s2">"total"</span><span class="p">,</span> <span class="s2">"per_page"</span><span class="p">,</span> <span class="s2">"total_pages"</span><span class="p">,</span> <span class="s2">"data"</span><span class="p">,</span> <span class="s2">"support"</span><span class="p">],</span>
      <span class="nt">"responseTime"</span><span class="p">:</span> <span class="mf">0.300</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nt">"test_get_users_id_2"</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">"request"</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">"method"</span><span class="p">:</span> <span class="s2">"GET"</span><span class="p">,</span>
      <span class="nt">"url"</span><span class="p">:</span> <span class="s2">"https://reqres.in/api/users/2"</span>
    <span class="p">},</span>
    <span class="nt">"assert"</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">"statusCode"</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
      <span class="nt">"responseKeys"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"data"</span><span class="p">,</span> <span class="s2">"support"</span><span class="p">],</span>
      <span class="nt">"responseTime"</span><span class="p">:</span> <span class="mf">0.300</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nt">"test_get_non_existing_user"</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">"request"</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">"method"</span><span class="p">:</span> <span class="s2">"GET"</span><span class="p">,</span>
      <span class="nt">"url"</span><span class="p">:</span> <span class="s2">"https://reqres.in/api/users/23"</span>
    <span class="p">},</span>
    <span class="nt">"assert"</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">"statusCode"</span><span class="p">:</span> <span class="mi">404</span><span class="p">,</span>
      <span class="nt">"responseKeys"</span><span class="p">:</span> <span class="p">[],</span>
      <span class="nt">"responseTime"</span><span class="p">:</span> <span class="mf">0.300</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre>
<p>Drugi plik nazwiemy <code>users_create.json</code> bdzie testowa API dotyczce tworzenia nowych u偶ytkownik贸w w testowanej aplikacji:</p>
<pre class="code literal-block"><span class="p">{</span>
  <span class="nt">"test_create_new_user"</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">"request"</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">"method"</span><span class="p">:</span> <span class="s2">"POST"</span><span class="p">,</span>
      <span class="nt">"url"</span><span class="p">:</span> <span class="s2">"https://reqres.in/api/users"</span><span class="p">,</span>
      <span class="nt">"json"</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">"name"</span><span class="p">:</span> <span class="s2">"testerembyc"</span><span class="p">,</span>
        <span class="nt">"jon"</span><span class="p">:</span> <span class="s2">"tester"</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nt">"assert"</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">"statusCode"</span><span class="p">:</span> <span class="mi">201</span><span class="p">,</span>
      <span class="nt">"responseKeys"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"name"</span><span class="p">,</span> <span class="s2">"jon"</span><span class="p">,</span> <span class="s2">"id"</span><span class="p">,</span> <span class="s2">"createdAt"</span><span class="p">],</span>
      <span class="nt">"responseTime"</span><span class="p">:</span> <span class="mf">0.300</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre>
<p>Zauwa偶, 偶e te pliki to tylko prosty podzia i nie nastpia 偶adna modyfikacja danych, kt贸re oryginalnie zawarte byy w pliku <code>tests.json</code>.</p>
<p>Przejd藕my teraz do wprowadzenia zmian w kodzie:</p>
<pre class="code literal-block"><span class="kn">import</span> <span class="nn">unittest</span><span class="o">,</span> <span class="nn">xmlrunner</span><span class="o">,</span> <span class="nn">json</span><span class="o">,</span> <span class="nn">requests</span><span class="o">,</span> <span class="nn">glob</span>

<span class="k">def</span> <span class="nf">abstract_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="n">response</span><span class="p">:</span> <span class="n">requests</span><span class="o">.</span><span class="n">Response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="o">**</span><span class="n">data</span><span class="p">[</span><span class="s1">'request'</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s1">'assert'</span><span class="p">][</span><span class="s1">'statusCode'</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertSetEqual</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="nb">set</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">'assert'</span><span class="p">][</span><span class="s1">'responseKeys'</span><span class="p">]))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertLessEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">elapsed</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">(),</span> <span class="n">data</span><span class="p">[</span><span class="s1">'assert'</span><span class="p">][</span><span class="s1">'responseTime'</span><span class="p">])</span>

<span class="k">for</span> <span class="n">file_name</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">iglob</span><span class="p">(</span><span class="s2">"*.json"</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">'r'</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
        <span class="n">test</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="n">abstract_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="n">suite_name</span> <span class="o">=</span> <span class="n">file_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'.'</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="nb">globals</span><span class="p">()[</span><span class="n">suite_name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">suite_name</span><span class="p">,</span> <span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">,),</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">test</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">json_file</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()})</span>

<span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="n">testRunner</span><span class="o">=</span><span class="n">xmlrunner</span><span class="o">.</span><span class="n">XMLTestRunner</span><span class="p">())</span>
</pre>
<p>Wprowadzilimy kilka drobnych zmian:</p>
<ol>
<li>Dodalimy ptle <code>for</code>, kt贸ra iteruje po znalezionych plikach <strong>json</strong>.</li>
<li>Dodalimy zmienn <code>suite_name</code>, kt贸ra przechowuje nazw suity test贸w, a kt贸ra jest nazw pliku <strong>json</strong> bez jego rozszerzenia.</li>
<li>W dynamiczny spos贸b dodajemy zmienne globalne, kt贸re s oddzielnymi klasami test贸w, gdzie ka偶demu plikowi <strong>json</strong> odpowiada jedna klasa z testami.</li>
</ol>
<p>Gdybymy teraz w naszym kodzie wywietli zawarto, kt贸r zwraca <code>globals()</code>, zauwa偶ylibymy m.in. co takiego:</p>
<pre class="code literal-block"><span class="go">'user_create': &lt;class '__main__.user_create'&gt;, 'user_get': &lt;class '__main__.user_get'&gt;</span>
</pre>
<p>Ile mamy linii kodu? <strong>15</strong>. Uff. Dalej miecimy si w zakadanych 16 linijkach kodu.</p>
<h2 id="podsumowanie">Podsumowanie</h2>
<p>To bya dosy duga przygoda (a偶 dwa i to dosy rozbudowane wpisy na blogu). Sporo Pythonowych <em>trik贸w</em>, kt贸re na pierwszy rzut oka nie wydaj si oczywiste, ale pokazuj potg tego jzyka. Mam nadziej, 偶e ta podr贸偶 zachci Ci do poznawania zar贸wno bibliotek Pythonowych jakie mo偶na wykorzysta w testach oraz wewntrznych mechanizm贸w, jakie s w ten jzyk wbudowane.</p>
<h2 id="bonus">Bonus</h2>
<p>Jeli jeste puryst i najwa偶niejsz spraw dla Ciebie jest zgodno kodu z <strong>PEP-8</strong> to poni偶ej wersja tego frameworka, kt贸ra jest z nim zgodna oraz w dalszym cigu mieci si w 16 linijkach kodu (sprawdza status odpowiedzi oraz wspiera wiele plik贸w <strong>json</strong>):</p>
<pre class="code literal-block"><span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">import</span> <span class="nn">xmlrunner</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">glob</span>

<span class="k">for</span> <span class="n">file_name</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">iglob</span><span class="p">(</span><span class="s2">"*.json"</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">'r'</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
        <span class="n">tests_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">requests</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="o">**</span><span class="n">data</span><span class="p">[</span><span class="s1">'request'</span><span class="p">])</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s1">'assert'</span><span class="p">][</span><span class="s1">'statusCode'</span><span class="p">]))(</span><span class="n">data</span><span class="p">)</span>
                      <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">json_file</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="n">suite_name</span> <span class="o">=</span> <span class="n">file_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'.'</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="nb">globals</span><span class="p">()[</span><span class="n">suite_name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">suite_name</span><span class="p">,</span> <span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">,),</span> <span class="n">tests_dict</span><span class="p">)</span>

<span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="n">testRunner</span><span class="o">=</span><span class="n">xmlrunner</span><span class="o">.</span><span class="n">XMLTestRunner</span><span class="p">())</span>
</pre>
<p>Dodatkowo linki do repozytorium z najciekawszymi (wedug mnie) wersjami kodu, kt贸ry omawialimy w tej mini serii znajdziesz poni偶ej:</p>
<ul>
<li><a href="https://github.com/mkusz/the_smallest_rest_api_testing_framework/tree/first_article">pierwszy artyku</a>,</li>
<li><a href="https://github.com/mkusz/the_smallest_rest_api_testing_framework/tree/more_functionality">wicej funkcjonalnoci</a>,</li>
<li><a href="https://github.com/mkusz/the_smallest_rest_api_testing_framework/tree/6_lines">tylko 6 linii kodu</a>,</li>
<li><a href="https://github.com/mkusz/the_smallest_rest_api_testing_framework/tree/pep8_valid">zgodno z PEP-8</a>.</li>
</ul>
<h2 id="bonus-2">Bonus 2</h2>
<p>Po raz kolejny <strong>Jakub Sp贸rna</strong> z bloga <a href="https://sporna.dev/">https://sporna.dev/</a> podrzuci jeszcze mniejsz wersj frameworka. Tym razem wzi na tapet wersj najbardziej rozbudowan funkcjonalno i postanowi j troszeczk bardziej pomniejszy. Poni偶ej jego wersja (z minimaln modyfikacj dotyczcej nazw plik贸w):</p>
<pre class="code literal-block"><span class="kn">import</span> <span class="nn">unittest</span><span class="o">,</span> <span class="nn">xmlrunner</span><span class="o">,</span> <span class="nn">json</span><span class="o">,</span> <span class="nn">requests</span><span class="o">,</span> <span class="nn">glob</span>

<span class="k">def</span> <span class="nf">abstract_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s1">'assert'</span><span class="p">][</span><span class="s1">'statusCode'</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertSetEqual</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="nb">set</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">'assert'</span><span class="p">][</span><span class="s1">'responseKeys'</span><span class="p">]))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertLessEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">elapsed</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">(),</span> <span class="n">data</span><span class="p">[</span><span class="s1">'assert'</span><span class="p">][</span><span class="s1">'responseTime'</span><span class="p">])</span>

<span class="n">test</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="n">abstract_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">requests</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="o">**</span><span class="n">data</span><span class="p">[</span><span class="s1">'request'</span><span class="p">]))</span>
<span class="nb">globals</span><span class="p">()</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">file_name</span><span class="p">:</span> <span class="nb">type</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">,</span> <span class="p">),</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">test</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">'r'</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span><span class="o">.</span><span class="n">items</span><span class="p">()})</span> <span class="k">for</span> <span class="n">file_name</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">iglob</span><span class="p">(</span><span class="s2">"*.json"</span><span class="p">)})</span>
<span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="n">testRunner</span><span class="o">=</span><span class="n">xmlrunner</span><span class="o">.</span><span class="n">XMLTestRunner</span><span class="p">())</span>
</pre>
<p>Nie bd ju偶 analizowa zmian, gdy偶 pozostawi to dla Ciebie w ramach treningu. A mo偶e Ty r贸wnie偶 pokusisz si o jaka wersj tego kodu, np. rozbudowan o jakie dodatkowe sprawdzenia?</p>
</div>
<div class="col-md-6"><img src="../../images/page_lm/jak_zaczac_automatyzowac.jpg"></div>
<div class="col-md-6">
<form action="https://maciejkusz.activehosted.com/proc.php" id="_form_5_" method="post" name="_form_5_" novalidate=""><input name="u" type="hidden" value="5"><input name="f" type="hidden" value="5"><input name="s" type="hidden"><input name="c" type="hidden" value="0"><input name="m" type="hidden" value="0"><input name="act" type="hidden" value="sub"><input name="v" type="hidden" value="2">
<h3>Zapraszam do newslettera</h3>
<div class="_form-content">
<p>Jeli powy偶szy artyku uznajesz za wartociowy oraz masz ochot by informowany o nowociach na moim blogu, to zachcam Ci do zapisania si do mojego newslettera. Obiecuj, 偶e nie bd Ci spamowa, a tylko czasu do czasu wyl Ci powiadomienie o nowym artykule lub przel kr贸tkiego maila z ciekawymi informacjami.<br>
<strong>BONUS:</strong> Dodatkowo otrzymasz m贸j mini poradnik: <em>Jak zacz automatyzowa testy? Czyli 12 pyta i odpowiedzi, kt贸re w tym pomog</em></p>
<div class="input-group" id="basic-fullname-group"><span class="input-group-addon" id="basic-fullname">Imi</span> <input aria-describedby="basic-fullname" class="form-control" name="fullname" placeholder="Wpisz swoje imi" type="text"></div>
<div class="input-group" id="basic-lastname-group"><span class="input-group-addon" id="basic-lastname">Nazwisko</span> <input aria-describedby="basic-fullname" class="form-control" name="lastname" placeholder="Wpisz swoje nazwisko" type="text"></div>
<div class="input-group" id="basic-email-group"><span class="input-group-addon" id="basic-email">E-mail</span> <input aria-describedby="basic-email" class="form-control" name="email" placeholder="Wpisz sw贸j e-mail" required="" type="text"></div>
<button class="_submit btn btn-danger" id="_form_5_submit" style="margin-left: auto; margin-right: auto; display: block;" type="submit">Zapisz si</button>
<div class="_clear-element"></div>
</div>
<div class="_form-thank-you" style="display:none;"></div>
<p style="font-size: 10px; margin-top: 5px;">Wszystkie podane przez Ciebie dane, bd przetwarzane zgodnie z <a href="../../pages/polityka-prywatnosci">polityk prywatnoci</a>.</p>
</form>
<script type="text/javascript">
        window.cfields = [];
        window._show_thank_you = function(id, message, trackcmp_url) {
          var form = document.getElementById('_form_' + id + '_'), thank_you = form.querySelector('._form-thank-you');
          form.querySelector('._form-content').style.display = 'none';
          thank_you.innerHTML = message;
          thank_you.style.display = 'block';
          if (typeof(trackcmp_url) != 'undefined' && trackcmp_url) {
            // Site tracking URL to use after inline form submission.
            _load_script(trackcmp_url);
          }
          if (typeof window._form_callback !== 'undefined') window._form_callback(id);
        };
        window._show_error = function(id, message, html) {
          var form = document.getElementById('_form_' + id + '_'), err = document.createElement('div'), button = form.querySelector('button'), old_error = form.querySelector('._form_error');
          if (old_error) old_error.parentNode.removeChild(old_error);
          err.innerHTML = message;
          err.className = '_error-inner _form_error _no_arrow';
          var wrapper = document.createElement('div');
          wrapper.className = '_form-inner';
          wrapper.appendChild(err);
          button.parentNode.insertBefore(wrapper, button);
          document.querySelector('[id^="_form"][id$="_submit"]').disabled = false;
          if (html) {
            var div = document.createElement('div');
            div.className = '_error-html';
            div.innerHTML = html;
            err.appendChild(div);
          }
        };
        window._load_script = function(url, callback) {
            var head = document.querySelector('head'), script = document.createElement('script'), r = false;
            script.type = 'text/javascript';
            script.charset = 'utf-8';
            script.src = url;
            if (callback) {
              script.onload = script.onreadystatechange = function() {
              if (!r && (!this.readyState || this.readyState == 'complete')) {
                r = true;
                callback();
                }
              };
            }
            head.appendChild(script);
        };
        (function() {
          if (window.location.search.search("excludeform") !== -1) return false;
          var getCookie = function(name) {
            var match = document.cookie.match(new RegExp('(^|; )' + name + '=([^;]+)'));
            return match ? match[2] : null;
          }
          var setCookie = function(name, value) {
            var now = new Date();
            var time = now.getTime();
            var expireTime = time + 1000 * 60 * 60 * 24 * 365;
            now.setTime(expireTime);
            document.cookie = name + '=' + value + '; expires=' + now + ';path=/';
          }
              var addEvent = function(element, event, func) {
            if (element.addEventListener) {
              element.addEventListener(event, func);
            } else {
              var oldFunc = element['on' + event];
              element['on' + event] = function() {
                oldFunc.apply(this, arguments);
                func.apply(this, arguments);
              };
            }
          }
          var _removed = false;
          var form_to_submit = document.getElementById('_form_5_');
          var allInputs = form_to_submit.querySelectorAll('input, select, textarea'), tooltips = [], submitted = false;

          var getUrlParam = function(name) {
            var regexStr = '[\?&]' + name + '=([^&#]*)';
            var results = new RegExp(regexStr, 'i').exec(window.location.href);
            return results != undefined ? decodeURIComponent(results[1]) : false;
          };

          for (var i = 0; i < allInputs.length; i++) {
            var regexStr = "field\\[(\\d+)\\]";
            var results = new RegExp(regexStr).exec(allInputs[i].name);
            if (results != undefined) {
              allInputs[i].dataset.name = window.cfields[results[1]];
            } else {
              allInputs[i].dataset.name = allInputs[i].name;
            }
            var fieldVal = getUrlParam(allInputs[i].dataset.name);

            if (fieldVal) {
                    if (allInputs[i].dataset.autofill === "false") {
                        continue;
                    }
              if (allInputs[i].type == "radio" || allInputs[i].type == "checkbox") {
                if (allInputs[i].value == fieldVal) {
                  allInputs[i].checked = true;
                }
              } else {
                allInputs[i].value = fieldVal;
              }
            }
          }

          var remove_tooltips = function() {
            for (var i = 0; i < tooltips.length; i++) {
              tooltips[i].tip.parentNode.removeChild(tooltips[i].tip);
            }
              tooltips = [];
          };
          var remove_tooltip = function(elem) {
            for (var i = 0; i < tooltips.length; i++) {
              if (tooltips[i].elem === elem) {
                tooltips[i].tip.parentNode.removeChild(tooltips[i].tip);
                tooltips.splice(i, 1);
                return;
              }
            }
          };
          var create_tooltip = function(elem, text) {
            var tooltip = document.createElement('div'), arrow = document.createElement('div'), inner = document.createElement('div'), new_tooltip = {};
            if (elem.type != 'radio' && elem.type != 'checkbox') {
              tooltip.className = 'label label-danger';
              tooltip.innerHTML = text;
              elem.parentNode.parentNode.insertBefore(tooltip, elem.parentNode);
            } else {
              tooltip.className = '_error-inner _no_arrow';
              tooltip.innerHTML = text;
              elem.parentNode.insertBefore(tooltip, elem);
              new_tooltip.no_arrow = true;
            }
            new_tooltip.tip = tooltip;
            new_tooltip.elem = elem;
            tooltips.push(new_tooltip);
            return new_tooltip;
          };
          var resize_tooltip = function(tooltip) {
            var rect = tooltip.elem.getBoundingClientRect();
            var doc = document.documentElement, scrollPosition = rect.top - ((window.pageYOffset || doc.scrollTop)  - (doc.clientTop || 0));
            if (scrollPosition < 40) {
              tooltip.tip.className = tooltip.tip.className.replace(/ ?(_above|_below) ?/g, '') + ' _below';
            } else {
              tooltip.tip.className = tooltip.tip.className.replace(/ ?(_above|_below) ?/g, '') + ' _above';
            }
          };
          var resize_tooltips = function() {
            if (_removed) return;
            for (var i = 0; i < tooltips.length; i++) {
              if (!tooltips[i].no_arrow) resize_tooltip(tooltips[i]);
            }
          };
          var validate_field = function(elem, remove) {
            var tooltip = null, value = elem.value, no_error = true;
            remove ? remove_tooltip(elem) : false;
            if (elem.type != 'checkbox') elem.className = elem.className.replace(/ ?_has_error ?/g, '');
            if (elem.getAttribute('required') !== null) {
              if (elem.type == 'radio' || (elem.type == 'checkbox' && /any/.test(elem.className))) {
                var elems = form_to_submit.elements[elem.name];
                if (!(elems instanceof NodeList || elems instanceof HTMLCollection) || elems.length <= 1) {
                  no_error = elem.checked;
                }
                else {
                  no_error = false;
                  for (var i = 0; i < elems.length; i++) {
                    if (elems[i].checked) no_error = true;
                  }
                }
                if (!no_error) {
                  tooltip = create_tooltip(elem, "Wybierz opcj.");
                }
              } else if (elem.type =='checkbox') {
                var elems = form_to_submit.elements[elem.name], found = false, err = [];
                no_error = true;
                for (var i = 0; i < elems.length; i++) {
                  if (elems[i].getAttribute('required') === null) continue;
                  if (!found && elems[i] !== elem) return true;
                  found = true;
                  elems[i].className = elems[i].className.replace(/ ?_has_error ?/g, '');
                  if (!elems[i].checked) {
                    no_error = false;
                    elems[i].className = elems[i].className + ' _has_error';
                    err.push("Zaznaczenie %s jest wymagane".replace("%s", elems[i].value));
                  }
                }
                if (!no_error) {
                  tooltip = create_tooltip(elem, err.join('<br/>'));
                }
              } else if (elem.tagName == 'SELECT') {
                var selected = true;
                if (elem.multiple) {
                  selected = false;
                  for (var i = 0; i < elem.options.length; i++) {
                    if (elem.options[i].selected) {
                      selected = true;
                      break;
                    }
                  }
                } else {
                  for (var i = 0; i < elem.options.length; i++) {
                    if (elem.options[i].selected && !elem.options[i].value) {
                      selected = false;
                    }
                  }
                }
                if (!selected) {
                  elem.className = elem.className + ' _has_error';
                  no_error = false;
                  tooltip = create_tooltip(elem, "Wybierz opcj.");
                }
              } else if (value === undefined || value === null || value === '') {
                elem.className = elem.className + ' _has_error';
                no_error = false;
                tooltip = create_tooltip(elem, "To pole jest wymagane.");
              }
            }
            if (no_error && elem.name == 'email') {
              if (!value.match(/^[\+_a-z0-9-'&=]+(\.[\+_a-z0-9-']+)*@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,})$/i)) {
                elem.className = elem.className + ' _has_error';
                no_error = false;
                tooltip = create_tooltip(elem, "Wpisz poprawny adres e-mail.");
              }
            }
            if (no_error && /date_field/.test(elem.className)) {
              if (!value.match(/^\d\d\d\d-\d\d-\d\d$/)) {
                elem.className = elem.className + ' _has_error';
                no_error = false;
                tooltip = create_tooltip(elem, "Wpisz poprawn dat.");
              }
            }
            tooltip ? resize_tooltip(tooltip) : false;
            return no_error;
          };
          var needs_validate = function(el) {
            return el.name == 'email' || el.getAttribute('required') !== null;
          };
          var validate_form = function(e) {
            var err = form_to_submit.querySelector('._form_error'), no_error = true;
            if (!submitted) {
              submitted = true;
              for (var i = 0, len = allInputs.length; i < len; i++) {
                var input = allInputs[i];
                if (needs_validate(input)) {
                  if (input.type == 'text') {
                    addEvent(input, 'blur', function() {
                      this.value = this.value.trim();
                      validate_field(this, true);
                    });
                    addEvent(input, 'input', function() {
                      validate_field(this, true);
                    });
                  } else if (input.type == 'radio' || input.type == 'checkbox') {
                    (function(el) {
                      var radios = form_to_submit.elements[el.name];
                      for (var i = 0; i < radios.length; i++) {
                        addEvent(radios[i], 'click', function() {
                          validate_field(el, true);
                        });
                      }
                    })(input);
                  } else if (input.tagName == 'SELECT') {
                    addEvent(input, 'change', function() {
                      validate_field(this, true);
                    });
                  } else if (input.type == 'textarea'){
                    addEvent(input, 'input', function() {
                      validate_field(this, true);
                    });
                  }
                }
              }
            }
            remove_tooltips();
            for (var i = 0, len = allInputs.length; i < len; i++) {
              var elem = allInputs[i];
              if (needs_validate(elem)) {
                if (elem.tagName.toLowerCase() !== "select") {
                  elem.value = elem.value.trim();
                }
                validate_field(elem) ? true : no_error = false;
              }
            }
            if (!no_error && e) {
              e.preventDefault();
            }
            resize_tooltips();
            return no_error;
          };
          addEvent(window, 'resize', resize_tooltips);
          addEvent(window, 'scroll', resize_tooltips);
          window._old_serialize = null;
          if (typeof serialize !== 'undefined') window._old_serialize = window.serialize;
          _load_script("//d3rxaij56vjege.cloudfront.net/form-serialize/0.3/serialize.min.js", function() {
            window._form_serialize = window.serialize;
            if (window._old_serialize) window.serialize = window._old_serialize;
          });
          var form_submit = function(e) {
            e.preventDefault();
            if (validate_form()) {
              // use this trick to get the submit button & disable it using plain javascript
              document.querySelector('#_form_5_submit').disabled = true;
                    var serialized = _form_serialize(document.getElementById('_form_5_'));
              var err = form_to_submit.querySelector('._form_error');
              err ? err.parentNode.removeChild(err) : false;
              _load_script('https://maciejkusz.activehosted.com/proc.php?' + serialized + '&jsonp=true');
            }
            return false;
          };
          addEvent(form_to_submit, 'submit', form_submit);
        })();

</script></div>
</div>
<aside class="postpromonav">
<nav>
<ul class="tags" itemprop="keywords">
<li><a class="tag p-category" href="../../categories/lambda/" rel="tag">lambda</a></li>
<li><a class="tag p-category" href="../../categories/requests/" rel="tag">requests</a></li>
<li><a class="tag p-category" href="../../categories/unittest/" rel="tag">unittest</a></li>
</ul>
<ul class="pager hidden-print">
<li class="previous"><a href="../najmniejszy-framework-do-testow-w-pythonie/" rel="prev" title="Najmniejszy framework do test贸w w Pythonie">Poprzedni post</a></li>
<li class="next"><a href="../vlog-001-plany-vs-rzeczywistosc/" rel="next" title="Plany vs. rzeczywisto [vlog 001]">Nastpny post</a></li>
</ul>
</nav>
</aside>
<section class="comments hidden-print">
<h2>Komentarze</h2>
<div id="disqus_thread"></div>
<script>
        var disqus_shortname ="testerembyc",
            disqus_url="https://testerembyc.pl/posts/jeszcze-mniejszy-framework-do-testow-w-pythonie/",
        disqus_title="Jeszcze mniejszy framework do test\u00f3w w Pythonie",
        disqus_identifier="cache/posts/jeszcze-mniejszy-framework-do-testow-w-pythonie.html",
        disqus_config = function () {
            this.language = "pl";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript> <a class="dsq-brlink" href="https://disqus.com" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a></section>
</article>
<script>
var disqus_shortname="testerembyc";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());
</script></div>
<div class="col-sm-3 blog-sidebar">
<div class="sidebar-module sidebar-module-inset">
<form action="https://www.google.com/search" method="get" role="search"><input name="cx" type="hidden" value="013548426528546093847:kxj9yxvrzlu"><input name="ie" type="hidden" value="utf-8"><input name="hl" type="hidden" value="pl">
<div class="input-group"><input aria-describedby="basic-search" class="form-control" name="q" placeholder="Szukaj" type="text">
<div class="input-group-btn"><button class="btn btn-danger" type="submit"><span class="glyphicon glyphicon-search" id="basic-search"></span></button></div>
</div>
<input name="sitesearch" type="hidden" value="testerembyc"></form>
</div>
<div class="sidebar-module sidebar-module-inset">
<h3>Darmowy poradnik</h3>
<a href="../../pages/jak-zaczac-automatyzowac-testy/"><img src="../../images/page_lm/jak_zaczac_automatyzowac_small.jpg"></a>
<p><strong>Jak zacz automatyzowa testy?</strong></p>
<p>Poznaj 12 pyta, kt贸re pomog Ci rozpocz proces automatyzacji test贸w. W zupenym oderwaniu od jzyka programowania, framework贸w do test贸w oraz technologi w jakiej napisana zostaa aplikacja, kt贸r bdziesz testowa. Cao opisana prostym i zrozumiaym jzykiem.</p>
<p style="text-align: center"><a class="_submit btn btn-danger" href="../../pages/jak-zaczac-automatyzowac-testy/">Pobieram poradnik</a></p>
</div>
<div class="sidebar-module sidebar-module-inset">
<h3>O mnie</h3>
<a href="../../pages/o-mnie/"><img src="../../images/me_bw_small.jpg"></a>
<p>Nazywam si <strong>Maciej Kusz</strong> i od 2008 roku zajmuj si testowaniem oprogramowania. Na pocztku byy to testy manualne, od 2011 pocztki test贸w automatycznych, a od 2013 automatyzacj test贸w z wykorzystaniem <strong>Pythona</strong>. Przez te kilka lat, zdarzyo mi si ju偶 by w kilku firmach i w kilku r贸偶nych projektach. Na stronie <a href="../../pages/o-mnie/">o mnie</a>, znajdujdziesz ciut wicej informacji na ten temat.</p>
</div>
<div class="sidebar-module sidebar-module-inset">
<form action="https://maciejkusz.activehosted.com/proc.php" id="_form_3_" method="post" name="_form_3_" novalidate=""><input name="u" type="hidden" value="3"><input name="f" type="hidden" value="3"><input name="s" type="hidden"><input name="c" type="hidden" value="0"><input name="m" type="hidden" value="0"><input name="act" type="hidden" value="sub"><input name="v" type="hidden" value="2">
<h3>Newsletter</h3>
<div class="_form-content">
<p>Chcesz by powiadamiany o nowociach na tej stronie oraz innych moich projektach?</p>
<p>Jeli tak, to zapisz si poni偶ej do newsletter'a.</p>
<div class="input-group" id="basic-fullname-group"><span class="input-group-addon" id="basic-fullname">Imi</span> <input aria-describedby="basic-fullname" class="form-control" name="fullname" placeholder="Wpisz swoje imi" type="text"></div>
<div class="input-group" id="basic-lastname-group"><span class="input-group-addon" id="basic-lastname">Nazwisko</span> <input aria-describedby="basic-fullname" class="form-control" name="lastname" placeholder="Wpisz swoje nazwisko" type="text"></div>
<div class="input-group" id="basic-email-group"><span class="input-group-addon" id="basic-email">E-mail</span> <input aria-describedby="basic-email" class="form-control" name="email" placeholder="Wpisz sw贸j e-mail" required="" type="text"></div>
<button class="_submit btn btn-danger" id="_form_3_submit" style="margin-left: auto; margin-right: auto; display: block;" type="submit">Zapisz si</button>
<div class="_clear-element"></div>
</div>
<div class="_form-thank-you" style="display:none;"></div>
<p style="font-size: 10px; margin-top: 5px;">Wszystkie podane przez Ciebie dane, bd przetwarzane zgodnie z <a href="../../pages/polityka-prywatnosci">polityk prywatnoci</a>.</p>
</form>
<script type="text/javascript">
window.cfields = [];
window._show_thank_you = function(id, message, trackcmp_url) {
  var form = document.getElementById('_form_' + id + '_'), thank_you = form.querySelector('._form-thank-you');
  form.querySelector('._form-content').style.display = 'none';
  thank_you.innerHTML = message;
  thank_you.style.display = 'block';
  if (typeof(trackcmp_url) != 'undefined' && trackcmp_url) {
    // Site tracking URL to use after inline form submission.
    _load_script(trackcmp_url);
  }
  if (typeof window._form_callback !== 'undefined') window._form_callback(id);
};
window._show_error = function(id, message, html) {
  var form = document.getElementById('_form_' + id + '_'), err = document.createElement('div'), button = form.querySelector('button'), old_error = form.querySelector('._form_error');
  if (old_error) old_error.parentNode.removeChild(old_error);
  err.innerHTML = message;
  err.className = '_error-inner _form_error _no_arrow';
  var wrapper = document.createElement('div');
  wrapper.className = '_form-inner';
  wrapper.appendChild(err);
  button.parentNode.insertBefore(wrapper, button);
  document.querySelector('[id^="_form"][id$="_submit"]').disabled = false;
  if (html) {
    var div = document.createElement('div');
    div.className = '_error-html';
    div.innerHTML = html;
    err.appendChild(div);
  }
};
window._load_script = function(url, callback) {
    var head = document.querySelector('head'), script = document.createElement('script'), r = false;
    script.type = 'text/javascript';
    script.charset = 'utf-8';
    script.src = url;
    if (callback) {
      script.onload = script.onreadystatechange = function() {
      if (!r && (!this.readyState || this.readyState == 'complete')) {
        r = true;
        callback();
        }
      };
    }
    head.appendChild(script);
};
(function() {
  if (window.location.search.search("excludeform") !== -1) return false;
  var getCookie = function(name) {
    var match = document.cookie.match(new RegExp('(^|; )' + name + '=([^;]+)'));
    return match ? match[2] : null;
  }
  var setCookie = function(name, value) {
    var now = new Date();
    var time = now.getTime();
    var expireTime = time + 1000 * 60 * 60 * 24 * 365;
    now.setTime(expireTime);
    document.cookie = name + '=' + value + '; expires=' + now + ';path=/';
  }
      var addEvent = function(element, event, func) {
    if (element.addEventListener) {
      element.addEventListener(event, func);
    } else {
      var oldFunc = element['on' + event];
      element['on' + event] = function() {
        oldFunc.apply(this, arguments);
        func.apply(this, arguments);
      };
    }
  }
  var _removed = false;
  var form_to_submit = document.getElementById('_form_3_');
  var allInputs = form_to_submit.querySelectorAll('input, select, textarea'), tooltips = [], submitted = false;

  var getUrlParam = function(name) {
    var regexStr = '[\?&]' + name + '=([^&#]*)';
    var results = new RegExp(regexStr, 'i').exec(window.location.href);
    return results != undefined ? decodeURIComponent(results[1]) : false;
  };

  for (var i = 0; i < allInputs.length; i++) {
    var regexStr = "field\[(\d+)\]";
    var results = new RegExp(regexStr).exec(allInputs[i].name);
    if (results != undefined) {
      allInputs[i].dataset.name = window.cfields[results[1]];
    } else {
      allInputs[i].dataset.name = allInputs[i].name;
    }
    var fieldVal = getUrlParam(allInputs[i].dataset.name);

    if (fieldVal) {
      if (allInputs[i].type == "radio" || allInputs[i].type == "checkbox") {
        if (allInputs[i].value == fieldVal) {
          allInputs[i].checked = true;
        }
      } else {
        allInputs[i].value = fieldVal;
      }
    }
  }

  var remove_tooltips = function() {
    for (var i = 0; i < tooltips.length; i++) {
      tooltips[i].tip.parentNode.removeChild(tooltips[i].tip);
    }
      tooltips = [];
  };
  var remove_tooltip = function(elem) {
    for (var i = 0; i < tooltips.length; i++) {
      if (tooltips[i].elem === elem) {
        tooltips[i].tip.parentNode.removeChild(tooltips[i].tip);
        tooltips.splice(i, 1);
        return;
      }
    }
  };
  var create_tooltip = function(elem, text) {
    var tooltip = document.createElement('label'), arrow = document.createElement('div'), inner = document.createElement('div'), new_tooltip = {};
    if (elem.type != 'radio' && elem.type != 'checkbox') {
      tooltip.className = 'label label-danger';
      tooltip.innerHTML = text;
      elem.parentNode.parentNode.insertBefore(tooltip, elem.parentNode);
    } else {
      tooltip.className = '_error-inner _no_arrow';
      tooltip.innerHTML = text;
      elem.parentNode.insertBefore(tooltip, elem);
      new_tooltip.no_arrow = true;
    }
    new_tooltip.tip = tooltip;
    new_tooltip.elem = elem;
    tooltips.push(new_tooltip);
    return new_tooltip;
  };
  var resize_tooltip = function(tooltip) {
    var rect = tooltip.elem.getBoundingClientRect();
    var doc = document.documentElement, scrollPosition = rect.top - ((window.pageYOffset || doc.scrollTop)  - (doc.clientTop || 0));
    if (scrollPosition < 40) {
      tooltip.tip.className = tooltip.tip.className.replace(/ ?(_above|_below) ?/g, '') + ' _below';
    } else {
      tooltip.tip.className = tooltip.tip.className.replace(/ ?(_above|_below) ?/g, '') + ' _above';
    }
  };
  var resize_tooltips = function() {
    if (_removed) return;
    for (var i = 0; i < tooltips.length; i++) {
      if (!tooltips[i].no_arrow) resize_tooltip(tooltips[i]);
    }
  };
  var validate_field = function(elem, remove) {
    var tooltip = null, value = elem.value, no_error = true;
    remove ? remove_tooltip(elem) : false;
    if (elem.type != 'checkbox') elem.className = elem.className.replace(/ ?_has_error ?/g, '');
    if (elem.getAttribute('required') !== null) {
      if (elem.type == 'radio' || (elem.type == 'checkbox' && /any/.test(elem.className))) {
        var elems = form_to_submit.elements[elem.name];
        if (!(elems instanceof NodeList || elems instanceof HTMLCollection) || elems.length <= 1) {
          no_error = elem.checked;
        }
        else {
          no_error = false;
          for (var i = 0; i < elems.length; i++) {
            if (elems[i].checked) no_error = true;
          }
        }
        if (!no_error) {
          tooltip = create_tooltip(elem, "Wybierz opcj.");
        }
      } else if (elem.type =='checkbox') {
        var elems = form_to_submit.elements[elem.name], found = false, err = [];
        no_error = true;
        for (var i = 0; i < elems.length; i++) {
          if (elems[i].getAttribute('required') === null) continue;
          if (!found && elems[i] !== elem) return true;
          found = true;
          elems[i].className = elems[i].className.replace(/ ?_has_error ?/g, '');
          if (!elems[i].checked) {
            no_error = false;
            elems[i].className = elems[i].className + ' _has_error';
            err.push("Zaznaczenie %s jest wymagane".replace("%s", elems[i].value));
          }
        }
        if (!no_error) {
          tooltip = create_tooltip(elem, err.join('<br/>'));
        }
      } else if (elem.tagName == 'SELECT') {
        var selected = true;
        if (elem.multiple) {
          selected = false;
          for (var i = 0; i < elem.options.length; i++) {
            if (elem.options[i].selected) {
              selected = true;
              break;
            }
          }
        } else {
          for (var i = 0; i < elem.options.length; i++) {
            if (elem.options[i].selected && !elem.options[i].value) {
              selected = false;
            }
          }
        }
        if (!selected) {
          elem.className = elem.className + ' _has_error';
          no_error = false;
          tooltip = create_tooltip(elem, "Wybierz opcj.");
        }
      } else if (value === undefined || value === null || value === '') {
        elem.className = elem.className + ' _has_error';
        no_error = false;
        tooltip = create_tooltip(elem, "To pole jest wymagane.");
      }
    }
    if (no_error && elem.name == 'email') {
      if (!value.match(/^[\+_a-z0-9-'&=]+(\.[\+_a-z0-9-']+)*@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,})$/i)) {
        elem.className = elem.className + ' _has_error';
        no_error = false;
        tooltip = create_tooltip(elem, "Wpisz poprawny adres e-mail.");
      }
    }
    if (no_error && /date_field/.test(elem.className)) {
      if (!value.match(/^\d\d\d\d-\d\d-\d\d$/)) {
        elem.className = elem.className + ' _has_error';
        no_error = false;
        tooltip = create_tooltip(elem, "Wpisz poprawn dat.");
      }
    }
    tooltip ? resize_tooltip(tooltip) : false;
    return no_error;
  };
  var needs_validate = function(el) {
    return el.name == 'email' || el.getAttribute('required') !== null;
  };
  var validate_form = function(e) {
    var err = form_to_submit.querySelector('._form_error'), no_error = true;
    if (!submitted) {
      submitted = true;
      for (var i = 0, len = allInputs.length; i < len; i++) {
        var input = allInputs[i];
        if (needs_validate(input)) {
          if (input.type == 'text') {
            addEvent(input, 'blur', function() {
              this.value = this.value.trim();
              validate_field(this, true);
            });
            addEvent(input, 'input', function() {
              validate_field(this, true);
            });
          } else if (input.type == 'radio' || input.type == 'checkbox') {
            (function(el) {
              var radios = form_to_submit.elements[el.name];
              for (var i = 0; i < radios.length; i++) {
                addEvent(radios[i], 'click', function() {
                  validate_field(el, true);
                });
              }
            })(input);
          } else if (input.tagName == 'SELECT') {
            addEvent(input, 'change', function() {
              validate_field(this, true);
            });
          } else if (input.type == 'textarea'){
            addEvent(input, 'input', function() {
              validate_field(this, true);
            });
          }
        }
      }
    }
    remove_tooltips();
    for (var i = 0, len = allInputs.length; i < len; i++) {
      var elem = allInputs[i];
      if (needs_validate(elem)) {
        if (elem.tagName.toLowerCase() !== "select") {
          elem.value = elem.value.trim();
        }
        validate_field(elem) ? true : no_error = false;
      }
    }
    if (!no_error && e) {
      e.preventDefault();
    }
    resize_tooltips();
    return no_error;
  };
  addEvent(window, 'resize', resize_tooltips);
  addEvent(window, 'scroll', resize_tooltips);
  window._old_serialize = null;
  if (typeof serialize !== 'undefined') window._old_serialize = window.serialize;
  _load_script("//d3rxaij56vjege.cloudfront.net/form-serialize/0.3/serialize.min.js", function() {
    window._form_serialize = window.serialize;
    if (window._old_serialize) window.serialize = window._old_serialize;
  });
  var form_submit = function(e) {
    e.preventDefault();
    if (validate_form()) {
      // use this trick to get the submit button & disable it using plain javascript
      document.querySelector('#_form_3_submit').disabled = true;
            var serialized = _form_serialize(document.getElementById('_form_3_'));
      var err = form_to_submit.querySelector('._form_error');
      err ? err.parentNode.removeChild(err) : false;
      _load_script('https://maciejkusz.activehosted.com/proc.php?' + serialized + '&jsonp=true');
    }
    return false;
  };aw
  addEvent(form_to_submit, 'submit', form_submit);
})();

</script></div>
<div class="sidebar-module sidebar-module-inset">
<h3>Linki</h3>
<ol class="list-unstyled">
<li><a href="../../pages/polityka-prywatnosci/">Polityka prywatnoci</a></li>
<li><a href="../../pages/regulamin/">Regulamin</a></li>
</ol>
<ol class="list-unstyled icons">
<li><a class="fas fa-at" href="mailto:maciej@testerembyc.pl" target="_bland"></a></li>
<li><a class="fab fa-facebook" href="https://www.facebook.com/testerembyc/" target="_blank"></a></li>
<li><a class="fab fa-instagram" href="https://www.instagram.com/testerembyc/" target="_blank"></a></li>
<li><a class="fab fa-linkedin" href="https://www.linkedin.com/in/maciej-kusz/" target="_blank"></a></li>
<li><a class="fab fa-youtube" href="https://www.youtube.com/channel/UCm3xa7IkyYBFSZrisCBx53A" target="_blank"></a></li>
</ol>
</div>
</div>
<!--End of body content--></div>
</div>
<footer class="blog-footer" id="footer">漏 2021 <span style="font-weight: bold; color: #ffffff;">Maciej Kusz</span> w oparciu o silnik <a href="https://getnikola.com/" rel="nofollow" target="_blank"><img src="../../images/nikola_logo.svg" style="max-height: 20px; max-width: 50px"></a> z wykorzystaniem <a href="https://pages.github.com/" rel="nofollow" target="_blank"><img src="../../images/githubpages_logo.svg" style="max-height: 15px; max-width: 80px;"></a></footer>
</div>
</div>
<script type="text/javascript">
/*
 * Bootstrap Cookie Alert by Wruczek
 * https://github.com/Wruczek/Bootstrap-Cookie-Alert
 * Released under MIT license
 */
(function () {
    "use strict";

    var cookieAlert = document.querySelector(".cookiealert");
    var acceptCookies = document.querySelector(".acceptcookies");

    if (!cookieAlert) {
       return;
    }


    // Show the alert if we cant find the "acceptCookies" cookie
    if (!getCookie("acceptCookies")) {
        cookieAlert.classList.add("show");
    } else {
        cookieAlert.classList.remove("show")
    }

    // When clicking on the agree button, create a 1 year
    // cookie to remember user's choice and close the banner
    acceptCookies.addEventListener("click", function () {
        setCookie("acceptCookies", true, 365);
        cookieAlert.classList.remove("show");
    });

    // Cookie functions from w3schools
    function setCookie(cname, cvalue, exdays) {
        var d = new Date();
        d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
        var expires = "expires=" + d.toUTCString();
        document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
    }

    function getCookie(cname) {
        var name = cname + "=";
        var decodedCookie = decodeURIComponent(document.cookie);
        var ca = decodedCookie.split(';');
        for (var i = 0; i < ca.length; i++) {
            var c = ca[i];
            while (c.charAt(0) === ' ') {
                c = c.substring(1);
            }
            if (c.indexOf(name) === 0) {
                return c.substring(name.length, c.length);
            }
        }
        return "";
    }
})();
</script>
<script src="../../assets/js/jquery.min.js"></script>
<script src="../../assets/js/bootstrap.min.js"></script>
<script src="../../assets/js/baguetteBox.min.js"></script>
<script src="../../assets/js/fancydates.min.js"></script><!-- fancy dates -->
<script>

    moment.locale("pl");
    fancydates(0, "YYYY-MM-DD HH:mm");
</script><!-- end fancy dates -->
<script>

    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
</script><!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-143859058-1"></script>
<script>

  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-143859058-1');
</script><!-- Load Facebook SDK for JavaScript -->
<div id="fb-root"></div>
<script>
  window.fbAsyncInit = function() {
    FB.init({
      xfbml            : true,
      version          : 'v3.3'
    });
  };

  (function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = 'https://connect.facebook.net/pl_PL/sdk/xfbml.customerchat.js';
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));
</script><!-- Your customer chat code -->
<div attribution="setup_tool" class="fb-customerchat" logged_in_greeting="Witaj! Jeli chcesz dowiedzie si czego wicej, to zapraszam do rozmowy ;)" logged_out_greeting="Witaj! Jeli chcesz dowiedzie si czego wicej, to zapraszam do rozmowy ;)" page_id="391052181505294" theme_color="#337ab7"></div>
<!-- Facebook Pixel Code -->
<script>
  !function(f,b,e,v,n,t,s)
  {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
  n.callMethod.apply(n,arguments):n.queue.push(arguments)};
  if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
  n.queue=[];t=b.createElement(e);t.async=!0;
  t.src=v;s=b.getElementsByTagName(e)[0];
  s.parentNode.insertBefore(t,s)}(window, document,'script',
  'https://connect.facebook.net/en_US/fbevents.js');
  fbq('init', '444619046317574');
  fbq('track', 'PageView');
</script><noscript><img alt="Facebook Pixel" height="1" src="https://www.facebook.com/tr?id=444619046317574&amp;ev=PageView&amp;noscript=1" style="display:none" width="1"></noscript> <!-- End Facebook Pixel Code -->
</body>
</html>
