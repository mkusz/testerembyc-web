function scriptPath(){var src,sel;return document.currentScript?src=document.currentScript.src:(sel=document.querySelector('script[src$="/chalkboard/plugin.js"]'))&&(src=sel.src),void 0===src?"":src.slice(0,src.lastIndexOf("/")+1)}window.RevealChalkboard=window.RevealChalkboard||{id:"RevealChalkboard",init:function(deck){initChalkboard.call(this,deck)},configure:function(config){configure(config)},toggleNotesCanvas:function(){toggleNotesCanvas()},toggleChalkboard:function(){toggleChalkboard()},colorIndex:function(){colorIndex()},colorNext:function(){colorNext()},colorPrev:function(){colorPrev()},clear:function(){clear()},reset:function(){reset()},resetAll:function(){resetAll()},updateStorage:function(){updateStorage()},getData:function(){return getData()},download:function(){download()}};var path=scriptPath();let initChalkboard=function(Reveal){var background,pens,draw,passiveSupported=!1;try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:function(){passiveSupported=!0}}))}catch(err){}var grid=!1,boardmarkerWidth=3,chalkWidth=7,chalkEffect=1,rememberColor=[!0,!1],eraser={src:path+"img/sponge.png",radius:20},boardmarkers=[{color:"rgba(100,100,100,1)",cursor:"url("+path+"img/boardmarker-black.png), auto"},{color:"rgba(30,144,255, 1)",cursor:"url("+path+"img/boardmarker-blue.png), auto"},{color:"rgba(220,20,60,1)",cursor:"url("+path+"img/boardmarker-red.png), auto"},{color:"rgba(50,205,50,1)",cursor:"url("+path+"img/boardmarker-green.png), auto"},{color:"rgba(255,140,0,1)",cursor:"url("+path+"img/boardmarker-orange.png), auto"},{color:"rgba(150,0,20150,1)",cursor:"url("+path+"img/boardmarker-purple.png), auto"},{color:"rgba(255,220,0,1)",cursor:"url("+path+"img/boardmarker-yellow.png), auto"}],chalks=[{color:"rgba(255,255,255,0.5)",cursor:"url("+path+"img/chalk-white.png), auto"},{color:"rgba(96, 154, 244, 0.5)",cursor:"url("+path+"img/chalk-blue.png), auto"},{color:"rgba(237, 20, 28, 0.5)",cursor:"url("+path+"img/chalk-red.png), auto"},{color:"rgba(20, 237, 28, 0.5)",cursor:"url("+path+"img/chalk-green.png), auto"},{color:"rgba(220, 133, 41, 0.5)",cursor:"url("+path+"img/chalk-orange.png), auto"},{color:"rgba(220,0,220,0.5)",cursor:"url("+path+"img/chalk-purple.png), auto"},{color:"rgba(255,220,0,0.5)",cursor:"url("+path+"img/chalk-yellow.png), auto"}],sponge={cursor:"url("+path+"img/sponge.png), auto"},keyBindings={toggleNotesCanvas:{keyCode:67,key:"C",description:"Toggle notes canvas"},toggleChalkboard:{keyCode:66,key:"B",description:"Toggle chalkboard"},clear:{keyCode:46,key:"DEL",description:"Clear drawings on slide"},resetAll:{keyCode:8,key:"BACKSPACE",description:"Reset all drawings"},colorNext:{keyCode:88,key:"X",description:"Next color"},colorPrev:{keyCode:89,key:"Y",description:"Previous color"},download:{keyCode:68,key:"D",description:"Download drawings"}},theme="chalkboard",color=[0,0],colorButtons=!0,boardHandle=!0,transition=800,readOnly=!1,messageType="broadcast",config=configure(Reveal.getConfig().chalkboard||{});if(config.keyBindings)for(var key in config.keyBindings)keyBindings[key]=config.keyBindings[key];function configure(config){return(config.boardmarkerWidth||config.penWidth)&&(boardmarkerWidth=config.boardmarkerWidth||config.penWidth),config.chalkWidth&&(chalkWidth=config.chalkWidth),config.chalkEffect&&(chalkEffect=config.chalkEffect),config.rememberColor&&(rememberColor=config.rememberColor),config.eraser&&(eraser=config.eraser),config.boardmarkers&&(boardmarkers=config.boardmarkers),config.chalks&&(chalks=config.chalks),config.theme&&(theme=config.theme),grid="whiteboard"===theme?(background=["rgba(127,127,127,.1)",path+"img/whiteboard.png"],draw=[drawWithBoardmarker,drawWithBoardmarker],pens=[boardmarkers,boardmarkers],{color:"rgb(127,127,255,0.1)",distance:40,width:2}):(background=["rgba(127,127,127,.1)",path+"img/blackboard.png"],draw=[drawWithBoardmarker,drawWithChalk],pens=[boardmarkers,chalks],{color:"rgb(50,50,10,0.5)",distance:80,width:2}),config.background&&(background=config.background),null!=config.grid&&(grid=config.grid),null!=config.toggleChalkboardButton&&config.toggleChalkboardButton,null!=config.toggleNotesButton&&config.toggleNotesButton,null!=config.colorButtons&&(colorButtons=config.colorButtons),null!=config.boardHandle&&(boardHandle=config.boardHandle),config.transition&&(transition=config.transition),null!=config.readOnly&&(readOnly=config.readOnly),config.messageType&&(messageType=config.messageType),drawingCanvas&&(config.theme||config.background||config.grid)&&(document.getElementById(drawingCanvas[1].id).style.background='url("'+background[1]+'") repeat',clearCanvas(1),drawGrid()),config}function whenReady(callback){document.querySelector("section[data-markdown]:not([data-markdown-parsed])")||document.querySelector("[data-load]:not([data-loaded])")||document.querySelector('code[data-line-numbers*="|"]')?(console.log("Wait for external sources to be loaded and code to be highlighted"),setTimeout(whenReady,500,callback)):callback()}function whenLoaded(callback){null!==loaded?callback():(console.log("Wait for drawings to be loaded"),setTimeout(whenLoaded,500,callback))}var drawingCanvas=[{id:"notescanvas"},{id:"chalkboard"}],mode=(setupDrawingCanvas(0),setupDrawingCanvas(1),0),board=0,mouseX=0,mouseY=0,lastX=null,lastY=null,drawing=!1,erasing=!1,slideStart=Date.now(),slideIndices={h:0,v:0},timeouts=[[],[]],slidechangeTimeout=null,updateStorageTimeout=null,playback=!1;function changeCursor(element,tool){element.style.cursor=tool.cursor;var palette=document.querySelector('.palette[data-mode="'+mode+'"]');palette&&(palette.style.cursor=tool.cursor)}function createPalette(colors,length){(!0===length||length>colors.length)&&(length=colors.length);for(var palette=document.createElement("div"),list=(palette.classList.add("palette"),document.createElement("ul")),i=0;i<length;i++){var colorButton=document.createElement("li");colorButton.setAttribute("data-color",i),colorButton.innerHTML='<i class="fa fa-square"></i>',colorButton.style.color=colors[i].color,colorButton.addEventListener("click",function(e){for(var element=e.target;!element.hasAttribute("data-color");)element=element.parentElement;colorIndex(parseInt(element.getAttribute("data-color")))}),colorButton.addEventListener("touchstart",function(e){for(var element=e.target;!element.hasAttribute("data-color");)element=element.parentElement;colorIndex(parseInt(element.getAttribute("data-color")))}),list.appendChild(colorButton)}var eraserButton=document.createElement("li"),spongeImg=(eraserButton.setAttribute("data-eraser","true"),document.createElement("img"));return spongeImg.src=eraser.src,spongeImg.height="24",spongeImg.width="24",spongeImg.style.marginTop="10px",spongeImg.style.marginRight="0",spongeImg.style.marginBottom="0",spongeImg.style.marginLeft="0",eraserButton.appendChild(spongeImg),eraserButton.addEventListener("click",function(e){colorIndex(-1)}),eraserButton.addEventListener("touchstart",function(e){colorIndex(-1)}),list.appendChild(eraserButton),palette.appendChild(list),palette}function switchBoard(boardIdx){selectBoard(boardIdx,!0);var message=new CustomEvent(messageType);message.content={sender:"chalkboard-plugin",type:"selectboard",timestamp:Date.now()-slideStart,mode:mode,board:board},document.dispatchEvent(message)}function setupDrawingCanvas(id){var aspectRatio,container=document.createElement("div"),palette=(container.id=drawingCanvas[id].id,container.classList.add("overlay"),container.setAttribute("data-prevent-swipe","true"),container.oncontextmenu=function(){return!1},changeCursor(container,pens[id][color[id]]),drawingCanvas[id].width=window.innerWidth,drawingCanvas[id].height=window.innerHeight,drawingCanvas[id].scale=1,drawingCanvas[id].xOffset=0,drawingCanvas[id].yOffset=0,"0"==id?(container.style.background="rgba(0,0,0,0)",container.style.zIndex=24,container.style.opacity=1,container.style.visibility="visible",container.style.pointerEvents="none",document.querySelector(".slides"),aspectRatio=Reveal.getConfig().width/Reveal.getConfig().height,drawingCanvas[id].width>drawingCanvas[id].height*aspectRatio?drawingCanvas[id].xOffset=(drawingCanvas[id].width-drawingCanvas[id].height*aspectRatio)/2:drawingCanvas[id].height>drawingCanvas[id].width/aspectRatio&&(drawingCanvas[id].yOffset=(drawingCanvas[id].height-drawingCanvas[id].width/aspectRatio)/2),colorButtons&&((palette=createPalette(boardmarkers,colorButtons)).dataset.mode=id,palette.style.visibility="hidden",container.appendChild(palette))):(container.style.background='url("'+background[id]+'") repeat',container.style.zIndex=26,container.style.opacity=0,container.style.visibility="hidden",colorButtons&&((palette=createPalette(chalks,colorButtons)).dataset.mode=id,container.appendChild(palette)),boardHandle&&((aspectRatio=document.createElement("div")).classList.add("boardhandle"),aspectRatio.innerHTML='<ul><li><a id="previousboard" href="#" title="Previous board"><i class="fas fa-chevron-up"></i></a></li><li><a id="nextboard" href="#" title="Next board"><i class="fas fa-chevron-down"></i></a></li></ul>',aspectRatio.querySelector("#previousboard").addEventListener("click",function(e){e.preventDefault(),switchBoard(board-1)}),aspectRatio.querySelector("#nextboard").addEventListener("click",function(e){e.preventDefault(),switchBoard(board+1)}),aspectRatio.querySelector("#previousboard").addEventListener("touchstart",function(e){e.preventDefault(),switchBoard(board-1)}),aspectRatio.querySelector("#nextboard").addEventListener("touchstart",function(e){e.preventDefault(),switchBoard(board+1)}),container.appendChild(aspectRatio))),document.createElement("canvas"));palette.width=drawingCanvas[id].width,palette.height=drawingCanvas[id].height,palette.setAttribute("data-chalkboard",id),changeCursor(palette,pens[id][color[id]]),container.appendChild(palette),drawingCanvas[id].canvas=palette,drawingCanvas[id].context=palette.getContext("2d"),(canvas=>{canvas.addEventListener("touchstart",function(evt){var scale,xOffset,yOffset,touch;evt.preventDefault(),readOnly||evt.target.getAttribute("data-chalkboard")!=mode||(scale=drawingCanvas[mode].scale,xOffset=drawingCanvas[mode].xOffset,yOffset=drawingCanvas[mode].yOffset,touch=evt.touches[0],mouseX=touch.pageX,mouseY=touch.pageY,(color[mode]<0?startErasing:startDrawing)((mouseX-xOffset)/scale,(mouseY-yOffset)/scale))},!!passiveSupported&&{passive:!1}),canvas.addEventListener("touchmove",function(evt){var scale,xOffset,yOffset,touch,message;evt.preventDefault(),(drawing||erasing)&&(scale=drawingCanvas[mode].scale,xOffset=drawingCanvas[mode].xOffset,yOffset=drawingCanvas[mode].yOffset,touch=evt.touches[0],mouseX=touch.pageX,mouseY=touch.pageY,drawing?(drawSegment((lastX-xOffset)/scale,(lastY-yOffset)/scale,(mouseX-xOffset)/scale,(mouseY-yOffset)/scale,color[mode]),(message=new CustomEvent(messageType)).content={sender:"chalkboard-plugin",type:"draw",timestamp:Date.now()-slideStart,mode:mode,board:board,fromX:(lastX-xOffset)/scale,fromY:(lastY-yOffset)/scale,toX:(mouseX-xOffset)/scale,toY:(mouseY-yOffset)/scale,color:color[mode]},document.dispatchEvent(message),lastX=mouseX,lastY=mouseY):(erasePoint((mouseX-xOffset)/scale,(mouseY-yOffset)/scale),(message=new CustomEvent(messageType)).content={sender:"chalkboard-plugin",type:"erase",timestamp:Date.now()-slideStart,mode:mode,board:board,x:(mouseX-xOffset)/scale,y:(mouseY-yOffset)/scale},document.dispatchEvent(message)))},!1),canvas.addEventListener("touchend",function(evt){evt.preventDefault(),stopDrawing(),stopErasing()},!1),canvas.addEventListener("mousedown",function(evt){var scale,xOffset,yOffset,message;evt.preventDefault(),readOnly||evt.target.getAttribute("data-chalkboard")!=mode||(scale=drawingCanvas[mode].scale,xOffset=drawingCanvas[mode].xOffset,yOffset=drawingCanvas[mode].yOffset,mouseX=evt.pageX,mouseY=evt.pageY,color[mode]<0||2==evt.button||1==evt.button?(0<=color[mode]&&changeCursor(drawingCanvas[mode].canvas,sponge),startErasing((mouseX-xOffset)/scale,(mouseY-yOffset)/scale),(message=new CustomEvent(messageType)).content={sender:"chalkboard-plugin",type:"erase",timestamp:Date.now()-slideStart,mode:mode,board:board,x:(mouseX-xOffset)/scale,y:(mouseY-yOffset)/scale},document.dispatchEvent(message)):startDrawing((mouseX-xOffset)/scale,(mouseY-yOffset)/scale))}),canvas.addEventListener("mousemove",function(evt){evt.preventDefault();var message,scale=drawingCanvas[mode].scale,xOffset=drawingCanvas[mode].xOffset,yOffset=drawingCanvas[mode].yOffset;mouseX=evt.pageX,mouseY=evt.pageY,(drawing||erasing)&&(scale=drawingCanvas[mode].scale,xOffset=drawingCanvas[mode].xOffset,yOffset=drawingCanvas[mode].yOffset,mouseX=evt.pageX,mouseY=evt.pageY,drawing?(drawSegment((lastX-xOffset)/scale,(lastY-yOffset)/scale,(mouseX-xOffset)/scale,(mouseY-yOffset)/scale,color[mode]),(message=new CustomEvent(messageType)).content={sender:"chalkboard-plugin",type:"draw",timestamp:Date.now()-slideStart,mode:mode,board:board,fromX:(lastX-xOffset)/scale,fromY:(lastY-yOffset)/scale,toX:(mouseX-xOffset)/scale,toY:(mouseY-yOffset)/scale,color:color[mode]},document.dispatchEvent(message),lastX=mouseX,lastY=mouseY):(erasePoint((mouseX-xOffset)/scale,(mouseY-yOffset)/scale),(message=new CustomEvent(messageType)).content={sender:"chalkboard-plugin",type:"erase",timestamp:Date.now()-slideStart,mode:mode,board:board,x:(mouseX-xOffset)/scale,y:(mouseY-yOffset)/scale},document.dispatchEvent(message)))}),canvas.addEventListener("mouseup",function(evt){evt.preventDefault(),0<=color[mode]&&changeCursor(drawingCanvas[mode].canvas,pens[mode][color[mode]]),(drawing||erasing)&&(stopDrawing(),stopErasing())})})(container),document.querySelector(".reveal").appendChild(container),drawingCanvas[id].container=container}var storage=[{width:Reveal.getConfig().width,height:Reveal.getConfig().height,data:[]},{width:Reveal.getConfig().width,height:Reveal.getConfig().height,data:[]}],loaded=null;if(!(loaded=config.storage?initStorage(sessionStorage.getItem(config.storage)):loaded)&&null!=config.src){var filename=config.src,xhr=new XMLHttpRequest;xhr.onload=function(){4===xhr.readyState&&404!=xhr.status?(loaded=initStorage(xhr.responseText),updateStorage(),console.log("Drawings loaded from file")):(config.readOnly=void 0,readOnly=void 0,console.warn("Failed to get file "+filename+". ReadyState: "+xhr.readyState+", Status: "+xhr.status),loaded=!1)},xhr.open("GET",filename,!0);try{xhr.send()}catch(error){config.readOnly=void 0,readOnly=void 0,console.warn("Failed to get file "+filename+". Make sure that the presentation and the file are served by a HTTP server and the file can be found there. "+error),loaded=!1}}function initStorage(json){var success=!1;try{for(var data=JSON.parse(json),id=0;id<data.length;id++)drawingCanvas[id].width==data[id].width&&drawingCanvas[id].height==data[id].height||(drawingCanvas[id].scale=Math.min(drawingCanvas[id].width/data[id].width,drawingCanvas[id].height/data[id].height),drawingCanvas[id].xOffset=(drawingCanvas[id].width-data[id].width*drawingCanvas[id].scale)/2,drawingCanvas[id].yOffset=(drawingCanvas[id].height-data[id].height*drawingCanvas[id].scale)/2),config.readOnly&&(drawingCanvas[id].container.style.cursor="default",drawingCanvas[id].canvas.style.cursor="default");success=!0,storage=data}catch(err){console.warn("Cannot initialise storage!")}return success}function storageChanged(now){updateStorageTimeout=now?(updateStorage(),null):(updateStorageTimeout&&clearTimeout(updateStorageTimeout),setTimeout(storageChanged,1e3,!0))}function updateStorage(){var json=JSON.stringify(storage);return config.storage&&sessionStorage.setItem(config.storage,json),json}function recordEvent(event){event.time=Date.now()-slideStart,1==mode&&(event.board=board);for(var slideData=getSlideData(),i=slideData.events.length;0<i&&event.time<slideData.events[i-1].time;)i--;slideData.events.splice(i,0,event),slideData.duration=Math.max(slideData.duration,Date.now()-slideStart)+1,storageChanged()}function getData(){for(var id=0;id<2;id++)for(var i=storage[id].data.length-1;0<=i;i--)0==storage[id].data[i].events.length&&storage[id].data.splice(i,1);return updateStorage()}function getSlideData(indices,id){null==id&&(id=mode),indices=indices||slideIndices;for(var i=0;i<storage[id].data.length;i++)if(storage[id].data[i].slide.h===indices.h&&storage[id].data[i].slide.v===indices.v&&storage[id].data[i].slide.f===indices.f)return storage[id].data[i];var page=Number(Reveal.getCurrentSlide().getAttribute("data-pdf-page-number"));return storage[id].data.push({slide:indices,page:page,events:[],duration:0}),storage[id].data[storage[id].data.length-1]}function getSlideDuration(indices){indices=indices||slideIndices;for(var duration=0,id=0;id<2;id++)for(var i=0;i<storage[id].data.length;i++)if(storage[id].data[i].slide.h===indices.h&&storage[id].data[i].slide.v===indices.v&&storage[id].data[i].slide.f===indices.f){duration=Math.max(duration,storage[id].data[i].duration);break}return duration}var printMode=/print-pdf/gi.test(window.location.search);function addPageNumbers(){for(var slides=Reveal.getSlides(),page=0,i=0;i<slides.length;i++){slides[i].setAttribute("data-pdf-page-number",page.toString());for(var count=slides[i].querySelectorAll(".fragment:not([data-fragment-index])").length,fragments=slides[i].querySelectorAll(".fragment[data-fragment-index]"),j=0;j<fragments.length;j++)Number(fragments[j].getAttribute("data-fragment-index"))+1>count&&(count=Number(fragments[j].getAttribute("data-fragment-index"))+1);page+=count+1}}function createPrintout(){var patImg;0!=storage[1].data.length&&(console.log("Create printout(s) for "+storage[1].data.length+" slides"),drawingCanvas[0].container.style.opacity=0,drawingCanvas[0].container.style.visibility="hidden",(patImg=new Image).onload=function(){for(var slides=Reveal.getSlides(),i=storage[1].data.length-1;0<=i;i--){console.log("Create printout for slide "+storage[1].data[i].slide.h+"."+storage[1].data[i].slide.v);var drawings=((slideData,patImg)=>{var width=Reveal.getConfig().width,height=Reveal.getConfig().height,scale=1,xOffset=0,yOffset=0,drawings=(width==storage[1].width&&height==storage[1].height||(scale=Math.min(width/storage[1].width,height/storage[1].height),xOffset=(width-storage[1].width*scale)/2,yOffset=(height-storage[1].height*scale)/2),mode=1,board=0,[]),template=document.createElement("canvas"),imgCtx=(template.width=width,template.height=height,template.getContext("2d"));imgCtx.fillStyle=imgCtx.createPattern(patImg,"repeat"),imgCtx.rect(0,0,width,height),imgCtx.fill();for(var j=0;j<slideData.events.length;j++)switch(slideData.events[j].type){case"draw":draw[1](getCanvas(template,drawings,board).getContext("2d"),xOffset+slideData.events[j].x1*scale,yOffset+slideData.events[j].y1*scale,xOffset+slideData.events[j].x2*scale,yOffset+slideData.events[j].y2*scale,yOffset+slideData.events[j].color);break;case"erase":eraseWithSponge(getCanvas(template,drawings,board).getContext("2d"),xOffset+slideData.events[j].x*scale,yOffset+slideData.events[j].y*scale);break;case"selectboard":selectBoard(slideData.events[j].board);break;case"clear":getCanvas(template,drawings,board).getContext("2d").clearRect(0,0,width,height),getCanvas(template,drawings,board).getContext("2d").fill()}return drawings=drawings.sort((a,b)=>a.board>b.board?1:-1),mode=0,drawings})(getSlideData(storage[1].data[i].slide,1),patImg);((slide,drawings)=>{for(var parent=slide.parentElement.parentElement,nextSlide=slide.parentElement.nextElementSibling,i=0;i<drawings.length;i++){var newPDFPage=document.createElement("div");newPDFPage.classList.add("pdf-page"),newPDFPage.style.height=Reveal.getConfig().height,newPDFPage.append(drawings[i].canvas),null!=nextSlide?parent.insertBefore(newPDFPage,nextSlide):parent.append(newPDFPage)}})(slides[storage[1].data[i].page],drawings)}},patImg.src=background[1])}function getCanvas(template,container,board){var newCanvas,context,idx=container.findIndex(element=>element.board===board);return-1===idx&&(template=template,newCanvas=document.createElement("canvas"),context=newCanvas.getContext("2d"),newCanvas.width=template.width,newCanvas.height=template.height,context.drawImage(template,0,0),context=newCanvas,container.length?board<container[0].board?(idx=0,container.unshift({board:board,canvas:context})):board>container[container.length-1].board&&(idx=container.length,container.push({board:board,canvas:context})):(idx=0,container.push({board:board,canvas:context}))),container[idx].canvas}function drawWithBoardmarker(context,fromX,fromY,toX,toY,colorIdx){null==colorIdx&&(colorIdx=color[mode]),context.lineWidth=boardmarkerWidth,context.lineCap="round",context.strokeStyle=boardmarkers[colorIdx].color,context.beginPath(),context.moveTo(fromX,fromY),context.lineTo(toX,toY),context.stroke()}function drawWithChalk(context,fromX,fromY,toX,toY,colorIdx){null==colorIdx&&(colorIdx=color[mode]);for(var xRandom,yCurrent,brushDiameter=chalkWidth,length=(context.lineWidth=brushDiameter,context.lineCap="round",context.fillStyle=chalks[colorIdx].color,context.strokeStyle=chalks[colorIdx].color,context.strokeStyle=context.strokeStyle.replace(/[\d\.]+\)$/g,"1)"),context.beginPath(),context.moveTo(fromX,fromY),context.lineTo(toX,toY),context.stroke(),Math.round(Math.sqrt(Math.pow(toX-fromX,2)+Math.pow(toY-fromY,2))/(5/brushDiameter))),xUnit=(toX-fromX)/length,yUnit=(toY-fromY)/length,i=0;i<length;i++)chalkEffect>.9*Math.random()&&(yCurrent=fromY+i*yUnit,xRandom=fromX+i*xUnit+(Math.random()-.5)*brushDiameter*1.2,yCurrent=yCurrent+(Math.random()-.5)*brushDiameter*1.2,context.clearRect(xRandom,yCurrent,2*Math.random()+2,Math.random()+1))}function eraseWithSponge(context,x,y){context.save(),context.beginPath(),context.arc(x+eraser.radius,y+eraser.radius,eraser.radius,0,2*Math.PI,!1),context.clip(),context.clearRect(x-1,y-1,2*eraser.radius+2,2*eraser.radius+2),context.restore(),1==mode&&grid&&((centerX,centerY,diameter)=>{for(var context=drawingCanvas[1].context,scale=(drawingCanvas[1].scale=Math.min(drawingCanvas[1].width/storage[1].width,drawingCanvas[1].height/storage[1].height),drawingCanvas[1].xOffset=(drawingCanvas[1].width-storage[1].width*drawingCanvas[1].scale)/2,drawingCanvas[1].yOffset=(drawingCanvas[1].height-storage[1].height*drawingCanvas[1].scale)/2,drawingCanvas[1].scale),distance=(drawingCanvas[1].xOffset,drawingCanvas[1].yOffset,grid.distance*scale),fromX=drawingCanvas[1].width/2-distance/2-Math.floor((drawingCanvas[1].width-distance)/2/distance)*distance,x=fromX+distance*Math.ceil((centerX-diameter-fromX)/distance);x<=fromX+distance*Math.floor((centerX+diameter-fromX)/distance);x+=distance)context.beginPath(),context.lineWidth=grid.width*scale,context.lineCap="round",context.fillStyle=grid.color,context.strokeStyle=grid.color,context.moveTo(x,centerY-Math.sqrt(diameter*diameter-(centerX-x)*(centerX-x))),context.lineTo(x,centerY+Math.sqrt(diameter*diameter-(centerX-x)*(centerX-x))),context.stroke();for(var fromY=drawingCanvas[1].height/2-distance/2-Math.floor((drawingCanvas[1].height-distance)/2/distance)*distance,y=fromY+distance*Math.ceil((centerY-diameter-fromY)/distance);y<=fromY+distance*Math.floor((centerY+diameter-fromY)/distance);y+=distance)context.beginPath(),context.lineWidth=grid.width*scale,context.lineCap="round",context.fillStyle=grid.color,context.strokeStyle=grid.color,context.moveTo(centerX-Math.sqrt(diameter*diameter-(centerY-y)*(centerY-y)),y),context.lineTo(centerX+Math.sqrt(diameter*diameter-(centerY-y)*(centerY-y)),y),context.stroke()})(x+eraser.radius,y+eraser.radius,eraser.radius)}function showChalkboard(){drawingCanvas[1].container.style.opacity=1,drawingCanvas[1].container.style.visibility="visible",mode=1}function closeChalkboard(){drawingCanvas[1].container.style.opacity=0,drawingCanvas[1].container.style.visibility="hidden",lastY=lastX=null,mode=0}function clearCanvas(id){0==id&&clearTimeout(slidechangeTimeout),drawingCanvas[id].context.clearRect(0,0,drawingCanvas[id].width,drawingCanvas[id].height),1==id&&grid&&drawGrid()}function drawGrid(){for(var context=drawingCanvas[1].context,scale=(drawingCanvas[1].scale=Math.min(drawingCanvas[1].width/storage[1].width,drawingCanvas[1].height/storage[1].height),drawingCanvas[1].xOffset=(drawingCanvas[1].width-storage[1].width*drawingCanvas[1].scale)/2,drawingCanvas[1].yOffset=(drawingCanvas[1].height-storage[1].height*drawingCanvas[1].scale)/2,drawingCanvas[1].scale),distance=(drawingCanvas[1].xOffset,drawingCanvas[1].yOffset,grid.distance*scale),x=drawingCanvas[1].width/2-distance/2-Math.floor((drawingCanvas[1].width-distance)/2/distance)*distance;x<drawingCanvas[1].width;x+=distance)context.beginPath(),context.lineWidth=grid.width*scale,context.lineCap="round",context.fillStyle=grid.color,context.strokeStyle=grid.color,context.moveTo(x,0),context.lineTo(x,drawingCanvas[1].height),context.stroke();for(var y=drawingCanvas[1].height/2-distance/2-Math.floor((drawingCanvas[1].height-distance)/2/distance)*distance;y<drawingCanvas[1].height;y+=distance)context.beginPath(),context.lineWidth=grid.width*scale,context.lineCap="round",context.fillStyle=grid.color,context.strokeStyle=grid.color,context.moveTo(0,y),context.lineTo(drawingCanvas[1].width,y),context.stroke()}function setColor(index){index>=pens[mode].length&&(index=0),color[mode]=index,color[mode]<0?changeCursor(drawingCanvas[mode].canvas,sponge):changeCursor(drawingCanvas[mode].canvas,pens[mode][color[mode]])}function selectBoard(boardIdx,record){board!=boardIdx&&(redrawChalkboard(board=boardIdx),record)&&recordEvent({type:"selectboard"})}function redrawChalkboard(boardIdx){clearCanvas(1);for(var slideData=getSlideData(slideIndices,1),index=0;index<slideData.events.length&&slideData.events[index].time<Date.now()-slideStart;)boardIdx==slideData.events[index].board&&playEvent(1,slideData.events[index],Date.now()-slideStart),index++}var eventQueue=[];function startPlayback(timestamp,finalMode){slideStart=Date.now()-timestamp,closeChalkboard();for(var id=board=mode=0;id<2;id++){clearCanvas(id);for(var slideData=getSlideData(slideIndices,id),index=0;index<slideData.events.length&&slideData.events[index].time<Date.now()-slideStart;)playEvent(id,slideData.events[index],timestamp),index++;for(;playback&&index<slideData.events.length;)timeouts[id].push(setTimeout(playEvent,slideData.events[index].time-(Date.now()-slideStart),id,slideData.events[index],timestamp)),index++}1==(mode=null!=finalMode?finalMode:mode)&&showChalkboard()}function stopPlayback(){for(var id=0;id<2;id++){for(var i=0;i<timeouts[id].length;i++)clearTimeout(timeouts[id][i]);timeouts[id]=[]}}function playEvent(id,event,timestamp){switch(event.type){case"open":timestamp<=event.time?showChalkboard():mode=1;break;case"close":timestamp<event.time?closeChalkboard():mode=0;break;case"clear":clearCanvas(id);break;case"selectboard":selectBoard(event.board);break;case"draw":((id,event)=>{var ctx=drawingCanvas[id].context,scale=drawingCanvas[id].scale,xOffset=drawingCanvas[id].xOffset,yOffset=drawingCanvas[id].yOffset;draw[id](ctx,xOffset+event.x1*scale,yOffset+event.y1*scale,xOffset+event.x2*scale,yOffset+event.y2*scale,event.color)})(id,event);break;case"erase":((id,event)=>{var ctx=drawingCanvas[id].context,scale=drawingCanvas[id].scale,xOffset=drawingCanvas[id].xOffset,yOffset=drawingCanvas[id].yOffset;eraseWithSponge(ctx,xOffset+event.x*scale,yOffset+event.y*scale)})(id,event)}}function startErasing(x,y){erasing=!(drawing=!1),erasePoint(x,y)}function erasePoint(x,y){var ctx=drawingCanvas[mode].context,scale=drawingCanvas[mode].scale,xOffset=drawingCanvas[mode].xOffset,yOffset=drawingCanvas[mode].yOffset;recordEvent({type:"erase",x:x,y:y}),0<x*scale+xOffset&&0<y*scale+yOffset&&x*scale+xOffset<drawingCanvas[mode].width&&y*scale+yOffset<drawingCanvas[mode].height&&eraseWithSponge(ctx,x*scale+xOffset,y*scale+yOffset)}function stopErasing(){erasing=!1}function startDrawing(x,y){drawing=!0;drawingCanvas[mode].context;var scale=drawingCanvas[mode].scale,xOffset=drawingCanvas[mode].xOffset,yOffset=drawingCanvas[mode].yOffset;lastX=x*scale+xOffset,lastY=y*scale+yOffset}function drawSegment(fromX,fromY,toX,toY,colorIdx){var ctx=drawingCanvas[mode].context,scale=drawingCanvas[mode].scale,xOffset=drawingCanvas[mode].xOffset,yOffset=drawingCanvas[mode].yOffset;recordEvent({type:"draw",color:colorIdx,x1:fromX,y1:fromY,x2:toX,y2:toY}),0<fromX*scale+xOffset&&0<fromY*scale+yOffset&&fromX*scale+xOffset<drawingCanvas[mode].width&&fromY*scale+yOffset<drawingCanvas[mode].height&&0<toX*scale+xOffset&&0<toY*scale+yOffset&&toX*scale+xOffset<drawingCanvas[mode].width&&toY*scale+yOffset<drawingCanvas[mode].height&&draw[mode](ctx,fromX*scale+xOffset,fromY*scale+yOffset,toX*scale+xOffset,toY*scale+yOffset,colorIdx)}function stopDrawing(){drawing=!1}function resize(){var timestamp=Date.now()-slideStart;playback||(timestamp=getSlideDuration());for(var id=0;id<2;id++)drawingCanvas[id].width=window.innerWidth,drawingCanvas[id].height=window.innerHeight,drawingCanvas[id].canvas.width=drawingCanvas[id].width,drawingCanvas[id].canvas.height=drawingCanvas[id].height,drawingCanvas[id].context.canvas.width=drawingCanvas[id].width,drawingCanvas[id].context.canvas.height=drawingCanvas[id].height,drawingCanvas[id].scale=Math.min(drawingCanvas[id].width/storage[id].width,drawingCanvas[id].height/storage[id].height),drawingCanvas[id].xOffset=(drawingCanvas[id].width-storage[id].width*drawingCanvas[id].scale)/2,drawingCanvas[id].yOffset=(drawingCanvas[id].height-storage[id].height*drawingCanvas[id].scale)/2;startPlayback(timestamp,mode)}function toggleChalkboard(){var message;1==mode?(readOnly||recordEvent({type:"close"}),closeChalkboard(),(message=new CustomEvent(messageType)).content={sender:"chalkboard-plugin",type:"closeChalkboard",timestamp:Date.now()-slideStart,mode:0,board:board},document.dispatchEvent(message)):(showChalkboard(),readOnly||(recordEvent({type:"open"}),(message=new CustomEvent(messageType)).content={sender:"chalkboard-plugin",type:"showChalkboard",timestamp:Date.now()-slideStart,mode:1,board:board},document.dispatchEvent(message),message=0,setColor(message=rememberColor[mode]?color[mode]:message)))}function clearSlide(){recordEvent({type:"clear"}),clearCanvas(mode)}function colorIndex(idx){readOnly||setColor(idx)}function resetSlideDrawings(){slideStart=Date.now(),closeChalkboard(),clearCanvas(0),clearCanvas(1),mode=1;var slideData=getSlideData();slideData.duration=0,slideData.events=[],mode=0,(slideData=getSlideData()).duration=0,slideData.events=[],updateStorage()}function resetSlide(force){var message;(force||confirm("Please confirm to delete chalkboard drawings on this slide!"))&&(stopPlayback(),resetSlideDrawings(),(message=new CustomEvent(messageType)).content={sender:"chalkboard-plugin",type:"resetSlide",timestamp:Date.now()-slideStart,mode:mode,board:board},document.dispatchEvent(message))}for(key in document.addEventListener("received",function(message){message.content&&"chalkboard-plugin"==message.content.sender&&(eventQueue.push(message),console.log(JSON.stringify(message))),1==eventQueue.length&&function processQueue(){var message=eventQueue.shift();slideStart=Date.now()-message.content.timestamp;mode<message.content.mode?showChalkboard():mode>message.content.mode&&closeChalkboard();board!=message.content.board&&redrawChalkboard(board=message.content.board);switch(message.content.type){case"showChalkboard":showChalkboard();break;case"closeChalkboard":closeChalkboard();break;case"erase":erasePoint(message.content.x,message.content.y);break;case"draw":drawSegment(message.content.fromX,message.content.fromY,message.content.toX,message.content.toY,message.content.color);break;case"clear":clearSlide();break;case"selectboard":selectBoard(message.content.board,!0);break;case"resetSlide":resetSlideDrawings();break;case"init":storage=message.content.storage;for(var id=0;id<2;id++)drawingCanvas[id].scale=Math.min(drawingCanvas[id].width/storage[id].width,drawingCanvas[id].height/storage[id].height),drawingCanvas[id].xOffset=(drawingCanvas[id].width-storage[id].width*drawingCanvas[id].scale)/2,drawingCanvas[id].yOffset=(drawingCanvas[id].height-storage[id].height*drawingCanvas[id].scale)/2;clearCanvas(0),clearCanvas(1),playback||(slidechangeTimeout=setTimeout(startPlayback,transition,getSlideDuration(),0)),1==mode&&0==message.content.mode&&setTimeout(closeChalkboard,transition+50),0==mode&&1==message.content.mode&&setTimeout(showChalkboard,transition+50),mode=message.content.mode,board=message.content.board}(0<eventQueue.length?processQueue:storageChanged)()}()}),document.addEventListener("welcome",function(user){var message=new CustomEvent(messageType);message.content={sender:"chalkboard-plugin",recipient:user.id,type:"init",timestamp:Date.now()-slideStart,storage:storage,mode:mode,board:board},document.dispatchEvent(message)}),document.addEventListener("seekplayback",function(event){stopPlayback(),playback&&0!=event.timestamp||startPlayback(event.timestamp)}),document.addEventListener("startplayback",function(event){stopPlayback(),playback=!0,startPlayback(event.timestamp)}),document.addEventListener("stopplayback",function(event){playback=!1,stopPlayback()}),document.addEventListener("startrecording",function(event){resetSlide(!0),slideStart=Date.now()}),Reveal.addEventListener("pdf-ready",function(evt){whenLoaded(createPrintout)}),Reveal.addEventListener("ready",function(evt){var event;printMode||(window.addEventListener("resize",resize),slideStart=Date.now()-getSlideDuration(),slideIndices=Reveal.getIndices(),playback||startPlayback(getSlideDuration(),0),Reveal.isAutoSliding()&&((event=new CustomEvent("startplayback")).timestamp=0,document.dispatchEvent(event)),updateStorage(),whenReady(addPageNumbers))}),Reveal.addEventListener("slidechanged",function(evt){var event;printMode||(slideStart=Date.now()-getSlideDuration(),slideIndices=Reveal.getIndices(),closeChalkboard(),clearCanvas(board=0),clearCanvas(1),playback||(slidechangeTimeout=setTimeout(startPlayback,transition,getSlideDuration(),0)),Reveal.isAutoSliding()&&((event=new CustomEvent("startplayback")).timestamp=0,document.dispatchEvent(event)))}),Reveal.addEventListener("fragmentshown",function(evt){var event;printMode||(slideStart=Date.now()-getSlideDuration(),slideIndices=Reveal.getIndices(),closeChalkboard(),clearCanvas(board=0),clearCanvas(1),Reveal.isAutoSliding()?((event=new CustomEvent("startplayback")).timestamp=0,document.dispatchEvent(event)):playback||startPlayback(getSlideDuration(),0))}),Reveal.addEventListener("fragmenthidden",function(evt){printMode||(slideStart=Date.now()-getSlideDuration(),slideIndices=Reveal.getIndices(),closeChalkboard(),clearCanvas(board=0),clearCanvas(1),Reveal.isAutoSliding()?document.dispatchEvent(new CustomEvent("stopplayback")):playback||(startPlayback(getSlideDuration()),closeChalkboard()))}),Reveal.addEventListener("autoslideresumed",function(evt){var event=new CustomEvent("startplayback");event.timestamp=0,document.dispatchEvent(event)}),Reveal.addEventListener("autoslidepaused",function(evt){document.dispatchEvent(new CustomEvent("stopplayback")),startPlayback(getSlideDuration(),0)}),this.toggleNotesCanvas=function(){var idx;readOnly||(1==mode?(toggleChalkboard(),notescanvas.style.background=background[0],notescanvas.style.pointerEvents="auto"):"none"!=notescanvas.style.pointerEvents?(colorButtons&&(notescanvas.querySelector(".palette").style.visibility="hidden"),notescanvas.style.background="rgba(0,0,0,0)",notescanvas.style.pointerEvents="none"):(colorButtons&&(notescanvas.querySelector(".palette").style.visibility="visible"),notescanvas.style.background=background[0],notescanvas.style.pointerEvents="auto",idx=0,setColor(idx=color[mode]?color[mode]:idx)))},this.toggleChalkboard=toggleChalkboard,this.colorIndex=colorIndex,this.colorNext=function(){readOnly||(color[mode]=(color[mode]+1)%pens[mode].length,setColor(color[mode]))},this.colorPrev=function(){readOnly||(color[mode]=(color[mode]+(pens[mode].length-1))%pens[mode].length,setColor(color[mode]))},this.clear=function(){var message;readOnly||(clearSlide(),(message=new CustomEvent(messageType)).content={sender:"chalkboard-plugin",type:"clear",timestamp:Date.now()-slideStart,mode:mode,board:board},document.dispatchEvent(message))},this.reset=resetSlide,this.resetAll=function(force){var message;(force||confirm("Please confirm to delete all chalkboard drawings!"))&&(stopPlayback(),slideStart=Date.now(),clearCanvas(0),clearCanvas(1),1==mode&&closeChalkboard(),storage=[{width:Reveal.getConfig().width,height:Reveal.getConfig().height,data:[]},{width:Reveal.getConfig().width,height:Reveal.getConfig().height,data:[]}],config.storage&&sessionStorage.setItem(config.storage,null),(message=new CustomEvent(messageType)).content={sender:"chalkboard-plugin",type:"init",timestamp:Date.now()-slideStart,storage:storage,mode:mode,board:board},document.dispatchEvent(message))},this.download=function(){var a=document.createElement("a");document.body.appendChild(a);try{a.download="chalkboard.json";var blob=new Blob([getData()],{type:"application/json"});a.href=window.URL.createObjectURL(blob)}catch(error){error=String(error).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),a.innerHTML+=" ("+error+")"}a.click(),document.body.removeChild(a)},this.updateStorage=updateStorage,this.getData=getData,this.configure=configure,keyBindings)keyBindings[key]&&Reveal.addKeyBinding(keyBindings[key],RevealChalkboard[key]);return this};