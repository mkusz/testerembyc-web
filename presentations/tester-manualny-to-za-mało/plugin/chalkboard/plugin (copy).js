function scriptPath(){var e;if(document.currentScript)e=document.currentScript.src;else{var t=document.querySelector('script[src$="/chalkboard/plugin.js"]');t&&(e=t.src)}return void 0===e?"":e.slice(0,e.lastIndexOf("/")+1)}window.RevealChalkboard=window.RevealChalkboard||{id:"RevealChalkboard",init:function(e){initChalkboard(e)},configure:function(e){configure(e)},toggleNotesCanvas:function(){toggleNotesCanvas()},toggleChalkboard:function(){toggleChalkboard()},colorIndex:function(){colorIndex()},colorNext:function(){colorNext()},colorPrev:function(){colorPrev()},clear:function(){clear()},reset:function(){reset()},resetAll:function(){resetAll()},updateStorage:function(){updateStorage()},getData:function(){return getData()},download:function(){download()}};var path=scriptPath();const initChalkboard=function(e){var t,n,a=!1;try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:function(){a=!0}}))}catch(e){}var o,i=!1,r=3,s=7,l=1,d=[!0,!1],c={src:path+"img/sponge.png",radius:20},h=[{color:"rgba(100,100,100,1)",cursor:"url("+path+"img/boardmarker-black.png), auto"},{color:"rgba(30,144,255, 1)",cursor:"url("+path+"img/boardmarker-blue.png), auto"},{color:"rgba(220,20,60,1)",cursor:"url("+path+"img/boardmarker-red.png), auto"},{color:"rgba(50,205,50,1)",cursor:"url("+path+"img/boardmarker-green.png), auto"},{color:"rgba(255,140,0,1)",cursor:"url("+path+"img/boardmarker-orange.png), auto"},{color:"rgba(150,0,20150,1)",cursor:"url("+path+"img/boardmarker-purple.png), auto"},{color:"rgba(255,220,0,1)",cursor:"url("+path+"img/boardmarker-yellow.png), auto"}],u=[{color:"rgba(255,255,255,0.5)",cursor:"url("+path+"img/chalk-white.png), auto"},{color:"rgba(96, 154, 244, 0.5)",cursor:"url("+path+"img/chalk-blue.png), auto"},{color:"rgba(237, 20, 28, 0.5)",cursor:"url("+path+"img/chalk-red.png), auto"},{color:"rgba(20, 237, 28, 0.5)",cursor:"url("+path+"img/chalk-green.png), auto"},{color:"rgba(220, 133, 41, 0.5)",cursor:"url("+path+"img/chalk-orange.png), auto"},{color:"rgba(220,0,220,0.5)",cursor:"url("+path+"img/chalk-purple.png), auto"},{color:"rgba(255,220,0,0.5)",cursor:"url("+path+"img/chalk-yellow.png), auto"}],g={toggleNotesCanvas:{keyCode:67,key:"C",description:"Toggle notes canvas"},toggleChalkboard:{keyCode:66,key:"B",description:"Toggle chalkboard"},clear:{keyCode:171,key:"+",description:"Clear drawings on slide"},reset:{keyCode:46,key:"DEL",description:"Reset drawings on slide"},resetAll:{keyCode:8,key:"BACKSPACE",description:"Reset all drawings"},colorNext:{keyCode:88,key:"X",description:"Next color"},colorPrev:{keyCode:89,key:"Y",description:"Previous color"},download:{keyCode:68,key:"D",description:"Download drawings"}},v="chalkboard",p=[0,0],f=!0,m=!0,b=!0,y=!0,w=800,k=!1,C="broadcast",x=D(e.getConfig().chalkboard||{});if(x.keyBindings)for(var E in x.keyBindings)g[E]=x.keyBindings[E];function D(e){switch((e.boardmarkerWidth||e.penWidth)&&(r=e.boardmarkerWidth||e.penWidth),e.chalkWidth&&(s=e.chalkWidth),e.chalkEffect&&(l=e.chalkEffect),e.rememberColor&&(d=e.rememberColor),e.eraser&&(c=e.eraser),e.boardmarkers&&(h=e.boardmarkers),e.chalks&&(u=e.chalks),e.theme&&(v=e.theme),v){case"whiteboard":t=["rgba(127,127,127,.1)",path+"img/whiteboard.png"],n=[te,te],pens=[h,h],i={color:"rgb(127,127,255,0.1)",distance:40,width:2};break;case"chalkboard":default:t=["rgba(127,127,127,.1)",path+"img/blackboard.png"],n=[te,ne],pens=[h,u],i={color:"rgb(50,50,10,0.5)",distance:80,width:2}}(e.background&&(t=e.background),null!=e.grid&&(i=e.grid),null!=e.toggleChalkboardButton&&(f=e.toggleChalkboardButton),null!=e.toggleNotesButton&&(m=e.toggleNotesButton),null!=e.colorButtons&&(b=e.colorButtons),null!=e.boardHandle&&(y=e.boardHandle),e.transition&&(w=e.transition),null!=e.readOnly&&(k=e.readOnly),e.messageType&&(C=e.messageType),O&&(e.theme||e.background||e.grid))&&(document.getElementById(O[1].id).style.background='url("'+t[1]+'") repeat',re(1),se());return e}function S(e){document.querySelectorAll(".pdf-page").length&&null!==F?e():(console.log("Wait for pdf pages to be created and drawings to be loaded"),setTimeout(S,500,e))}f&&((o=document.createElement("div")).className="chalkboard-button",o.id="toggle-chalkboard",o.style.visibility="visible",o.style.position="absolute",o.style.zIndex=30,o.style.fontSize="24px",o.style.left=f.left||"30px",o.style.bottom=f.bottom||"30px",o.style.top=f.top||"auto",o.style.right=f.right||"auto",o.innerHTML='<a href="#" title="Toggle chalkboard ('+g.toggleChalkboard.key+')" onclick="RevealChalkboard.toggleChalkboard(); return false;"><i class="fa fa-pen-square"></i></a>',document.querySelector(".reveal").appendChild(o));m&&((o=document.createElement("div")).className="chalkboard-button",o.id="toggle-notes",o.style.position="absolute",o.style.zIndex=30,o.style.fontSize="24px",o.style.left=m.left||"70px",o.style.bottom=m.bottom||"30px",o.style.top=m.top||"auto",o.style.right=m.right||"auto",o.innerHTML='<a href="#" title="Toggle slide annotation ('+g.toggleNotesCanvas.key+')" onclick="RevealChalkboard.toggleNotesCanvas(); return false;"><i class="fa fa-pen"></i></a>',document.querySelector(".reveal").appendChild(o));var O=[{id:"notescanvas"},{id:"chalkboard"}];j(0),j(1);var T=0,M=0,L=0,A=0,P=null,q=null,I=Date.now(),N={h:0,v:0},R=null,B=[[],[]],W=null,H=null,z=!1;function X(e,t){(!0===t||t>e.length)&&(t=e.length);var n=document.createElement("div");n.classList.add("palette");for(var a=document.createElement("ul"),o=0;o<t;o++){var i=document.createElement("li");i.setAttribute("data-color",o),i.innerHTML='<i class="fa fa-square"></i>',i.style.color=e[o].color,i.addEventListener("click",function(e){ke(e.target.parentElement.getAttribute("data-color"))}),a.appendChild(i)}return n.appendChild(a),n}function j(n){var a=document.createElement("div");if(a.id=O[n].id,a.classList.add("overlay"),a.setAttribute("data-prevent-swipe",""),a.oncontextmenu=function(){return!1},a.style.cursor=pens[n][p[n]].cursor,O[n].width=window.innerWidth,O[n].height=window.innerHeight,O[n].scale=1,O[n].xOffset=0,O[n].yOffset=0,"0"==n){a.style.background="rgba(0,0,0,0)",a.style.zIndex=24,a.style.opacity=1,a.style.visibility="visible",a.style.pointerEvents="none";document.querySelector(".slides");var o=e.getConfig().width/e.getConfig().height;if(O[n].width>O[n].height*o?O[n].xOffset=(O[n].width-O[n].height*o)/2:O[n].height>O[n].width/o&&(O[n].yOffset=(O[n].height-O[n].width/o)/2),b)(i=X(h,b)).style.visibility="hidden",a.appendChild(i)}else{if(a.style.background='url("'+t[n]+'") repeat',a.style.zIndex=26,a.style.opacity=0,a.style.visibility="hidden",b){var i=X(u,b);a.appendChild(i)}if(y){var r=document.createElement("div");r.classList.add("boardhandle"),r.innerHTML='<ul><li><a id="previousboard" href="#" title="Previous board"><i class="fas fa-chevron-up"></i></a></li><li><a id="nextboard" href="#" title="Next board"><i class="fas fa-chevron-down"></i></a></li></ul>',r.querySelector("#previousboard").addEventListener("click",function(e){e.preventDefault(),de(M-1,!0)}),r.querySelector("#nextboard").addEventListener("click",function(e){e.preventDefault(),de(M+1,!0)}),a.appendChild(r)}}var s=document.createElement("img");s.src=c.src,s.id="sponge",s.style.visibility="hidden",s.style.position="absolute",a.appendChild(s),O[n].sponge=s;var l=document.createElement("canvas");l.width=O[n].width,l.height=O[n].height,l.setAttribute("data-chalkboard",n),l.style.cursor=pens[n][p[n]].cursor,a.appendChild(l),O[n].canvas=l,O[n].context=l.getContext("2d"),document.querySelector(".reveal").appendChild(a),O[n].container=a}var Y=[{width:e.getConfig().width,height:e.getConfig().height,data:[]},{width:e.getConfig().width,height:e.getConfig().height,data:[]}],F=null;function J(e){var t=!1;try{for(var n=JSON.parse(e),a=0;a<n.length;a++)O[a].width==n[a].width&&O[a].height==n[a].height||(O[a].scale=Math.min(O[a].width/n[a].width,O[a].height/n[a].height),O[a].xOffset=(O[a].width-n[a].width*O[a].scale)/2,O[a].yOffset=(O[a].height-n[a].height*O[a].scale)/2),x.readOnly&&(O[a].container.style.cursor="default",O[a].canvas.style.cursor="default");t=!0,Y=n}catch(e){console.warn("Cannot initialise storage!")}return t}function K(){var e=JSON.stringify(Y);return x.storage&&sessionStorage.setItem(x.storage,e),e}function U(){for(var e=0;e<2;e++)for(var t=Y[e].data.length-1;t>=0;t--)0==Y[e].data[t].events.length&&Y[e].data.splice(t,1);return K()}function $(e,t){null==t&&(t=T),e||(e=N);for(var n=0;n<Y[t].data.length;n++)if(Y[t].data[n].slide.h===e.h&&Y[t].data[n].slide.v===e.v&&Y[t].data[n].slide.f===e.f)return Y[t].data[n];return Y[t].data.push({slide:e,events:[],duration:0}),Y[t].data[Y[t].data.length-1]}function G(e){e||(e=N);for(var t=0,n=0;n<2;n++)for(var a=0;a<Y[n].data.length;a++)if(Y[n].data[a].slide.h===e.h&&Y[n].data[a].slide.v===e.v&&Y[n].data[a].slide.f===e.f){t=Math.max(t,Y[n].data[a].duration);break}return t}x.storage&&(F=J(sessionStorage.getItem(x.storage))),F||null==x.src||function(e){var t=new XMLHttpRequest;t.onload=function(){4===t.readyState&&404!=t.status?(F=J(t.responseText),console.log("Drawings loaded from file")):(x.readOnly=void 0,k=void 0,console.warn("Failed to get file "+e+". ReadyState: "+t.readyState+", Status: "+t.status),F=!1)},t.open("GET",e,!0);try{t.send()}catch(t){x.readOnly=void 0,k=void 0,console.warn("Failed to get file "+e+". Make sure that the presentation and the file are served by a HTTP server and the file can be found there. "+t),F=!1}}(x.src);var Q=/print-pdf/gi.test(window.location.search);function V(){if(console.warn(e.getTotalSlides(),e.getSlidesElement()),0!=Y[1].data.length){console.log("Create printout(s) for "+Y[1].data.length+" slides"),O[0].container.style.opacity=0,O[0].container.style.visibility="hidden";var n=new Image;n.onload=function(){for(var e=function(){for(var e=document.querySelectorAll(".slides > div.pdf-page > section, .slides > section"),t=[],n=void 0,a=0;a<e.length;a++)if(e[a].parentElement.classList.contains("pdf-page"))e[a].getAttribute("data-slide-number")!=n?(t.push([]),t[t.length-1].push(e[a]),n=e[a].getAttribute("data-slide-number")):t[t.length-1][t[t.length-1].length-1]=e[a];else{var o=e[a].querySelectorAll("section");t.push([]);for(var n=void 0,i=0;i<o.length;i++)o[i].getAttribute("data-slide-number")!=n?(t[t.length-1].push(o[i]),n=o[i].getAttribute("data-slide-number")):t[t.length-1][t[t.length-1].length-1]=o[i]}return t}(),t=Y[1].data.length-1;t>=0;t--){console.log("Create printout for slide "+Y[1].data[t].slide.h+"."+Y[1].data[t].slide.v);var a=_($(Y[1].data[t].slide,1),n);ee(e[Y[1].data[t].slide.h][Y[1].data[t].slide.v],a)}},n.src=t[1]}}function Z(e,t,n){var a,o,i,r=t.findIndex(e=>e.board===n);if(-1===r){var s=(a=e,o=document.createElement("canvas"),i=o.getContext("2d"),o.width=a.width,o.height=a.height,i.drawImage(a,0,0),o);t.length?n<t[0].board?(r=0,t.unshift({board:n,canvas:s})):n>t[t.length-1].board&&(r=t.length,t.push({board:n,canvas:s})):(r=0,t.push({board:n,canvas:s}))}return t[r].canvas}function _(t,a){var o=e.getConfig().width,i=e.getConfig().height,r=1,s=0,l=0;o==Y[1].width&&i==Y[1].height||(r=Math.min(o/Y[1].width,i/Y[1].height),s=(o-Y[1].width*r)/2,l=(i-Y[1].height*r)/2),T=1,M=0,console.log("Create printout(s) for slide ",t);var d=[],c=document.createElement("canvas");c.width=o,c.height=i;var h=c.getContext("2d");h.fillStyle=h.createPattern(a,"repeat"),h.rect(0,0,o,i),h.fill();for(var u=0;u<t.events.length;u++)switch(t.events[u].type){case"draw":for(var g=1;g<t.events[u].curve.length;g++)n[1](Z(c,d,M).getContext("2d"),s+t.events[u].curve[g-1].x*r,l+t.events[u].curve[g-1].y*r,s+t.events[u].curve[g].x*r,l+t.events[u].curve[g].y*r);break;case"erase":for(g=0;g<t.events[u].curve.length;g++)ae(Z(c,d,M).getContext("2d"),s+t.events[u].curve[g].x*r,l+t.events[u].curve[g].y*r);break;case"setcolor":le(t.events[u].index);break;case"setboard":de(t.events[u].index);break;case"clear":Z(c,d,M).getContext("2d").clearRect(0,0,o,i),Z(c,d,M).getContext("2d").fill()}return d=d.sort((e,t)=>e.board>t.board?1:-1),T=0,d}function ee(t,n){for(var a=t.parentElement.parentElement,o=t.parentElement.nextElementSibling,i=0;i<n.length;i++){var r=document.createElement("div");r.classList.add("pdf-page"),r.style.height=e.getConfig().height,r.append(n[i].canvas),null!=o?a.insertBefore(r,o):a.append(r)}}function te(e,t,n,a,o){e.lineWidth=r,e.lineCap="round",e.strokeStyle=h[p[T]].color,e.beginPath(),e.moveTo(t,n),e.lineTo(a,o),e.stroke()}function ne(e,t,n,a,o){var i=s;e.lineWidth=i,e.lineCap="round",e.fillStyle=u[p[T]].color,e.strokeStyle=u[p[T]].color;e.strokeStyle=e.strokeStyle.replace(/[\d\.]+\)$/g,"1)"),e.beginPath(),e.moveTo(t,n),e.lineTo(a,o),e.stroke();for(var r=Math.round(Math.sqrt(Math.pow(a-t,2)+Math.pow(o-n,2))/(5/i)),d=(a-t)/r,c=(o-n)/r,h=0;h<r;h++)if(l>.9*Math.random()){var g=n+h*c,v=t+h*d+(Math.random()-.5)*i*1.2,f=g+(Math.random()-.5)*i*1.2;e.clearRect(v,f,2*Math.random()+2,Math.random()+1)}}function ae(e,t,n){e.save(),e.beginPath(),e.arc(t,n,c.radius,0,2*Math.PI,!1),e.clip(),e.clearRect(t-c.radius-1,n-c.radius-1,2*c.radius+2,2*c.radius+2),e.restore(),1==T&&i&&function(e,t,n){var a=O[1].context;O[1].scale=Math.min(O[1].width/Y[1].width,O[1].height/Y[1].height),O[1].xOffset=(O[1].width-Y[1].width*O[1].scale)/2,O[1].yOffset=(O[1].height-Y[1].height*O[1].scale)/2;for(var o=O[1].scale,r=(O[1].xOffset,O[1].yOffset,i.distance*o),s=O[1].width/2-r/2-Math.floor((O[1].width-r)/2/r)*r,l=s+r*Math.ceil((e-n-s)/r);l<=s+r*Math.floor((e+n-s)/r);l+=r)a.beginPath(),a.lineWidth=i.width*o,a.lineCap="round",a.fillStyle=i.color,a.strokeStyle=i.color,a.moveTo(l,t-Math.sqrt(n*n-(e-l)*(e-l))),a.lineTo(l,t+Math.sqrt(n*n-(e-l)*(e-l))),a.stroke();for(var d=O[1].height/2-r/2-Math.floor((O[1].height-r)/2/r)*r,c=d+r*Math.ceil((t-n-d)/r);c<=d+r*Math.floor((t+n-d)/r);c+=r)a.beginPath(),a.lineWidth=i.width*o,a.lineCap="round",a.fillStyle=i.color,a.strokeStyle=i.color,a.moveTo(e-Math.sqrt(n*n-(t-c)*(t-c)),c),a.lineTo(e+Math.sqrt(n*n-(t-c)*(t-c)),c),a.stroke()}(t,n,c.radius)}function oe(){clearTimeout(W),W=null,O[0].sponge.style.visibility="hidden",O[1].sponge.style.visibility="hidden",O[1].container.style.opacity=1,O[1].container.style.visibility="visible",T=1}function ie(){clearTimeout(W),W=null,O[0].sponge.style.visibility="hidden",O[1].sponge.style.visibility="hidden",O[1].container.style.opacity=0,O[1].container.style.visibility="hidden",P=null,q=null,R=null,T=0}function re(e){0==e&&clearTimeout(H),O[e].context.clearRect(0,0,O[e].width,O[e].height),1==e&&i&&se()}function se(){var e=O[1].context;O[1].scale=Math.min(O[1].width/Y[1].width,O[1].height/Y[1].height),O[1].xOffset=(O[1].width-Y[1].width*O[1].scale)/2,O[1].yOffset=(O[1].height-Y[1].height*O[1].scale)/2;for(var t=O[1].scale,n=(O[1].xOffset,O[1].yOffset,i.distance*t),a=O[1].width/2-n/2-Math.floor((O[1].width-n)/2/n)*n;a<O[1].width;a+=n)e.beginPath(),e.lineWidth=i.width*t,e.lineCap="round",e.fillStyle=i.color,e.strokeStyle=i.color,e.moveTo(a,0),e.lineTo(a,O[1].height),e.stroke();for(var o=O[1].height/2-n/2-Math.floor((O[1].height-n)/2/n)*n;o<O[1].height;o+=n)e.beginPath(),e.lineWidth=i.width*t,e.lineCap="round",e.fillStyle=i.color,e.strokeStyle=i.color,e.moveTo(0,o),e.lineTo(O[1].width,o),e.stroke()}function le(e,t){e>=h[T].length&&(e=0),p[T]=e,O[T].canvas.style.cursor=pens[T][p[T]].cursor,t&&(he({type:"setcolor",index:e,begin:Date.now()-I}),K())}function de(e,t){(function(e){re(1);var t=$(N,1),n=0,a=0==e;for(;n<t.events.length&&t.events[n].begin<Date.now()-I;)"setboard"==t.events[n].type?a=e==t.events[n].index:(a||"setcolor"==t.events[n].type)&&ve(1,t.events[n],Date.now()-I),n++})(M=e),t&&(he({type:"setboard",index:M,begin:Date.now()-I}),K())}var ce=[];function he(e){for(var t=$(),n=t.events.length;n>0&&e.begin<t.events[n-1].begin;)n--;t.events.splice(n,0,e),t.duration=Math.max(t.duration,Date.now()-I)+1}function ue(e,t){I=Date.now()-e,ie(),T=0,M=0;for(var n=0;n<2;n++){re(n);for(var a=$(N,n),o=0;o<a.events.length&&a.events[o].begin<Date.now()-I;)ve(n,a.events[o],e),o++;for(;z&&o<a.events.length;)B[n].push(setTimeout(ve,a.events[o].begin-(Date.now()-I),n,a.events[o],e)),o++}null!=t&&(T=t),1==T&&oe()}function ge(){for(var e=0;e<2;e++){for(var t=0;t<B[e].length;t++)clearTimeout(B[e][t]);B[e]=[]}}function ve(e,t,a){switch(t.type){case"open":a<=t.begin?oe():T=1;break;case"close":a<t.begin?ie():T=0;break;case"clear":re(e);break;case"setcolor":le(t.index);break;case"setboard":de(t.index);break;case"draw":!function(e,t,a){if(t.curve.length>1)for(var o=O[e].context,i=O[e].scale,r=O[e].xOffset,s=O[e].yOffset,l=(t.end-t.begin)/(t.curve.length-1),d=1;d<t.curve.length;d++)t.begin+d*l<=Date.now()-I?n[e](o,r+t.curve[d-1].x*i,s+t.curve[d-1].y*i,r+t.curve[d].x*i,s+t.curve[d].y*i):z&&B.push(setTimeout(n[e],Math.max(0,t.begin+d*l-(Date.now()-I)),o,r+t.curve[d-1].x*i,s+t.curve[d-1].y*i,r+t.curve[d].x*i,s+t.curve[d].y*i))}(e,t);break;case"erase":!function(e,t,n){if(t.curve.length>1)for(var a=O[e].context,o=O[e].scale,i=O[e].xOffset,r=O[e].yOffset,s=(t.end-t.begin)/t.curve.length,l=0;l<t.curve.length;l++)t.begin+l*s<=Date.now()-I?ae(a,i+t.curve[l].x*o,r+t.curve[l].y*o):z&&B.push(setTimeout(ae,Math.max(0,t.begin+l*s-(Date.now()-I)),a,i+t.curve[l].x*o,r+t.curve[l].y*o))}(e,t)}}function pe(e,t,n){var a=O[T].context,o=O[T].scale,i=O[T].xOffset,r=O[T].yOffset;P=e*o+i,q=t*o+r,1==n?(R={type:"erase",begin:Date.now()-I,end:null,curve:[{x:e,y:t}]},O[T].canvas.style.cursor='url("'+c.src+'") '+c.radius+" "+c.radius+", auto",ae(a,e*o+i,t*o+r)):R={type:"draw",begin:Date.now()-I,end:null,curve:[{x:e,y:t}]}}function fe(e,t){if(R){R.type="erase",R.begin=Date.now()-I,O[T].sponge.style.left=e-c.radius+"px",O[T].sponge.style.top=t-c.radius+"px",O[T].sponge.style.visibility="visible",ae(O[T].context,e,t);var n=new CustomEvent(C);n.content={sender:"chalkboard-plugin",type:"startErasing",timestamp:Date.now()-I,x:(L-xOffset)/scale,y:(A-yOffset)/scale},document.dispatchEvent(n)}}function me(e,t,a){var o=O[T].context,i=O[T].scale,r=O[T].xOffset,s=O[T].yOffset;R||pe(e,t,a),R.curve.push({x:e,y:t}),t*i+s<O[T].height&&e*i+r<O[T].width&&(a?ae(o,e*i+r,t*i+s):n[T](o,P,q,e*i+r,t*i+s),P=e*i+r,q=t*i+s)}function be(){R&&(R.end=Date.now()-I,("erase"==R.type||R.curve.length>1)&&(he(R),K()),R=null)}function ye(){if(1==T)R=null,k||(he({type:"close",begin:Date.now()-I}),K()),ie(),(e=new CustomEvent(C)).content={sender:"chalkboard-plugin",type:"closeChalkboard",timestamp:Date.now()-I},document.dispatchEvent(e);else if(oe(),!k){var e;he({type:"open",begin:Date.now()-I}),(e=new CustomEvent(C)).content={sender:"chalkboard-plugin",type:"showChalkboard",timestamp:Date.now()-I},document.dispatchEvent(e);var t=0;d[T]&&(t=p[T]),le(t,!0),(e=new CustomEvent(C)).content={sender:"chalkboard-plugin",type:"setcolor",timestamp:Date.now()-I,index:t},document.dispatchEvent(e)}}function we(){if(!k){he({type:"clear",begin:Date.now()-I}),re(T);var e=new CustomEvent(C);e.content={sender:"chalkboard-plugin",type:"clear",timestamp:Date.now()-I},document.dispatchEvent(e)}}function ke(e){if(!k){le(e,!0);var t=new CustomEvent(C);t.content={sender:"chalkboard-plugin",type:"setcolor",timestamp:Date.now()-I,index:e},document.dispatchEvent(t)}}function Ce(e){if(e||confirm("Please confirm to delete chalkboard drawings on this slide!")){var t;ge(),I=Date.now(),R=null,ie(),re(0),re(1),T=1,(t=$()).duration=0,t.events=[],T=0,(t=$()).duration=0,t.events=[],K();var n=new CustomEvent(C);n.content={sender:"chalkboard-plugin",type:"resetSlide",timestamp:Date.now()-I},document.dispatchEvent(n)}}for(var E in document.addEventListener("received",function(e){e.content&&"chalkboard-plugin"==e.content.sender&&ce.push(e),1==ce.length&&function e(){var t=ce.shift();I=Date.now()-t.content.timestamp;switch(t.content.type){case"showChalkboard":oe();break;case"closeChalkboard":ie();break;case"startDrawing":pe(t.content.x,t.content.y,t.content.erase);break;case"startErasing":t.content&&(t.content.type="erase",t.content.begin=Date.now()-I,ae(O[T].context,t.content.x,t.content.y));break;case"drawSegment":me(t.content.x,t.content.y,t.content.erase);break;case"stopDrawing":be();break;case"clear":we();break;case"setcolor":le(t.content.index,!0);break;case"setboard":de(t.content.index,!0);break;case"resetSlide":Ce(!0);break;case"init":Y=t.content.storage;for(var n=0;n<2;n++)O[n].scale=Math.min(O[n].width/Y[n].width,O[n].height/Y[n].height),O[n].xOffset=(O[n].width-Y[n].width*O[n].scale)/2,O[n].yOffset=(O[n].height-Y[n].height*O[n].scale)/2;re(0),re(1),z||(H=setTimeout(ue,w,G(),0)),1==T&&0==t.content.mode&&setTimeout(ie,w+50),0==T&&1==t.content.mode&&setTimeout(oe,w+50),T=t.content.mode}ce.length>0?e():K()}()}),document.addEventListener("welcome",function(e){var t=new CustomEvent(C);t.content={sender:"chalkboard-plugin",recipient:e.id,type:"init",timestamp:Date.now()-I,storage:Y,mode:T},document.dispatchEvent(t)}),document.addEventListener("seekplayback",function(e){ge(),z&&0!=e.timestamp||ue(e.timestamp)}),document.addEventListener("startplayback",function(e){ge(),z=!0,ue(e.timestamp)}),document.addEventListener("stopplayback",function(e){z=!1,ge()}),document.addEventListener("startrecording",function(e){Ce(!0),I=Date.now()}),document.addEventListener("touchstart",function(e){if(!k&&e.target.getAttribute("data-chalkboard")==T){var t=O[T].scale,n=O[T].xOffset,a=O[T].yOffset;e.preventDefault();var o=e.touches[0];L=o.pageX,A=o.pageY,pe((L-n)/t,(A-a)/t,!1);var i=new CustomEvent(C);i.content={sender:"chalkboard-plugin",type:"startDrawing",timestamp:Date.now()-I,x:(L-n)/t,y:(A-a)/t,erase:!1},document.dispatchEvent(i),W=setTimeout(fe,500,L,A)}},!!a&&{passive:!1}),document.addEventListener("touchmove",function(e){if(clearTimeout(W),W=null,R){var t=O[T].scale,n=O[T].xOffset,a=O[T].yOffset,o=e.touches[0];L=o.pageX,(A=o.pageY)<O[T].height&&L<O[T].width&&(e.preventDefault(),"erase"==R.type&&(O[T].sponge.style.left=L-c.radius+"px",O[T].sponge.style.top=A-c.radius+"px")),me((L-n)/t,(A-a)/t,"erase"==R.type);var i=new CustomEvent(C);i.content={sender:"chalkboard-plugin",type:"drawSegment",timestamp:Date.now()-I,x:(L-n)/t,y:(A-a)/t,erase:"erase"==R.type},document.dispatchEvent(i)}},!1),document.addEventListener("touchend",function(e){clearTimeout(W),W=null,O[T].sponge.style.visibility="hidden",be();var t=new CustomEvent(C);t.content={sender:"chalkboard-plugin",timestamp:Date.now()-I,type:"stopDrawing"},document.dispatchEvent(t)},!1),document.addEventListener("mousedown",function(e){if(!k&&e.target.getAttribute("data-chalkboard")==T){var t=O[T].scale,n=O[T].xOffset,a=O[T].yOffset;L=e.pageX,A=e.pageY,pe((L-n)/t,(A-a)/t,2==e.button||1==e.button);var o=new CustomEvent(C);o.content={sender:"chalkboard-plugin",type:"startDrawing",timestamp:Date.now()-I,x:(L-n)/t,y:(A-a)/t,erase:2==e.button||1==e.button},document.dispatchEvent(o)}}),document.addEventListener("mousemove",function(e){if(R){var t=O[T].scale,n=O[T].xOffset,a=O[T].yOffset;L=e.pageX,A=e.pageY,me((L-n)/t,(A-a)/t,"erase"==R.type);var o=new CustomEvent(C);o.content={sender:"chalkboard-plugin",type:"drawSegment",timestamp:Date.now()-I,x:(L-n)/t,y:(A-a)/t,erase:"erase"==R.type},document.dispatchEvent(o)}}),document.addEventListener("mouseup",function(e){if(O[T].canvas.style.cursor=pens[T][p[T]].cursor,R){be();var t=new CustomEvent(C);t.content={sender:"chalkboard-plugin",type:"stopDrawing",timestamp:Date.now()-I},document.dispatchEvent(t)}}),window.addEventListener("resize",function(){var e=Date.now()-I;z||(e=G());for(var t=0;t<2;t++)O[t].width=window.innerWidth,O[t].height=window.innerHeight,O[t].canvas.width=O[t].width,O[t].canvas.height=O[t].height,O[t].context.canvas.width=O[t].width,O[t].context.canvas.height=O[t].height,O[t].scale=Math.min(O[t].width/Y[t].width,O[t].height/Y[t].height),O[t].xOffset=(O[t].width-Y[t].width*O[t].scale)/2,O[t].yOffset=(O[t].height-Y[t].height*O[t].scale)/2;ue(e,T)}),e.addEventListener("ready",function(t){if(Q)console.log("Create printouts when ready"),S(V);else{if(I=Date.now()-G(),N=e.getIndices(),z||ue(G(),0),e.isAutoSliding()){var n=new CustomEvent("startplayback");n.timestamp=0,document.dispatchEvent(n)}K()}}),e.addEventListener("slidechanged",function(t){if(!Q){if(I=Date.now()-G(),N=e.getIndices(),ie(),re(0),re(1),z||(H=setTimeout(ue,w,G(),0)),e.isAutoSliding()){var n=new CustomEvent("startplayback");n.timestamp=0,document.dispatchEvent(n)}K()}}),e.addEventListener("fragmentshown",function(t){if(!Q)if(I=Date.now()-G(),N=e.getIndices(),ie(),re(0),re(1),e.isAutoSliding()){var n=new CustomEvent("startplayback");n.timestamp=0,document.dispatchEvent(n)}else z||ue(G(),0)}),e.addEventListener("fragmenthidden",function(t){Q||(I=Date.now()-G(),N=e.getIndices(),ie(),re(0),re(1),e.isAutoSliding()?document.dispatchEvent(new CustomEvent("stopplayback")):z||(ue(G()),ie()))}),e.addEventListener("autoslideresumed",function(e){var t=new CustomEvent("startplayback");t.timestamp=0,document.dispatchEvent(t)}),e.addEventListener("autoslidepaused",function(e){document.dispatchEvent(new CustomEvent("stopplayback")),ue(G(),0)}),this.toggleNotesCanvas=function(){if(!k)if(1==T)ye(),notescanvas.style.background=t[0],notescanvas.style.pointerEvents="auto";else if("none"!=notescanvas.style.pointerEvents)b&&(notescanvas.querySelector(".palette").style.visibility="hidden"),R=null,notescanvas.style.background="rgba(0,0,0,0)",notescanvas.style.pointerEvents="none";else{b&&(notescanvas.querySelector(".palette").style.visibility="visible"),notescanvas.style.background=t[0],notescanvas.style.pointerEvents="auto";var e=0;p[T]&&(e=p[T]),le(e,!0);var n=new CustomEvent(C);n.content={sender:"chalkboard-plugin",type:"setcolor",timestamp:Date.now()-I,index:e},document.dispatchEvent(n)}},this.toggleChalkboard=ye,this.colorIndex=ke,this.colorNext=function(){if(!k){let t=(p[T]=(p[T]+1)%pens[T].length,p[T]);le(t,!0);var e=new CustomEvent(C);e.content={sender:"chalkboard-plugin",type:"setcolor",timestamp:Date.now()-I,index:t},document.dispatchEvent(e)}},this.colorPrev=function(){if(!k){let t=(p[T]=(p[T]+(pens[T].length-1))%pens[T].length,p[T]);le(t,!0);var e=new CustomEvent(C);e.content={sender:"chalkboard-plugin",type:"setcolor",timestamp:Date.now()-I,index:t},document.dispatchEvent(e)}},this.clear=we,this.reset=Ce,this.resetAll=function(t){if(t||confirm("Please confirm to delete all chalkboard drawings!")){ge(),I=Date.now(),re(0),re(1),1==T&&(R=null,ie()),Y=[{width:e.getConfig().width,height:e.getConfig().height,data:[]},{width:e.getConfig().width,height:e.getConfig().height,data:[]}],x.storage&&sessionStorage.setItem(x.storage,null);var n=new CustomEvent(C);n.content={sender:"chalkboard-plugin",type:"init",timestamp:Date.now()-I,storage:Y,mode:T},document.dispatchEvent(n)}},this.download=function(){var e=document.createElement("a");document.body.appendChild(e);try{e.download="chalkboard.json";var t=new Blob([U()],{type:"application/json"});e.href=window.URL.createObjectURL(t)}catch(t){e.innerHTML+=" ("+t+")"}e.click(),document.body.removeChild(e)},this.updateStorage=K,this.getData=U,this.configure=D,g)g[E]&&e.addKeyBinding(g[E],RevealChalkboard[E]);return this};